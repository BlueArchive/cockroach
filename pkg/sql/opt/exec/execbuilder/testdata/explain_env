# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYokZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUa2cY0IfIE_ZJBlJ24mCWlWBoLoKIOd_5_c5HhiG8R22YFAMYyexaS5rNX70EXGKW1oznqMGisbBorIIgDIFyLr8SpVFRjYQaIpUlilMBc2rAzhFyLGjNLSwor3EAsigcLpPGEpNRYchXZudkbUUyyYlhN9gBz6nLZMVb7cazqyN48-qjN177ZsLu9X2-bWw1FYZmlklBlGZSM7tqAwqpK8rb0F9qypldEVkQg3rBstYENJY1p7rNkUaaEyl4ax6b5uzA1gZJId2wUHtHpssJ05j5edSVoHo9KxQ05Zh3Yk3Di6LmnFgHafD7cLM4cUBrvnB44U4uAO6L2VjS2koXokmEsEpxljFLDHKXbiE1qZVjR2sosQu-3SrnI6U2mxNjqcUKhW1P_IE3YVBbUlBjiaJ2_ihQVXPLlPtD5qxgGXU5GEcW37eOTq-d3LDyhpbkL8na964JulSuTVTkhJVCaiRCWrJghjk3zbANYYJkUu2lmZsWy33RD5pn0DhtIJZVKGsLLyDaOcfI3Lt4AiYMgQmLekH53vVX0thSowdwqktsqOhISLT82jrPfhRFHiOz9dIqyyp2gzlRVFvmasScMJHj0nvb025XH5fZ9SPrEi5BqXPUmBNOje0YvVtqz3SicS4rdHV17qcngZNoozhrBJhwVrHWYKfRz-drjO-DXiuJxoyarr14CJozY2WpafUklN8PfytY-rR428z2A8MuzVMlsbqsjg2rGKdO8YmdazRzyVtbGh2feajGAjXhUl7Xyi-i8UJSXHcG1VLR0s2RCVXbhgJMlB0wjd5wHWrvDP0AzRdODC1wTZpOKb7TvkfS193HTJTkfgb-ileoba1Tr2qtLdyNd7eIm52uORKlZUpTxvfcwi1uNBW5rIjB9rVokKzCGylaJeVdMvJmW2K36cw-t7VIZS3yRkAo58i7r0IPy6QwVlPm9EZIp8gLz4st8XnkdbzAzEq971ElgmA0jYdJDMnw5WXsu3is6pSz7HgJB8EzCuNJcg6TqwQm7y4vj4Jn6fqk-RpdTWbJdDieJLAk6hpX8HY6fjOcfoQ_4o9wQGE4Gx0eBc_Gk1fxB1iSlLB8CQepPw8OL4JgeJnE053hx5Pf41ECs2SYjGfJeDSD558CAIC__W_306OL0j_tegOIju6P1xdabwCf7g4b-97d9-dte43UYk6o7Q2gdxr1z8OoH0Z9iPqDKBpEUW_L2D1WmPBvpFo4QD_aju3lzr9n7Uq5xHrbYK_2G-A2zKn4ncPTs_7pmf_fP0f_t-T0h5TsM_xxVQefn1_s4ebKcbP-DzcXbdxc7eBmveHmA7sFKZzl66tpPP510lguDmEav46n8WQUz2DDzwN6T2yH88RedBN7tZPYvt74w9vL4XgCB1dvkyOIJ-8PYRZfOtuf4PX06g0s4c_f4mkMKbyAs4sgDMMw8K-R5S_r3Qrg--3t99tv32-_wZ2S2AGcnJ70B_Dp5AxCODn7HPwbAAD__-fZoPo=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEjn5XQQOCsx11c1b6hS22rUoCoKSjmQuFKmSlGtnGFDsGXK5p8uTDKSUxEEtK8HQXAQ2fb7z9zsf6fvwHpVmUoxgIpNLJWmyfPUScI1JXDGeogKD2sCqtvI83wfKufxKSoUlVUioJrI0pORUwJJqMEuEFDNacQMryiscgcwyi0ukNkQnVGjylZklaaxIIjnR7Ao74Cm1mWx4q910cTGAN68-OuPGNxNmr-_TbWOjqNA0MUwKUiomFTObNqCQqqC8Df2lopyZDZEZ0ahWLGlNQGFecaraHCmkKZGCt-Zx25wd2EojyaQdFirnSHc5YQoTN4-qEFQ1s0JBY45pJ1bXvMgqzomxkBq_D7cIIws0-guHF_bkDOC-mFtLWhlpQ9SJEFaUnCXMEI3cpptJRarSsqM1lNgF326V9RFTkyyJNtRggcK0J_7Am9CoDMmoNqSkZvkoUFFxw0r7QaYsYwm1OWhLFte3jk43Tq5YfkVz8odk7XtXB12Xtk1UpITlQiokQhqyYppZN_WwNWGCJLLcSzM7LZa6oh80T6O22kAMK1BWBl5AsHOOgb538QSM7wMTBtWK8r3rX0ptcoUOwKnKsaaiJSFR8mvrPIdBEDiMTJqlLQ0r2BWmpKTKMFsjpoSJFNfO25522_q4TC4fWZewCUqVosKUcKpNx-jtUjumE4VLWaCtq3M_HQmsROuSs1qACWcFaw12HPz_tMG4PqhGSRQmVHftxUPQkmkjc0WLJ6HcfrhbwdCnxdtmthsYdmlemROj8uJQs4JxahWfmKVCvZS8taXB4YmDKsxQES7lZVW6RdROSLLLzqBKljS3c2SirExNASbyDphCZ9iE2jtDN0D9hRNNM2xI0ynFd9r3SPra-5iJnNzPwF3xJSpTqdipWmsLd-PtLWJnpyqOpFQypjHje27hFjeKilQWRGP7WtRIVuCVFK2S8i6aOLMtsbvtzD63lYhlJdJaQCjnyLuvQgdLpNBGUWb1RkiryCvHiy3xeeR1vMLESLXvUSU8bzIPx1EI0fjleei6eFhWMWfJ4Rr63jMK01l0CrOLCGbvzs8H3rO4Oam_TS5mi2g-ns4iWJPyEjfwdj59M55_hN_Cj9CnMF5MDgbes-nsVfgB1iQmLF1DP3bn3sGZ543Po3C-M_x09ms4iWARjaPpIppOFvD8kwcA8Kf7b_96dJW7p11vBMHg_ri50Hoj-HR3WNv37r5_3rZXSA2mhJreCHrHwfDUD4Z-MIRgOAqCURD0toztY4UJ90aqhAUMg-3YTu7ce9ZsSptYbxvs1P4WuA2zKn7n8PhkeHzifvtr8F9Ljn9IyS7DH1e19_n52R5ubiw3q--4uWrj5mYHN6tbbj6wW5HMWr6-mIfTn2e15eoA5uHrcB7OJuECbvnZp_fEtjhH7FU3sTc7ie3qDT-8PR9PZ9C_eBsNIJy9P4BFeG5t_wev5xdvYD2ADfz-SzgPIYYXcHLm-b7ve0wIVL57BfYTJbU-8ODm-p-b628319_APVc2352sf2rW0f7yt-36zfV1Y3CnQWYER8dHwxF8OjoBH45OPntbZhnjBpWGvlEVHnj_BgAA__98IMUD

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQYrkNNdBA564brq4C11ClstWhQFQUtHMheKZEnKsTMM6EPkck_XJxlIyYmDWVaKobkILOl85_c7HxmG8AG1YVKMYCLTay1punr9CnCD6bJiPEMNFo2FdW0VBGEIlHN5Q5RGRTUSaohUlihOBayoAbtCyDCnFbewprzCEcg8d7hUGktMSoUhN8yuSGNFUsmJYbfYAc-oy2TLW-2mi6sBvH39yRs3vpmwR32f7xtbTYWhqWVSEKWZ1Mxu24BC6pLyNvTXinJmt0TmxKBes7Q1AY1Fxaluc6SRZkQK3prHrjkHsJVBkks3LNTekelywjSmfh5VKahuZoWCLjlmnVhT8yKvOCfWQWr8MdwiThzQmq8cXro3FwAPxewsaWWlC1EnQlipOEuZJQa5SzeXmlTKsaM1lDgE32-V87GkNl0RY6nFEoVtT_yRN2FQW5JTY4midvUkUFlxy5T7ITOWs5S6HIwji-9bR6cbJ7esuKUF-VOy9r2rg26UaxMVGWGFkBqJkJasmWHOTT1sQ5ggqVRHaeamxTJf9KPmGTROG4hlJcrKwkuIDs4xMg8ufgAThsCERb2m_Oj6K2lsodEDONUF1lR0JCRa3rTOcxhFkcfItFlaZVnJbjEjimrLXI2YESYy3HhvR9rt6uMyvX5iXcIlKHWGGjPCqbEdo3dL7ZlONK5kia6uzv30JHASbRRntQATzkrWGuws-vW8wfg-6EZJNKbUdO3FY9CKGSsLTcsfQvn98KeCpT8Wb5_ZfmDYpXmqIFYX5alhJePUKT6xK41mJXlrS6PTFx6qMUdNuJTXlfKLaLyQ5NedQbVUtHBzZEJVtqYAE0UHTKM3bEIdnaEfoPnKiaE5NqTplOJ77Xsifd15zERBHmbgj3iF2lZ66VWttYWH8e4UcbPTFUeitFzSJeNHTuEWN5qKTJbEYPta1EhW4q0UrZLyPpl4sz2x23XmmNtKLGUlslpAKOfIu49CD0ulMFZT5vRGSKfIa8-LPfF54nG8xtRKfexSJYJgMo_HSQzJ-NVl7Lt4qqolZ-npBvrBMwrTWXIOs6sEZu8vLwfBs2Xzpn6aXM0WyXw8nSWwIeoat_BuPn07nn-CP-JP0KcwXkxOBsGz6ex1_BE2ZElYtoH-0r8PTi6CYHyZxPOD4aez3-NJAotknEwXyXSygOefAwCAv_x_99ej68Jf7XojiAYPr5sDrTeCz_cva_ve_fOXfXuN1GJGqO2NoHcWDc_DaBhGQ4iGoygaRVFvz9hdVpjwd6RKOMAw2o_t5c7fZ-1WucR6-2Cv9jvgPsyp-L3DsxfDsxf-29-D_1vy8qeU7DP8eVUHX55fHOHm1nGz-g83123c3B7gZrXj5iO7Ncmd5ZureTz9bVZbrk9gHr-J5_FsEi9gx88-fSC2w3lir7uJvT1IbF9v_PHd5Xg6g_7Vu2QA8ezDCSziS2f7C7yZX72FDYwXIAUO6l_2Rl4EYRiGARMCdejvgf1US2NOAvh-98_3u2_f776Bv7Bs4DM1L6XALy2f7I30n-6aTznjFrWBvtUVngT_BgAA__9Mw7lu

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlJO4mCWlWBoLoKIOd_5_c5HhiG8R22YFEMYy_RKS5ouX70EXGG6qBjPUINFY6FurIIgDIFyLr8SpVFRjYQaIpUlilMBS2rALhEyzGnFLdSUVzgEmecOl0pjiUmpMOQrs0uysSKp5MSwa-yAZ9RlsuatdpP55RG8efXRG298M2H3-j7dNraaCkNTy6QgSjOpmV23AYXUJeVt6C8V5cyuicyJQV2ztDUBjUXFqW5zpJFmRAremsdtc3ZgK4Mkl25YqL0j0-WEaUz9PKpSUL2ZFQq64Jh1Yk3Di7zinFgHafD7cPM4cUBrvnA4dydnAPfF3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2sosQu-3SrnY0FtuiTGUoslCtue-ANvwqC2JKfGEkXt8lGgsuKWKfeHzFjOUupyMI4svm8dnd44uWbFNS3IX5K1710TdKVcm6jICCuE1EiEtKRmhjk3zbANYYKkUu2lmZsWy3zRD5pn0DhtIJaVKCsL5xDtnGNk7l08AROGwIRFXVO-d_2VNLbQ6AGc6gIbKjoSEi2_ts6zH0WRx8h0s7TKspJdY0YU1Za5GjEjTGS48t72tNvVx2V69ci6hEtQ6gw1ZoRTYztG75baM51oXMoSXV2d--lJ4CTaKM4aASaclaw12En08-kG4_ugN0qiMaWmay8egpbMWFloWj4J5ffD3wqWPi3eNrP9wLBL81RBrC7KY8NKxqlTfGKXGs1S8taWRscDD9WYoyZcyqtK-UU0Xkjyq86gWipauDkyoSrbUICJomv7NHrLTaxmiOfwy2AnxfwMzRdODM1xw5tONb6Tv0cy2F3JTBTkfgz-lleobaUXXthau7gb7y4SNz5dcSRKywVdML7nIm5xo6nIZEkMtm9Gg2QlXkvRqirvkrE329K7287sc1uJhaxE1mgI5Rx5923oYakUxmrKnOQI6US59tTY0p9H3sg1plbqfe8qEQTjWTxKYkhGLy9i38VjVS04S49XcBA8ozCZJqcwvUxg-u7i4ih4tticNF_jy-k8mY0m0wRWRF3hGt7OJm9Gs4_wR_wRDiiM5uPDo-DZZPoq_gArsiAsW8HBwp8Hh2dBMLpI4tnO8JPp7_E4gXkySibzZDKew_NPAQDA3_63--nRuvCvu94QoqP7482d1hvCp7vDxr539_15214jtZgRantD6J1E_dMw6odRH6L-MIqGUdTbMnbvFSb8M6kSDtCPtmN7xfNPWrtWLrHeNtgL_i1wG-aE_M7hyaB_MvD_--fo_5a8-CEl-wx_XNXB5-dne7i5dtys_sPNuo2b6x3crG65-cCuJrmzfH05iye_ThvL-hBm8et4Fk_H8Rxu-XlA74ntcJ7YdTex1zuJ7euNP7y9GE2mcHD5NjmCePr-EObxhbP9CV7PLt_AGv78LZ7FUME5DM6CMAzDwD9I1gF8v7n5fvPt-803uFMQO4QX_SF8ejGAEF4MPgf_BgAA__9xYZ0h

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlJO4mCWlWBoLoKIOd_5_c5HhiG8R22YFEMYy_RKS5ouX70EXGG6qBjPUINFY6FurIIgDIFyLr8SpVFRjYQaIpUlilMBS2rALhEyzGnFLdSUVzgEmecOl0pjiUmpMOQrs0uysSKp5MSwa-yAZ9RlsuatdpP55RG8efXRG298M2H3-j7dNraaCkNTy6QgSjOpmV23AYXUJeVt6C8V5cyuicyJQV2ztDUBjUXFqW5zpJFmRAremsdtc3ZgK4Mkl25YqL0j0-WEaUz9PKpSUL2ZFQq64Jh1Yk3Di7zinFgHafD7cPM4cUBrvnA4dydnAPfF3FrSykoXokmEsFJxljJLDHKXbi41qZRjR2sosQu-3SrnY0FtuiTGUoslCtue-ANvwqC2JKfGEkXt8lGgsuKWKfeHzFjOUupyMI4svm8dnd44uWbFNS3IX5K1710TdKVcm6jICCuE1EiEtKRmhjk3zbANYYKkUu2lmZsWy3zRD5pn0DhtIJaVKCsL5xDtnGNk7l08AROGwIRFXVO-d_2VNLbQ6AGc6gIbKjoSEi2_ts6zH0WRx8h0s7TKspJdY0YU1Za5GjEjTGS48t72tNvVx2V69ci6hEtQ6gw1ZoRTYztG75baM51oXMoSXV2d--lJ4CTaKM4aASaclaw12En08-kG4_ugN0qiMaWmay8egpbMWFloWj4J5ffD3wqWPi3eNrP9wLBL81RBrC7KY8NKxqlTfGKXGs1S8taWRscDD9WYoyZcyqtK-UU0Xkjyq86gWipauDkyoSrbUICJomv7NHrLTaxmiOfwy2AnxfwMzRdODM1xw5tONb6Tv0cy2F3JTBTkfgz-lleobaUXXthau7gb7y4SNz5dcSRKywVdML7nIm5xo6nIZEkMtm9Gg2QlXkvRqirvkrE329K7287sc1uJhaxE1mgI5Rx5923oYakUxmrKnOQI6US59tTY0p9H3sg1plbqfe8qEQTjWTxKYkhGLy9i38VjVS04S49XcBA8ozCZJqcwvUxg-u7i4ih4tticNF_jy-k8mY0m0wRWRF3hGt7OJm9Gs4_wR_wRDiiM5uPDo-DZZPoq_gArsiAsW8HBwp8Hh2dBMLpI4tnO8JPp7_E4gXkySibzZDKew_NPAQDA3_63--nRuvCvu94QoqP7482d1hvCp7vDxr539_15214jtZgRantD6J1E_dMw6odRH6L-MIqGUdTbMnbvFSb8M6kSDtCPtmN7xfNPWrtWLrHeNtgL_i1wG-aE_M7hyaB_MvD_--fo_5a8-CEl-wx_XNXB5-dne7i5dtys_sPNuo2b6x3crG65-cCuJrmzfH05iye_ThvL-hBm8et4Fk_H8Rxu-XlA74ntcJ7YdTex1zuJ7euNP7y9GE2mcHD5NjmCePr-EObxhbP9CV7PLt_AGv78LZ7FUME5DM6CMAzDwD9I1gF8v7n5fvPt-803uFMQO4QX_SF8ejGAEF4MPgf_BgAA__9xYZ0h

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUa2cY0IfIE_ZJBlJK4mCWlWBoLoKIOd_5_c5HhiG8R22YFEMYy_RKS5ouX70EXGO6qBjPUINFY2FVWwVBGALlXH4lSqOiGgk1RCpLFKcCltSAXSJkmNOKW1hRXuEQZJ47XCqNJSalwpCvzC5JY0VSyYlh19gBz6jLZMNb7SbzyyN48-qjN258M2H3-j7dNraaCkNTy6QgSjOpmd20AYXUJeVt6C8V5cxuiMyJQb1iaWsCGouKU93mSCPNiBS8NY_b5uzAVgZJLt2wUHtHpssJ05j6eVSloLqZFQq64Jh1Yk3Ni7zinFgHqfH7cPM4cUBrvnA4dydnAPfF3FrSykoXok6EsFJxljJLDHKXbi41qZRjR2sosQu-3SrnY0FtuiTGUoslCtue-ANvwqC2JKfGEkXt8lGgsuKWKfeHzFjOUupyMI4svm9dHWu8XLPimhbkL8nEnuY1gdfKtYqKjLBCSI1ESEtWzDDnqR64IUyQVKq9VHPxWeYLf9BAg8bpA7GsRFlZOIdoZzqRuXfxBEwYAhMW9YryvRKgpLGFRg_gVBdY09ERkWj5tXWm_SiKPEamzeIqy0p2jRlRVFvmasSMMJHh2nvbM2dXH5fp1SPrEi5BqTPUmBFOje1YNLfYnu1E41KW6Orq3FFPAifTRnFWizDhrGStwU6in08bjO-DbtREY0pN1248BC2ZsbLQtHwSyu-IvxksfVq8bWb7gWGX7qmCWF2Ux4aVjFOn-sQuNZql5K0tjY4HHqoxR024lFeV8rtovJjkV51BtVS0cHNkQlW2pgATRdf2afSWTax6iOfwy2AnxfwMzRdODM2x4U2nIt9J4CMZ7K5lJgpyPwZ_0yvUttILL26tXdyNd5eJG5-uOBKl5YIuGN9zGbe40VRksiQG2zejRrISr6VoVZV3ydibbendbWf2ua3EQlYiqzWEco68-0b0sFQKYzVlTnKEdKK88tTY0p9H3sorTK3U-95WIgjGs3iUxJCMXl7EvovHqlpwlh6v4SB4RmEyTU5hepnA9N3FxVHwbNGc1F_jy-k8mY0m0wTWRF3hBt7OJm9Gs4_wR_wRDiiM5uPDo-DZZPoq_gBrsiAsW8PBwp8Hh2dBMLpI4tnO8JPp7_E4gXkySibzZDKew_NPAQDA3_63--nRVeFfeL0hREf3x82d1hvCp7vD2r539_15214jtZgRantD6J1E_dMw6odRH6L-MIqGUdTbMnZvFib8U6kSDtCPtmN7xfPPWrtRLrHeNtgL_i1wG-aE_M7hyaB_MvD_--fo_5a8-CEl-wx_XNXB5-dne7i5cdys_sPNVRs3Nzu4Wd1y84HdiuTO8vXlLJ78Oq0tV4cwi1_Hs3g6judwy88Dek9sh_PEXnUTe7OT2L7e-MPbi9FkCgeXb5MjiKfvD2EeXzjbn-D17PINbODP3-JZDBWcw-AsCMMwDPyDZBPA95ub7zffvt98gzsFsUN40R_CpxcDCOHF4HPwbwAAAP__4_2dgw==

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6IUjn-YQgc5MJ11c1b6hS22rUoCoKWjmQuFMmSlGtnGNCHyBP2SQZSSmJjlpVhaC6CiDnf-fudjwxDeI_aMCmGMJbpjZY0Xb56CbjGdFExnqEGi8bCqrYKgjAEyrn8SpRGRTUSaohUlihOBSypAbtEyDCnFbeworzCIcg8d7hUGktMSoUhX5ldksaKpJITw26xA55Rl8mGt9pN5tcn8ObVR2_c-GbCHvR9vm1sNRWGppZJQZRmUjO7aQMKqUvK29BfKsqZ3RCZE4N6xdLWBDQWFae6zZFGmhEpeGse983Zg60Mkly6YaH2jkyXE6Yx9fOoSkF1MysUdMEx68Samhd5xTmxDlLjD-HmceKA1nzhcOlOLgAei7m3pJWVLkSdCGGl4ixllhjkLt1calIpx47WUGIffLtVzseC2nRJjKUWSxS2PfEdb8KgtiSnxhJF7fJJoLLilin3h8xYzlLqcjCOLL5vXR1rvNyy4pYW5A_JxIHmNYHXyrWKioywQkiNREhLVsww56keuCFMkFSqg1Rz8VnmC99poEHj9IFYVqKsLFxCtDedyDy6-BeYMAQmLOoV5QclQEljC40ewKkusKajIyLR8mvrTPtRFHmMTJvFVZaV7BYzoqi2zNWIGWEiw7X3dmDOrj4u05sn1iVcglJnqDEjnBrbsWhusT3bicalLNHV1bmjngROpo3irBZhwlnJWoOdRf8_bzC-D7pRE40pNQd3w5W_i1oyY2WhaWk6eboL9HvibwdLu_ZxF7nNbj807NI-VRCri_LUsJJx6pSf2KVGs5S8ta3R6cBDNeaoCZfyplJ-H40XlPymM6iWihZulkyoytY0YKLo2kCN3rKJVQ_yEn4a7O2sn6P5womhOTbc6VTlBxl8Iovd1cxEQR7H4G97hdpWeuEFrrWL-_HuQnHj0xVHorRc0AXjBy7kFjeaikyWxGD7dtRIVuKtFK3K8i4Ze7MtzbvvzCG3lVjISmS1jlDOkXffih6WSmGspszJjpBOmFeeGlsa9MSbeYWplfrQ-0oEwXgWj5IYktHLq9h38VRVC87S0zUcBc8oTKbJOUyvE5i-u7o6CZ4tmpP6a3w9nSez0WSawJqoG9zA29nkzWj2EX6LP8IRhdF8fHwSPJtMX8UfYE0WhGVrOFr48-D4IghGV0k82xt-Mv01HicwT0bJZJ5MxnN4_ikAAPjT_3Y_Pboq_CuvN4To5PG4udd6Q_j0cFjb9x6-P2_ba6QWM0Jtbwi9s6h_Hkb9MOpD1B9G0TCKelvG7t3ChH8uVcIB-tF2bC96_mlrN8ol1tsGe9G_B27DnJg_ODwb9M8G_n9_nfzXkhc_pGSf4Y-rOvj8_OIANzeOm9U_uLlq4-ZmDzere27u2K1I7ixfX8_iyc_T2nJ1DLP4dTyLp-N4Dvf8PKKPxHY4T-xVN7E3e4nt640_vL0aTaZwdP02OYF4-v4Y5vGVs_0fvJ5dv4EN_P5LPIuhgksYXARhGIaBf5RsAvh-d_f97tv3u2_woCB2CC_6Q_j0YgAhvBh8Dv4OAAD__x1TneU=

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYYoleNhCBzkwnXVzVvqFLbatSgKgpaOZC4UyZKUa2cY0IfIE_ZJBlJO4iCWlGFoLoKIOd_5_c5HhiG8R22YFEMYy_RKS5ouX70EXGO6qBjPUINFY2FVWwVBGALlXH4lSqOiGgk1RCpLFKcCltSAXSJkmNOKW1hRXuEQZJ47XCqNJSalwpCvzC7J1oqkkhPDrrEDnlGXyYY32k3ml0fw5tVHb7z1zYRt9X26a2w1FYamlklBlGZSM7tpAgqpS8qb0F8qypndEJkTg3rF0sYENBYVp7rJkUaaESl4Yx63zdmDrQySXLphofaOTJcTpjH186hKQfV2VijogmPWiTU1L_KKc2IdpMa34eZx4oDWfOFw7k7OAO6LubWklZUuRJ0IYaXiLGWWGOQu3VxqUinHjsZQYh98t1XOx4LadEmMpRZLFLY58QfehEFtSU6NJYra5ZNAZcUtU-4PmbGcpdTlYBxZfN-6Orb1cs2Ka1qQvyQTLc3bBl4r1yoqMsIKITUSIS1ZMcOcp3rghjBBUqlaqebis8wX_qCBBo3TB2JZibKycA7R3nQic-_iP2DCEJiwqFeUt0qAksYWGj2AU11gTUdHRKLl18aZ9qMo8hiZbhdXWVaya8yIotoyVyNmhIkM195by5xdfVymV0-sS7gEpc5QY0Y4NbZj0dxie7YTjUtZoqurc0c9CZxMG8VZLcKEs5I1BjuJfj7dYnwf9FZNNKbUtO6GK_8hasmMlYWmpWnn6WOkXxR_PVhqO9CPkt1luB8cdumfKojVRXlsWMk4depP7FKjWUre2NroeOChGnPUhEt5VSm_k8aLSn7VGVRLRQs3TyZUZWsqMFF0baFGb7mNVQ_zHH4Z7O2Pn6X5womhOW7506nMd1L4RCa765mJgtyPwd_4CrWt9MKLXGMX9-PdpeLGpyuORGm5oAvGWy7lBjeaikyWxGDzhtRIVuK1FI3q8i4Ze7Md3bvtTJvbSixkJbJaSyjnyLtvRg9LpTBWU-akR0gnzitPjR0deuLtvMLUSt32xhJBMJ7FoySGZPTyIvZdPFbVgrP0eA0HwTMKk2lyCtPLBKbvLi6OgmeL7Un9Nb6czpPZaDJNYE3UFW7g7WzyZjT7CH_EH-GAwmg-PjwKnk2mr-IPsCYLwrI1HCz8eXB4FgSjiySe7Q0_mf4ejxOYJ6NkMk8m4zk8_xQAAPztf7ufHl0V_qXXG0J0dH-8vdt6Q_h0d1jb9-6-P-_aa6QWM0Jtbwi9k6h_Gkb9MOpD1B9G0TCKejvG7u3ChH8yVcIB-tFubC98_nlrN8ol1tsFe-G_Be7CnKDfOTwZ9E8G_n__HP3fkhc_pGSf4Y-rOvj8_KyFmxvHzeoRN1dN3Nzs4WZ1y80HdiuSO8vXl7N48uu0tlwdwix-Hc_i6Tiewy0_D-g9sR3OE3vVTezNXmL7euMPby9GkykcXL5NjiCevj-EeXzhbH-C17PLN7CBP3-LZzFUcA6DsyAMwzDwD5NNAN9vbr7ffPt-8w3uFMQO4UV_CJ9eDCCEF4PPwb8BAAD__5j8nkc=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1P5EgMvfevqOPuaoIamBnYQRzYnqyEBM0sNGj2ZFUnTuKlUlXtcpqPX7-qSjOARDpwi8DPdvk9P3eWqRvkQM5-UzNX3LLTRfP9L4X3WCw7MiWyEgyi1n3UZJJlShvj7sAzes0IOoDzAt5oqxodlDSoSqx0Z0Sttenwm3JVFXGFCwKh0DbAHUkDmygonIFAjzgCL3Xs5MEMxp1eXXxS59__TcGb3GRla-7Dl8HC2gZdCDkLnskxycMQ0DputRlCrzptSB7AVRCQ11QMNsBYd0bzUCJGXYKzZrCPp-G8ge0CQuUiWcgpURhLQoxF4qNrreYNV2j10mA5ig29LqrOGJAI6fHbcFf5IgIlrIw6jn85Uur5MU-RuhMXS_SNALXeUEECAU1st3IMnY_qGCxl34K_HFXMsdRSNBBEC7ZoZbjxV9lsQBaodBDwWpp3gdrOCPn44UqqqNCxhxDFkuY2MulNkkeqH3UN_zka3ru-6L2PY9K2BKqtYwTrBNYUKKbpyQ5AFgrnt8osskVlevSr4QUM0RtAqEXXiTpW0zd5nIbnFB_AZJkiK8hrbbauv3dBasYEMJpr7KUYRQjs7gb53J1Opwnjis3SeqGWHrEEr1kovhFLIFvifcq2ZdzxfcYVt-98l40NOi6RsQSjg4xQH5c6KR0YG9difNfofiYRRIsO3lBvwGCopcFie9PPhxtMmgNvnISx0GFsL16DGgriatbth1BpP9JVEP2xei-VnQjDMc_zNQjX7U6gloyOjg_SMIbGmcGRTnf2E5SxQgbj3G3n0yKGZCTV7WhRdl7XkUeyvpNeAmTrse1jTJGbWj2Jx-rr_psSSxyGlYGgK9zoZtSNf9nfOxUcTzLZGp5pSFfeI0vHy2Rsg1N8Gx8PSaSPO4Pg2S31ksyWQzyQhrUtXQsBhzejR1KLj84Ousr1YpbCXvjd02S2pe3s0nW27D1EG4Nm_BomWOFsENYULce6aMrrJI0X_vPOi7zGQhxv-11lJ5PZZX6yyNVV_s91Pp_lyndLQ8VOwJU6P53fnJxd52pXnZ_87D__3Nvb3z_Ym-5_Pfzy-eDgy-H0QJ3OZ5f5eT5fqF11tTi5XKjdo8kk__nj7OR0rn67-LH4pPL5ze_qKj_LZwv1h_r78uJcBVwdTbIsyyYBVx3aArP-oMf_TP4PAAD__1QMxpg=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCb2gdWIscHB4GDAMd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnThby06xaC4Cm55vfr_5SN-Ht6g0k2IAI5lcK0mTxYvngEtM4pLxFBUY1Aaq2srzfB8o5_ILKRQWVCGhmsjCkIJTAQuqwSwQUsxoyQ1UlJc4AJllFpdIbYhOqNDkCzMLsrYiieREsxs8AE-pzWTFG-3Gs6suvHrxwRmvfTNh9vo-2zY2igpNE8OkIIViUjGzagIKqXLKm9CfS8qZWRGZEY2qYkljAgrnJaeqyZFCmhIpeGMem-bswJYaSSbtsFA5R_qQE6YwcfMoc0HVelYoaMwxPYjVNS-yknNiLKTG78PNwsgCjf7M4cKenAM8FLOxpKWRNkSdCGF5wVnCDNHIbbqZVKQsLDsaQ4ld8O1WWR8xNcmCaEMN5ihMc-KPvAmNypCMakMKahZPAuUlN6ywH2TKMpZQm4O2ZHF9O9DptZMbNr-hc_KbZM17VwddFrZNVKSEzYVUSIQ0pGKaWTf1sDVhgiSy2EszOy2WuqIfNU-jttpADMtRlgYuINg5x0A_uPgOjO8DEwZVRfne9S-kNnOFDsCpmmNNRUtCouSXxnn2giBwGJmsl7YwLGc3mJKCKsNsjZgSJlJcOm972m3r4zK5fmJdwiYoVYoKU8KpNgdGb5faMZ0oXMgcbV0H99ORwEq0LjirBZhwlrPGYKfBf8_WGNcHtVYShQnVh_biMWjBtJFzRfPvQrn9cLeCod8Xb5vZbmB4SPOKOTFqnh9rljNOreITs1CoF5I3tjQ47juowgwV4VJel4VbRO2EJLs-GFTJgs7tHJkoSlNTgIn5oe1T6CzXseohXsD_-jsp5maoP3OiaYZr3hxU43v5eyKD7ZXMxJw8jMHd8gUqU6rYCVtjF3fj7UVix6dKjqRQMqYx43su4gY3iopU5kRj82bUSJbjjRSNqvImGjmzLb3bdGaf21LEshRprSGUc-SHb0MHS6TQRlFmJUdIK8qVo8aW_jzxRq4wMVLte1cJzxtNw2EUQjR8fhm6Lh4XZcxZcryEtndEYTyJzmByFcHkzeVl1zuK1yf1t9HVZBZNh-NJBEtSXOMKXk_Hr4bTD_Br-AHaFIazUafrHY0nL8L3sCQxYekS2rE79zrnnje8jMLpzvDjyS_hKIJZNIzGs2g8msGzjx4AwO_uv_1r0WruXnetAQTdh-P1ndYawMf7w9q-df_907a9QmowJdS0BtA6DXpnftDzgx4EvUEQDIKgtWVs3ytMuGdSKSygF2zHdornnrRmVdjEWttgJ_gb4DbMCvm9w9N-77Tvfvuj-29Ljn9IyS7DH1e19-nZ-R5uriw3y2-4WTVxc7WDm-WGm4_sKpJZy5dX03D806S2rDowDV-G03AyCmew4WebPhDb4hyxq8PEXu0k9na9b8fhu02Yym2h3buud1TaGr0ODGcwCy-tD9qFuAtlFyp4Ob169XiDuv-I--7ncBpCDBfQP_e88P3ry-F4Au2r11EXwsnbzsbpf2pf1bnn-77vMSFQ-e6Z2U6U1Lrjwd3tX3e3X-9uv4J7D62-OVn-f73s9pc_7Uzvbm_XBvcKZwZwcnrSG8DHkz74cNL_5G2ZZYwbVBraRpXY8f4OAAD__0kv3pM=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVl9v47YTfD59Cr7d3Q_nwL9eUQQX5MHncwG3jhPYukODoiDW0krehiKZ5cr58-kLUk6TFJGVvBnGznC5MzvUaKR-IAdy9ouauuKKHRTbb18V3mKxacmUyEowiNp1VVk2Gikwxt1oz-iBUUPQzov2BqzaQlCyRVViBa0RtQPT4hflqiriChdEhwJs0DckW72v0oUzOtA9DsBLiJ3cmd66-fr8kzr7dpmK99xk5SD38dNiYbABCiFntWdyTHLXB7SOGzB96OsWDMmddpUOyDsqehtgrFsD3EfECKV21vT28TCcF7BtQF25KBZyIgpDJMRYJD3axgLvtUILG4PlIDZ0vqhaY7RESIc_hFvP8giUcG3UafznRKnHyzxUQisuHtE1oqnxhgoSHdDEdivHuvXRHb1H2ZfgT0cVOTYgxVYHAcEGrfQ3_ozNBmTRFQTRHmT7KlDTGiEff7iSKiog9hCiWdLcBia9J7mn-h5q_bej_r3rDr31cUxgS021dYzaOtE7ChRpOrGDJqsL5w_aLKpFZbr0s-EFDDEbtFCDrhV1qsYv6jgOjxRvwIxGiqwg78AcXH_vgtSMCWCAa-ysGE2o2d306vn_8XicMK7YL60XaugeS-2BheIdsdRkS7xNbAfGHe9nXHH1ynvZ2KDjEhlLbSDIgPRxqZPTNePWNRjvNbifyQQxooM31AWwNtRQ72E_jX8-3mPSHHifJIwFhKG9eA7aUhBXMzRvQqX9SK-CwNvOe-rsJBgOZZ6vtXDdHAVqyEBMfC1bxrB1pnek46PPCcpYIWvj3FXr0yKGFCTV1eCh7DzUUUeyvpXOAmTroe1jTJX7szoRT9Uvn1-0WNIwXBsdoMK9bwbT-N_4e6WD45NMttaPMqRX3iNLy5sUbL1TfBkfH5IoH7cGtWe3gQ2ZAw9xDw2DLV2jA_ZvRoekBu-d7U2V7_k0lT3Ju4fJHKJt7ca1tuwyBIxBM_waJljhbBAGipFjXQzlXbLGk_x55Yu8w0IcH_quslk2Xc0m-Uzlk6-LWZriUTgS9SF7B2q-zI_V8jxXy--Lxafs3fR8uc5Xk_kyV6L9Fd6pi9X8bLK6VL_PLtUHUJP19GP28STLJot8tvov53z522yaq3U-yefrfD5dq_d__vX-JMtmf1wsJvOl-nB-kX9Ss-WPj2o9W8Ta_6lfV-dnKhzJSTYajUZZSl_J_gkAAP__RyrNHA==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1uG0cMvusp5mgDViA3RREk8CFNfAiQJgHsGO2JoHa5K9azwzGHK_-c8hB-Qj9JMbNyLQNarX0TBH4kh9_HjzufuwvSxBLeu09SXapgtfr8p6MbqpY9-5rUGSVz6yFqNpvPHXov1xCVIioBJpBoED0Gt8LkbEWupgZ7b26Nvqf3Tpom4ypJBqnCkOCabQWbKKjEQ-I7moDXmDu59aNxX86-H7m_Pv9Tgje5Odje3O-2g00xJKyMJUBUFmW7HQMG0Q797Oz0fCf8qkfPdgvSQCJdc0XuxC2xumxV-lB_cO6p7mNKpbb3qGMdKWENEvxoS49z2oHtE0EjmTfSkihNJWGlqlDTdwF1QxsFXHqqJ7FpkEjTew-WIQN-H64MkpOlK-9O8j87R4S9SS4xNALcRc8VGyTyud1GFPqYhTJaKuyCb48q51iiVStIhkYdBRtv_Fm2kEgNGkwGEW31IlDXe-OYf0jNDVeYe0hZNmVuE5PeJLnj9g5b-Fd4fAWHojcxjwlDDdwGUYIgBmtOnNMMZCfgAJXEvTLLbHFdHv1seIlStgkw7kh6cydusZPHRXpK8QrMfO44GOka_V4niJKsVSoAj9rSIMUsQlC5HuXzeLFYFIxUm_WNxh3fUQ0R1Ti_kWrgUNNNybZn3Pl9XqrLF74r5AZFa1KqwWOyCerzUhelg9JKOsrvmtzPIoLs1il6HrwYPHc8Wuy3xe_vNpgyB904iVKFaWovnoNWnExaxe5VqLIf5UAYvq7etrILYTTlebEF07Z7k7hjj9n8wVZKaSV-dKSLN28LVKkhBS9y2ceyiKkYSXM5WVQlYpt55BB7GyTAoZ3aPqUSuak1kHji_ni7U2KFw3TlIWFDG91MuvH_9vdCBefrzKGFJxrKwY-k1uuyGNvoFHfj8yHJ9GnvCaLKEpfs99zkkTSKoZYOEo1vxoDkju4kjLrKz_NPJWzL7x4nsy9tH5b55A8egt6Tn76GBVZJSKbI2XKCZFNeF2ls-c8LL_KaKhPd94kVZrPTv398_fjlmzv4_uP8yJ1-uzh0Fx-__jw9cwfHhx9m8_l8PivhaeYe7u8f7n893P9yB8dHh7P_AgAA__-PPLKV

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1uG0cMvusp5mgDViA3RREk8CFNfAiQJgHsGO2JoHa5K9azwzGHK_-c8hB-Qj9JMbNyLQNarX0TBH4kh9_HjzufuwvSxBLeu09SXapgtfr8p6MbqpY9-5rUGSVz6yFqNpvPHXov1xCVIioBJpBoED0Gt8LkbEWupgZ7b26Nvqf3Tpom4ypJBqnCkOCabQWbKKjEQ-I7moDXmDu59aNxX86-H7m_Pv9Tgje5Odje3O-2g00xJKyMJUBUFmW7HQMG0Q797Oz0fCf8qkfPdgvSQCJdc0XuxFXKxhX6D849VX1MqNT2HnWsHyWsQYIfbehxSjuwfSJoJLNGWhKlqSSsVBVi-i6gbkijgEtP9SQ2DQJpeu_BMmTA78OVMXKydOXdSf5n54iwN8klhkaAu-i5YoNEPrfbiEIfs0xGS4Vd8O1R5RxLtGoFydCoo2DjjT_LFhKpQYPJIKKtXgTqem8c8w-pueEKcw8pi6bMbWLSmyR33N5hC_8Kjy_gUPQm5jFhqIHbIEoQxGDNiXOagewEHKCSuFdmmS2uy6OfDS9RyiYBxh1Jb-7ELXbyuEhPKV6Bmc8dByNdo9_rA1GStUoF4FFbGqSYRQgq16N8Hi8Wi4KRarO80bjjO6ohohrnN1INHGq6Kdn2jDu_z0t1-cJ3hdygaE1KNXhMNkF9XuqidFBaSUf5XZP7WUSQvTpFz4MTg-eOR4v9tvj93QZT5qAbJ1GqME3txXPQipNJq9i9ClX2o5wHw9fV21Z2IYymPC-2YNp2bxJ37DFbP9hKKa3Ej4508eZtgSo1pOBFLvtYFjEVI2kuJ4uqRGwzjxxib4MEOLRT26dUIje1BhJP3B9vd0qscJiuPCRsaKObSTf-3_5eqOB8mzm08ERDOfeR1HpdFmMbneJufD4kmT7tPUFUWeKS_Z6LPJJGMdTSQaLxzRiQ3NGdhFFX-Xn-qYRt-d3jZPal7cNS-lAPHoLek5--hgVWSUimyNlygmRTXhdpbPnPCy_ymioT3feBFWaz079_fP345Zs7-P7j_Midfrs4dBcfv_48PXMHx4cfZvP5fD4r4WnmHu7vH-5_Pdz_cgfHR4ez_wIAAP__KjGxwA==

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iQE4-LAIHuXBddeHd1ClstWhRFAQljWSuKZIlKdX2Yt99QcpJHFSyEiyaiyBi5szvmUMOh_AJtWFSjGEq07WWNF29fQO4wTSpGM9Qg0VjoW6sgmA4BMq5_EGURkU1EmqIVJYoTgWsqAG7QsgwpxW3UFNe4RhknjtcKo0lJqXCkB_MrsjeiqSSE8N22APPqMtkyzvtZsu7M3j_9os33vtmwh71fXVobDUVhqaWSUGUZlIzu-0CCqlLyoNlFLfCv1eUM7slMicGdc1ShBtINbMspfwa4DHqvUONRcWp7spHI82IFLwzofsutWArgySXbmqovSPT54RpTP1gqlJQvR8aCppwzHqxpiFIXnFOrIM0-GM430ZmrPnO4cadtLaIVla6EE0ihJWKs5RZYpC7dHOpSaUcTTpDiTb4Yaucj4TadEWMpRZLFLY78SfehEFtSU6NJYra1bNAZcUtU-4PmbGcpdTlYBxpfN96Or13smPFjhbkL8m6F7AJulGuTVRkhBVCaiRCWlIzw5ybZtiGMEFSqY7SzE2LZb7oJ80zaJxIEMtKlJWFGwhb5xiaRxcvwAyHwIRFXVN-VAeUNLbQ6AGc6gIbKjoSEi1_dM5zFIahx8h0v7zKspLtMCOKastcjZgRJjLceG9H2u3q4zJdP7Mu4RKUOkONGeHU2J7Ru6X2TCcaV7JEV1fvfnoSOK02irNGiQlnJesMdhH-_2qP8X3QeyXRmFLTtxdPQStmrCw0LV-E8vvhrwdLXxbvkNl-YNineaogVhfluWEl49RJP7ErjWYleWdLw_NLD9WYoyZcynWl_CIaLyT5ujeolooWbo5MqMo2FGCi6Ns-jd5yH6sZ4g38dtlKMT9D850TQ3Pc86ZXjR_k75kMdnczEwV5HIO_7hVqW-nEC1tnF9vx7iJx49MVR6K0TGjC-JEbucONpiKTJTHYvRkNkpW4k6JTVT7GU292oHf3nTnmthKJrETWaAjlHHn_behhqRTGasqc5AjpRLn21DjQn2feyDWmVupjDywRBNNFNIkjiCdvbiPfxXNVJZyl5xs4CV5RmM3jK5jfxTD_eHt7FrxK9ifN1_RuvowXk9k8hg1Ra9zCh8Xs_WTxBf6MvsAJhclyenoWvJrN30afYUMSwrINnCT-PDi9DoLJbRwtWsPP5n9E0xiW8SSeLePZdAmvvwYAAH_73-5nQOvCP_MGYwjPHo_3d9pgDF8fDhv7wcP3t0N7jdRiRqgdjGFwEY6uhuFoGI4gHI3DcByGgwNj915hwj-TKuEAo_Awtlc8_7a1W-USGxyCveDfAw9hTsgfHF5cji4u_f_-OfuvJSe_pGSf4a-rOvj2-voIN7eOm9VP3Ky7uLlt4WZ1z80ndjXJneW7u0U0-33eWNansIjeRYtoPo2WcM_PE_pIbIfzxK77ib1tJfbxeneuXrX-qWCNeVfJu5aS1bql5nz9tFqNeVu925PqeF277rqizx9uJ7M5nNx9iM8gmn86hWV062z_B-8Wd-9hdx0Mh8Nh4B9Xu-DfAAAA__9JlcuB

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iQE4-LAIHuXBddeHd1ClstWhRFAQljWSuKZIlKdX2Yt99QcpJHFSyEiyaiyBi5szvmUMOh_AJtWFSjGEq07WWNF29fQO4wTSpGM9Qg0VjoW6sgmA4BMq5_EGURkU1EmqIVJYoTgWsqAG7QsgwpxW3UFNe4RhknjtcKo0lJqXCkB_MrsjeiqSSE8N22APPqMtkyzvtZsu7M3j_9os33vtmwh71fXVobDUVhqaWSUGUZlIzu-0CCqlLyoNlFLfCv1eUM7slMicGdc1ShBtINbMspfwa4DHqvUONRcWp7spHI82IFLwzofsutWArgySXbmqovSPT54RpTP1gqlJQvR8aCppwzHqxpiFIXnFOrIM0-GM430ZmrPnO4cadtLaIVla6EE0ihJWKs5RZYpC7dHOpSaUcTTpDiTb4Yaucj4TadEWMpRZLFLY78SfehEFtSU6NJYra1bNAZcUtU-4PmbGcpdTlYBxpfN96Or13smPFjhbkL8m6F7AJulGuTVRkhBVCaiRCWlIzw5ybZtiGMEFSqY7SzE2LZb7oJ80zaJxIEMtKlJWFGwhb5xiaRxcvwAyHwIRFXVN-VAeUNLbQ6AGc6gIbKjoSEi1_dM5zFIahx8h0v7zKspLtMCOKastcjZgRJjLceG9H2u3q4zJdP7Mu4RKUOkONGeHU2J7Ru6X2TCcaV7JEV1fvfnoSOK02irNGiQlnJesMdhH-_2qP8X3QeyXRmFLTtxdPQStmrCw0LV-E8vvhrwdLXxbvkNl-YNineaogVhfluWEl49RJP7ErjWYleWdLw_NLD9WYoyZcynWl_CIaLyT5ujeolooWbo5MqMo2FGCi6Ns-jd5yH6sZ4g38dtlKMT9D850TQ3Pc86ZXjR_k75kMdnczEwV5HIO_7hVqW-nEC1tnF9vx7iJx49MVR6K0TGjC-JEbucONpiKTJTHYvRkNkpW4k6JTVT7GU292oHf3nTnmthKJrETWaAjlHHn_behhqRTGasqc5AjpRLn21DjQn2feyDWmVupjDywRBNNFNIkjiCdvbiPfxXNVJZyl5xs4CV5RmM3jK5jfxTD_eHt7FrxK9ifN1_RuvowXk9k8hg1Ra9zCh8Xs_WTxBf6MvsAJhclyenoWvJrN30afYUMSwrINnCT-PDi9DoLJbRwtWsPP5n9E0xiW8SSeLePZdAmvvwYAAH_73-5nQOvCP_MGYwjPHo_3d9pgDF8fDhv7wcP3t0N7jdRiRqgdjGFwEY6uhuFoGI4gHI3DcByGgwNj915hwj-TKuEAo_Awtlc8_7a1W-USGxyCveDfAw9hTsgfHF5cji4u_f_-OfuvJSe_pGSf4a-rOvj2-voIN7eOm9VP3Ky7uLlt4WZ1z80ndjXJneW7u0U0-33eWNansIjeRYtoPo2WcM_PE_pIbIfzxK77ib1tJfbxeneuXrX-qWCNeVfJu5aS1bql5nz9tFqNeVu925PqeF277rqizx9uJ7M5nNx9iM8gmn86hWV062z_B-8Wd-9hex0Mh8Nh4B9X2-DfAAAA__9JhMt_

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iQE4-LAIHuXBddeHd1ClstWhRFAQljWSuKZIlKdX2Yt99QcpJHFSyEiyaiyBi5szvmUMOh_AJtWFSjGEq07WWNF29fQO4wTSpGM9Qg0VjoW6sgmA4BMq5_EGURkU1EmqIVJYoTgWsqAG7QsgwpxW3UFNe4RhknjtcKo0lJqXCkB_MrsjeiqSSE8N22APPqMtkyzvtZsu7M3j_9os33vtmwh71fXVobDUVhqaWSUGUZlIzu-0CCqlLyoNlFLfCv1eUM7slMicGdc1ShBtINbMspfwa4DHqvUONRcWp7spHI82IFLwzofsutWArgySXbmqovSPT54RpTP1gqlJQvR8aCppwzHqxpiFIXnFOrIM0-GM430ZmrPnO4cadtLaIVla6EE0ihJWKs5RZYpC7dHOpSaUcTTpDiTb4Yaucj4TadEWMpRZLFLY78SfehEFtSU6NJYra1bNAZcUtU-4PmbGcpdTlYBxpfN96Or13smPFjhbkL8m6F7AJulGuTVRkhBVCaiRCWlIzw5ybZtiGMEFSqY7SzE2LZb7oJ80zaJxIEMtKlJWFGwhb5xiaRxcvwAyHwIRFXVN-VAeUNLbQ6AGc6gIbKjoSEi1_dM5zFIahx8h0v7zKspLtMCOKastcjZgRJjLceG9H2u3q4zJdP7Mu4RKUOkONGeHU2J7Ru6X2TCcaV7JEV1fvfnoSOK02irNGiQlnJesMdhH-_2qP8X3QeyXRmFLTtxdPQStmrCw0LV-E8vvhrwdLXxbvkNl-YNineaogVhfluWEl49RJP7ErjWYleWdLw_NLD9WYoyZcynWl_CIaLyT5ujeolooWbo5MqMo2FGCi6Ns-jd5yH6sZ4g38dtlKMT9D850TQ3Pc86ZXjR_k75kMdnczEwV5HIO_7hVqW-nEC1tnF9vx7iJx49MVR6K0TGjC-JEbucONpiKTJTHYvRkNkpW4k6JTVT7GU292oHf3nTnmthKJrETWaAjlHHn_behhqRTGasqc5AjpRLn21DjQn2feyDWmVupjDywRBNNFNIkjiCdvbiPfxXNVJZyl5xs4CV5RmM3jK5jfxTD_eHt7FrxK9ifN1_RuvowXk9k8hg1Ra9zCh8Xs_WTxBf6MvsAJhclyenoWvJrN30afYUMSwrINnCT-PDi9DoLJbRwtWsPP5n9E0xiW8SSeLePZdAmvvwYAAH_73-5nQOvCP_MGYwjPHo_3d9pgDF8fDhv7wcP3t0N7jdRiRqgdjGFwEY6uhuFoGI4gHI3DcByGgwNj915hwj-TKuEAo_Awtlc8_7a1W-USGxyCveDfAw9hTsgfHF5cji4u_f_-OfuvJSe_pGSf4a-rOvj2-voIN7eOm9VP3Ky7uLlt4WZ1z80ndjXJneW7u0U0-33eWNansIjeRYtoPo2WcM_PE_pIbIfzxK77ib1tJfbxeneuXrX-qWCNeVfJu5aS1bql5nz9tFqNeVu925PqeF277rqizx9uJ7M5nNx9iM8gmn86hWV062z_B-8Wd-9hcx0Mh8Nh4B9Xm-DfAAAA__9Jc8t9

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHuXBddeHd1C5stWhRFAQtjWSuKZIlKdf2Yt99QUpJHFSyEiyaiyBi5szvmUMOBvAJtWFSjGAik42WNFm_fQO4w2RVMp6iBovGwrayCoLBACjn8gdRGhXVSKghUlmiOBWwpgbsGiHFjJbcwpbyEkcgs8zhEmksMQkVhvxgdk1qK5JITgw7YAc8pS6TPW-1my7n5_D-7RdvXPtmwp70fX1sbDUVhiaWSUGUZlIzu28DCqkLyoNlFDfCv5eUM7snMiMG9ZYlCLeQaGZZQvkNwGPUe4ca85JT3ZaPRpoSKXhrQvddasCWBkkm3dRQe0emywnTmPjBlIWguh4aCrrimHZiTUWQrOScWAep8Kdwvo3MWPOdw607aWwRLa10IapECCsUZwmzxCB36WZSk1I5mrSGEk3w41Y5HytqkzUxllosUNj2xJ94Ewa1JRk1lihq188CFSW3TLk_ZMoyllCXg3Gk8X3r6HTt5MDyA83JX5K1L2AVdKdcm6hICcuF1EiEtGTLDHNuqmEbwgRJpDpJMzctlvqinzTPoHEiQSwrUJYWbiFsnGNoHl28ADMYABMW9ZbykzqgpLG5Rg_gVOdYUdGRkGj5o3WewzAMPUYm9fIqywp2wJQoqi1zNWJKmEhx572daLerj8tk88y6hEtQ6hQ1poRTYztG75baM51oXMsCXV2d--lJ4LTaKM4qJSacFaw12GX4_-sa4_ugayXRmFDTtRdPQWtmrMw1LV6E8vvhrwdLXxbvmNl-YNileSonVufFhWEF49RJP7FrjWYteWtLw4srD9WYoSZcyk2p_CIaLyTZpjOolormbo5MqNJWFGAi79o-jd6yjlUN8RZ-u2qkmJ-h-c6JoRnWvOlU4wf5eyaD3d3MRE4ex-Cve4Xalnrlha21i814d5G48emSI1FaruiK8RM3cosbTUUqC2KwfTMqJCvwIEWrqnyMJ97sSO_uO3PKbSlWshRppSGUc-Tdt6GHJVIYqylzkiOkE-Wtp8aR_jzzRt5iYqU-9cASQTBZROM4gnj85i7yXbxQ5Yqz5GIH_eAVheksvobZPIbZx7u78-DVqj6pvibz2TJejKezGHZEbXAPHxbT9-PFF_gz-gJ9CuPl5Ow8eDWdvY0-w46sCEt30F_58-DsJgjGd3G0aAw_nf0RTWJYxuN4uoynkyW8_hoAAPztf7ufHt3m_pnXG0F4_nhc32m9EXx9OKzsew_f347tNVKLKaG2N4LeZTi8HoTDQTiEcDgKw1EY9o6M3XuFCf9MKoUDDMPj2F7x_NvW7pVLrHcM9oJ_DzyGOSF_cHh5Nby88v_75_y_lrz6JSX7DH9d1cG31zcnuHlw3FSbn8ipMWuj56GBnmpzz88jw2wD7-aLaPr7rDLSmJ3BInoXLaLZJFpCncK-X54m8KGRwKfr2ru6yp_K2rYVtW8oqmyoaU-2JHOWTyrbNtW169OOhjTCDn21eVx0F88v-rZ70fftfYo-f7gbT2fQn3-IzyGafTqDZXTnbP8H7xbz97C_CQaDwSDwj7J98G8AAAD__-HT20M=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9vGjkQfu7-FSNemp5CtCG9u5QoD5RQiTsKVdhWrapq5N0dlrl47Y3tJT9O97-f7CUNkVhIHu54QGDPNx5_M_ONu134QsayVn0Y6uzKaJEtL94D3VKW1ixzMuDIOlg1VlHU7YKQUt9gZagShlBY1JXDSgoFS2HBLQlyWohaOlgJWVMf9GLhcZm2Dm0mlMUbdktcW2GmJVq-pz3wXPhI7mSr3Xg-O4SPF9-C8do3K7fT9-mmsTNCWZE51gorw9qwu2sDKm1KIaP5KNkKv66FZHeHeoGWzIozgnPIDDvOhDwDeDz1waGhopbCtMVjSOSolWwN6IGlLdjaEi60zxqZ4Mjuc8KGspCYulTCrJNGSqSS8r1Y2xTIopYSnYc0-F24QCNbZ68lnPuVrRSJ2ml_RBMIcllJztihJenDXWiDdeXLpPUotQ2-SZX3kQqXLdE64agk5doDf-JNWTIOF8I6rIRbPgtU1tJx5X_onBecCR-D9UUTeNvD9NrJPRf3osC_NLc3YHPobeVpEipHLpQ2hEo7XLFl76ZJtkVWmOlqZ5n5bHEeLv2EPEvWiwQ6LknXDs4h3prH2D66eAGm2wVWjsxKyJ06UGnrCkMBIIUpqClFX4Ro9E1rPo_jOA4Yna2bt3Jc8j3lWAnj2N-RcmSV023wtoNufz-ps6tn3kv5ALXJyVCOUli3J_W-qUOlo6GlLsnfa29_hiLwWm0ryY0So-SSWw_rxW9P15jAg1kriaFM2H198RS0ZOt0YUT5IlTojzAenHjZeZuVHRJG-zSvKtCZojyyXLIUXvrRLQ3ZpZatlMZHJwFqaEEGpdZXdRUa0QYhWVztPdToShQ-j6yq2jUlwKrY132GguX6rCaJ5_DbydYSCzm01xKtWNC6bvaq8U_5e2YF-9nMqsDHNIRxX5FxtUmDsLWyuB3vB4lPn6klYWV0KlKWOyZyixsjVK5LtNTeGQ2SS7rXqlVVPifDYLahdw_M7HJbq1TXKm80REhJcv80DLBMK-uMYC85SntRXoXS2NCfZ07kFWVOm10PLBVFw8vRIBlBMng_GQUWj6o6lZwdpXAQvUrh_Ww2geksgennyeQwemX0DecwnianYfXLeD72yAcLuBh9GHyeJFArvq6DPnF-8OYwejWcTefJ5WA8TSDF6oru4NPl-OPg8hv8OfoGB43fwXzobcfTi9FXSDFFzm_hIA3r0ZuzKBpMktHl1mjH0z9GwwTmySAZz5PxcA6vv0cAAH-Hb__piFURXoWdPhwfPi6vR2CnD99_LoaNtPPz_49Ne0PCUY7CdfrQ6cW9Xve41417cHzaP3nb7707-vX3t-9Oep0NjH_lsAqPq1p5XG9jM6hkeA-7u8pH19mEKlGGNUT_EEJ8sucHyIPLeGPDD4aH9ePjOA47_xzuYCR-DiMhTf8hK_H_x8qakujH67MoGn39NBmMp3Aw-5Qcwmj65Q3MRxNfUL_Ah8vZR0jPom63243C_E-jfwMAAP__w9drFw==
