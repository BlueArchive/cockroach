# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvq6eYuCbpgd2IsfnInBQYF1Xi_Wu6xS22m0QBAQljWRuKJIhKcfJYoE-RJ4wT7IgpSQuEFktFvWFYdLzze83MxwM4DNqw6QYw1SmV1rSdP3-HeAW06RiPEMNFo2FTS0VBIMBUM7lDVEaFdVIqCFSWaI4FbCmBuwaIcOcVtzChvIKxyDz3OFSaSwxKRWG3DC7Jo0USSUnht1hBzyjzpNb3io3W5314cP7cy_c6GbC7tV9sitsNRWGppZJQZRmUjN72wYUUpeUt6GvK8qZvSUyJwb1hqWtDmgsKk51myKNNCNS8FY_HpPzArYySHLpioXaKzJdSpjG1NejKgXVTa1Q0IRj1ok1NS_yinNiHaTG78OtotgBrbnm8NbdnAI8B_MoSSsrnYnaEcJKxVnKLDHInbu51KRSjh2tpsRL8N1UOR0JtemaGEstlihsu-PfaBMGtSU5NZYoatffBSorbplyP2TGcpZS54NxZPF568h0o-SOFXe0IH9J1t53tdGtcmmiIiOsEFIjEdKSDTPMqamLbQgTJJWqi2ZMWNQbyvf2oZLGFhqNA3CqC6w54dhAtLxpTewwDEOPkWnTPcqykt1hRhTVlrksYUaYyHDrte2PWzijUmeoMSOcGtsRm-sYTyOicS1LdL52kt9bcvPPKM7q6UY4K1mrsePw_ycNxsemmzbVmFLTRbpvQWtmrCw0LX8I5cnnR66lP2Zvlza-CNg1UFRBrC7KQ8NKxqkbp8SuNZq15K0pDQ9HHqoxR024lFeV8iw3vkvzq06jWipauDoyoSpbU4CJogOm0Qs2pvbW0BfQXHNiaI4Nabq8cruLiYI8p9SvQ4XaVjrxE6A1Iy_j3cR1pdAVR6K0TGjC-J6N1aJGU5HJkhhsZ3mNZCXeSdHa9Z_iqROrRCIrkdU9SzlH3r0GPCyVwlhNmWtxId002viy7fT7d66iDaZW6n0PChEE02U0iSOIJ-_mkc_KoaoSztLDLRwEryjMFvEJLM5iWHyaz_vBq6S5qU_Ts8UqXk5mixi2RF3hLXxczj5MlufwR3QOBxQmq-mbfvBqtngffYEtSQjLtnCQ-PvgzWkQTOZxtHzR_GzxezSNYRVP4tkqnk1X8PoiAAD423-7T49uCv-s6Y0h7D9fN8O8N4aLp8tavvd0vtyV10gtZoTa3hh6x-HwZBAOB-EQwuE4DMdh2NsRdouaCf8-qIQDDMNd234a-becvVXOsd4u2A_jR-AuzA3ZJ4XHo-HxyP_3T_-_hpz8lJC9hz8v6uDy9WkQRF8-ziezBRycfYz7EC0-v4FVNHek-B_8ujz7AFv487doGUECb2F0GgwGg0HgF-L2l4ZrATzc3z_cf324_wpPnWXHcHR8NBzDxdEIBnA0ugz-DQAA__8I2QYk


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEzn5XQQOCsx11c1b6hS22rUoCoKSjmQuFMmSlGtnGFDsGXK5p8uTDKSUxEEjq8XQXAQ2_X3n73cOORzCW9SGSTGGqUwvtaTp6sVzwA2mScV4hhosGgvrGhUEwyFQzuVnojQqqpFQQ6SyRHEqYEUN2BVChjmtuIU15RWOQea546XSWGJSKgz5zOyKNCiSSk4Mu8IOekZdJFveipstLwbw6sV7D25sM2H32j7dBVtNhaGpZVIQpZnUzG7biELqkvI29qeKcma3RObEoF6ztDUAjUXFqW4zpJFmRAreGsdtcR7hVgZJLl2zUHtDpssI05j6flSloLrpFQqacMw6uabWRV5xTqyj1Px9vGUUO6I1nzg8cydnAPfJ3CJpZaVzUQdCWKk4S5klBrkLN5eaVMqpo9WVeIy-WypnI6E2XRFjqcUShW0P_IE1YVBbklNjiaJ29U2ksuKWKfdBZixnKXUxGCcWX7eOSjdGrlhxRQvyh2Ttc1c73ShXJioywgohNRIhLVkzw5yZutmGMEFSqbpkxoRFvaZ87xwqaWyh0TgCp7rAWhNODUTLz62FHYVh6DkybaZHWVayK8yIotoyVyXMCBMZbry1_XkL51TqDDVmhFNjO3JzE-NlRDSuZIku1k7xe09u_xnFWb3dCGcla3V2HP7_tOH43HQzphpTarpE95C0YsbKQtPyu1hefH7lWvp9_nZl45uAXQtFFcTqojw0rGScunVK7EqjWUneWtLw8MRTNeaoCZfyslJe5cZPaX7Z6VRLRQvXRyZUZWsJMFF00DR6YONqbw99A80nTgzNsRFNV1Tu7mKiIPcl9dehQm0rnfgN0FqRx_lu47pW6IojUVomNGF8z43VYkZTkcmSGGxXec1kJV5J0Tr1b-Kpg1UikZXI6pmlnCPvvgY8LZXCWE2ZG3Eh3TZa-7btzPs3XkVrTK3U-x4UIgimi2gSRxBPnp9HviqHqko4Sw830A-eUJjN41OYX8Qwf3N-PgieJM1J_W16MV_Gi8lsHsOGqEvcwuvF7NVk8R5-i95Dn8JkOT0YBE9m8xfRO9iQhLBsA_3EnwcHZ0EwOY-jxaPuZ_Nfo2kMy3gSz5bxbLqEpx8CAIA__X_316Prwj9remMIB_fHzTLvjeHD3WGN7919_7iL10gtZoTa3hh6x-HodBiOhuEIwtE4DMdh2NsBu4uaCf8-qIQjjMJd334b-bec3SoXWG-X7JfxLXGX5pbsncHjk9Hxif_tr8F_TTn5ISn7CH9c1sHHp2d7tLl12qy-0ua6TZvbR7RZ3WrzAW5Ncod8ebGIZj_Pa-T6ABbRy2gRzafREm712af3wnY8L-x1t7C3jwrb5xu9e30-mc2hf_E6HkA0f3sAy-jcYf8HLxcXr2AzgC38_ku0iCCBZ3ByFgyHw2HAhEA99C-gfqqlMQcB3Fz_c3P95eb6C_gXwvark81PzTi6X_52Vb-5vm4AdzvIjuHo-Gg0hg9HJzCEo5OPwQ4sZ9yiNtC3usKD4N8AAAD__1xHbTs=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs9u2zgTP1dPMfClyQc7kNPvEDjowXW9gHddp7DVokVREJQ0krmhSHZIOU4WC_Qhctyn65MsSKmNC0RWi0VzCCxyfvP3NzMcjeAtkhVaTWCms2vSPNu-fAG4xyythcyRwKF1sGukomg0Ai6lvmGG0HBCxi3TxjEjuYItt-C2CDkWvJYOdlzWOAFdFB6XaeuYzbiy7Ea4LWulWKYls-IOe-A5957cyk65xeZqCK9evg_CrW6h3FHdF4fCjriyPHNCK2ZIaBLutguoNFVcdqE_1VwKd8t0wSzSTmSdDhCWteTUpYiQ50wr2enH1-Q8gq0tskL7YiEFRbZPiSDMQj3qSnFqa4WKpxLzXqxteFHUUjLnIQ3-GG4zTzzQ2U8SnvuTS4CHYL5K8tppb6JxhInKSJEJxyxK726hidXGs6PTlHoMfpgqryPlLtsy67jDCpXrdvw7bcoiOVZw65jhbvtDoKqWThj_Q-eiEBn3PlhPlpC3nky3Su5EecdL9qcW3X3XGN0bnyauciZKpQmZ0o7thBVeTVNsy4RimTZ9NBPKIe24PNqHRltXEloPkJxKbDjh2cBI33QmdhzHccDorO0e40Ql7jBnhpMTPkuYM6Fy3Adtx-NW3qimHAlzJrl1PbH5jgk0YoRbXaH3tZf8wZKff9ZI0Uw3JkUlOo2dx_-_aDEhNmrblDDjto9034O2wjpdEq9-ChXIF0au4z9n75A2oQjYN1BMyRyV1ZkVlZDcj1PmtoR2q2VnSuOzZwFKWCAxqfV1bQLLbejS4rrXKGnDS19HoUztGgoIVfbACINga-poDUMB7SfJLC-wJU2fV353CVWyh5SGdWiQXE1pmACdGXkc7yeuLwXVEpkhnfJUyCMbq0MNcZXrilnsZnmDFBXeadXZ9W-SmRerVaprlTc9y6VE2b8GAizTyjriwre40n4a7ULZDvr9B1fRDjOn6diDQkXRbD2fJnNIpi-W85CVM1OnUmRneziJnnBYrJILWF0lsHqzXA6jJ2l70nzNrlabZD1drBLYM3ONt_B6vXg1Xb-HP-bv4YTDdDM7HUZPFquX83ewZykT-R5O0nAenV5G0XSZzNePml-sfp_PEtgk02SxSRazDTz9EAEA_BX--78B35XhWTOYQDx8OG6H-WACH74dNvKDb98fD-UJucOccTeYwOA8Hl-M4vEoHkM8nsTxJI4HB8J-UQsV3ge18oBxfGg7TKPwlnO3xjs2OASHYfwVeAjzQ_abwvNn4_Nn4e7v4X8NOf0lIQcPf13U0cenl1E0f_d6OV2s4OTqdTKE-ertKWzmS0-K_8Fv66tXsIfpBrTCYfPL3ejLaDQajSKhFNIovAlOMtLWnkbw5f6fL_efv9x_hrAz9_CB2-da4ceOK3ejw9V9e1UI6ZAsnDiq8TT6NwAA__8uJh6Y

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzZtrF7batSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5H9vvwBrVhUoxgItNrLWm6fv4McINpUjGeoQaLxkLdWAVBvw-Uc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIRyDx3uFQaS0xKhSGfmF2TnRVJJSeG3WAHPKMuky1vtZuuFmfw8vk7b7zzzYQ96vty39hqKgxNLZOCKM2kZnbbBhRSl5S3oT9WlDO7JTInBnXN0tYENBYVp7rNkUaaESl4ax53zTmArQySXLphofaOTJcTpjH186hKQfVuVihowjHrxJqGF3nFObEO0uCP4VZR7IDWfOTw1J1cATwUc2dJKytdiCYRwkrFWcosMchdurnUpFKOHa2hxCH4fqucj4TadE2MpRZLFLY98a-8CYPakpwaSxS1628ClRW3TLk_ZMZyllKXg3Fk8X3r6PTOyQ0rbmhB_pKsfe-aoBvl2kRFRlghpEYipCU1M8y5aYZtCBMklaqLZkxY1DXlR_dQSWMLjcYBONUFNpxwbCBafmpt7CAMQ4-R6W57lGUlu8GMKKotc13CjDCR4cZ7O163cEGlzlBjRjg1tqM2tzGeRkTjWpbocu0kv4_k9M8ozhp1I5yVrDXYRfjz5Q7ja9O7NdWYUtNFuq9Ba2asLDQtvwvlyecl19Lvi7dPGz8E7BIUVRCri_LcsJJx6uSU2LVGs5a8taXh-dBDNeaoCZfyulKe5cZvaX7dGVRLRQs3RyZUZRsKMFF0CZFGb7mL1QzxKfwyPKhJfobmIyeG5rjjTVdi7vpioiAPXfU3okJtK514EWhtymG8E103DV1xJErLhCaMH7m0WtxoKjJZEoPtRG-QrMQbKVoX_3U8cWaVSGQlsmZtKefIu28CD0ulMFZT5rZcSCdItZ_c3sp_421UY2qlPvamEEEwWUbjOIJ4_GwW-a6cqyrhLD3fwEnwiMJ0Hl_CfBHD_PVsdhY8SnYnzddkMV_Fy_F0HsOGqGvcwqvl9OV4-Q7-iN7BCYXxanJ6Fjyazp9Hb2FDEsKyDZwk_jw4vQqC8SyOlgfDT-e_R5MYVvE4nq7i6WQFj98HAAB_-9_up0frwr9seiMIzx6Od3reG8H7-8PGvnf__WHfXiO1mBFqeyPoXYSDy3446IcDCAejMByFYW_P2N3VTPgnQiUcYBDux_aC5J9zdqtcYr19sNfjO-A-zOnsvcOL4eBi6P_3z9n_LTn5ISX7DH9c1cGHx1dHuLl13Kz-w826jZvbA9ys7rj5lV1Ncmf5YrGMpr_OG8v6FJbRi2gZzSfRCu74eUIfiO1wnth1N7G3B4nt643evpqNp3M4WbyKzyCavzmFVTRztj_Bi-XiJWzhz9-iZQQVPIXhVdDv9_uBfwNsA_hye_vl9vOX289wryB2BE8GI3j_ZAh9eDL8EPwbAAD__xVxRVk=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzZtrF7batSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJO4mKW1WJoLoKIOd_5_c5H9vvwBrVhUoxgItNrLWm6fv4McINpUjGeoQaLxkLdWAVBvw-Uc_mJKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIRyDx3uFQaS0xKhSGfmF2TnRVJJSeG3WAHPKMuky1vtZuuFmfw8vk7b7zzzYQ96vty39hqKgxNLZOCKM2kZnbbBhRSl5S3oT9WlDO7JTInBnXN0tYENBYVp7rNkUaaESl4ax53zTmArQySXLphofaOTJcTpjH186hKQfVuVihowjHrxJqGF3nFObEO0uCP4VZR7IDWfOTw1J1cATwUc2dJKytdiCYRwkrFWcosMchdurnUpFKOHa2hxCH4fqucj4TadE2MpRZLFLY98a-8CYPakpwaSxS1628ClRW3TLk_ZMZyllKXg3Fk8X3r6PTOyQ0rbmhB_pKsfe-aoBvl2kRFRlghpEYipCU1M8y5aYZtCBMklaqLZkxY1DXlR_dQSWMLjcYBONUFNpxwbCBafmpt7CAMQ4-R6W57lGUlu8GMKKotc13CjDCR4cZ7O163cEGlzlBjRjg1tqM2tzGeRkTjWpbocu0kv4_k9M8ozhp1I5yVrDXYRfjz5Q7ja9O7NdWYUtNFuq9Ba2asLDQtvwvlyecl19Lvi7dPGz8E7BIUVRCri_LcsJJx6uSU2LVGs5a8taXh-dBDNeaoCZfyulKe5cZvaX7dGVRLRQs3RyZUZRsKMFF0CZFGb7mL1QzxKfwyPKhJfobmIyeG5rjjTVdi7vpioiAPXfU3okJtK514EWhtymG8E103DV1xJErLhCaMH7m0WtxoKjJZEoPtRG-QrMQbKVoX_3U8cWaVSGQlsmZtKefIu28CD0ulMFZT5rZcSCdItZ_c3sp_421UY2qlPvamEEEwWUbjOIJ4_GwW-a6cqyrhLD3fwEnwiMJ0Hl_CfBHD_PVsdhY8SnYnzddkMV_Fy_F0HsOGqGvcwqvl9OV4-Q7-iN7BCYXxanJ6Fjyazp9Hb2FDEsKyDZwk_jw4vQqC8SyOlgfDT-e_R5MYVvE4nq7i6WQFj98HAAB_-9_up0frwr9seiMIzx6Od3reG8H7-8PGvnf__WHfXiO1mBFqeyPoXYSDy3446IcDCAejMByFYW_P2N3VTPgnQiUcYBDux_aC5J9zdqtcYr19sNfjO-A-zOnsvcOL4eBi6P_3z9n_LTn5ISX7DH9c1cGHx1dHuLl13Kz-w826jZvbA9ys7rj5lV1Ncmf5YrGMpr_OG8v6FJbRi2gZzSfRCu74eUIfiO1wnth1N7G3B4nt643evpqNp3M4WbyKzyCavzmFVTRztj_Bi-XiJWzhz9-iZQQVPIXhVdDv9_uBfwNsA_hye_vl9vOX289wryB2BE8GI3j_ZAh9eDL8EPwbAAD__xVxRVk=

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mKW1WJoLoKI-b7z-51DDofwBrVhUkxgJtNrLWm6fv4McINpUjGeoQaLxkLdoIJgOATKufxElEZFNRJqiFSWKE4FrKkBu0bIMKcVt1BTXuEEZJ47XiqNJSalwpBPzK5JiyKp5MSwG-yhZ9RFsuWduPnq6gRePn_nwa1tJuxB2-e7YKupMDS1TAqiNJOa2W0XUUhdUt7F_lhRzuyWyJwY1DVLOwPQWFSc6i5DGmlGpOCdcdwVZw-3Mkhy6ZqF2hsyfUaYxtT3oyoF1W2vUNCEY9bLNY0u8opzYh2l4R_iraLYEa35yOGpO7kAeEjmDkkrK52LJhDCSsVZyiwxyF24udSkUk4dna7EPvpuqZyNhNp0TYylFksUtjvwr6wJg9qSnBpLFLXrbyKVFbdMuT9kxnKWUheDcWLxdeurWGvlhhU3tCB_SSYOFK91vFGuVFRkhBVCaiRCWlIzw5ylpuGGMEFSqfqkxoRFXVN-cBaVNLbQaByBU11gowunCKLlp87ijsIw9ByZthOkLCvZDWZEUW2ZqxRmhIkMN97a4YIL51TqDDVmhFNje3JzU-OlRDSuZYku1t4B8J7cDjSKs2bDEc5K1unsLPz5vOX43HQ7qhpTavqE9zVpzYyVhabld7G8AP3atfT7_O3KxjcB-5aKKojVRXlqWMk4dSuV2LVGs5a8s6Th6dhTNeaoCZfyulJe6MZPan7d61RLRQvXRyZUZRsJMFH0jZZGj2x9NU18Cr-M946W76H5yImhOba66QvMXWFMFOShqv5WVKhtpRO_CDqLsp_vFq_rhq44EqVlQhPGD1xcHWY0FZksicFuoTdMVuKNFJ2D_zqeOVglElmJrBlbyjny_tvA01IpjNWUuSkX0i2k2nduZ-S_8UaqMbVSH3pXiCCYLaNpHEE8fXYZ-aqcqirhLD3dwFHwiMJ8EZ_D4iqGxevLy5PgUdKeNF-zq8UqXk7nixg2RF3jFl4t5y-ny3fwR_QOjihMV7Pjk-DRfPE8egsbkhCWbeAo8efB8UUQTC_jaLnX_XzxezSLYRVP4_kqns9W8Ph9AADwt__tfga0LvzrZjCB8OThuN3ngwm8vz9s8IP77w-7eI3UYkaoHUxgcBaOzofhaBiOIBxNwnAShoMdsLuvmfDPhEo4wijc9e0Xkn_S2a1ygQ12yX4f3xF3aW7P3hs8G4_Oxv5__5z835STH5Kyj_DHZR18eHxxQJtbp83qP9qsu7S53aPN6k6bX-Fqkjvki6tlNP910SDrY1hGL6JltJhFK7jT5xF9ELbjeWHX_cLe7hW2zzd6--pyOl_A0dWr-ASixZtjWEWXDvsTvFhevYQt_PlbtIyggqcwvgiGw-Ew8G-AbQBfbm-_3H7-cvsZ7jeIncCT0QTePxnDEJ6MPwT_BgAA__8khUW7

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCWVWBoLoKI-b7z-51DDofwDrVhUkxgJtNrLWm6fvkCcINpUjGeoQaLxkLdoIJgOATKufxClEZFNRJqiFSWKE4FrKkBu0bIMKcVt1BTXuEEZJ47XiqNJSalwpAvzK5JiyKp5MSwG-yhZ9RFsuWduPnq6gRev_zgwa1tJuxB2-e7YKupMDS1TAqiNJOa2W0XUUhdUt7F_lxRzuyWyJwY1DVLOwPQWFSc6i5DGmlGpOCdcdwVZw-3Mkhy6ZqF2hsyfUaYxtT3oyoF1W2vUNCEY9bLNY0u8opzYh2l4R_iraLYEa35zOG5O7kAeEjmDkkrK52LJhDCSsVZyiwxyF24udSkUk4dna7EPvpuqZyNhNp0TYylFksUtjvwR9aEQW1JTo0litr1d5HKilum3B8yYzlLqYvBOLH4uvVVrLVyw4obWpC_JBMHitc63ihXKioywgohNRIhLamZYc5S03BDmCCpVH1SY8Kirik_OItKGltoNI7AqS6w0YVTBNHyS2dxR2EYeo5M2wlSlpXsBjOiqLbMVQozwkSGG2_tcMGFcyp1hhozwqmxPbm5qfFSIhrXskQXa-8AeE9uBxrFWbPhCGcl63R2Fv583nJ8brodVY0pNQeF59r_mLVmxspC09L0iuAx0YvQr15L-8T-mLkrHd8I7FssqiBWF-WpYSXj1K1VYtcazVryzrKGp2NP1ZijJlzK60p5sRs_rfl1r1MtFS1cL5lQlW1kwETRN14aPbL11TTyOfwy3ltZ30fzmRNDc2y10xeYu8aYKMhDVf3NqFDbSid-GXQWZT_fLV_XDV1xJErLhCaMH7i8OsxoKjJZEoPdYm-YrMQbKTqH_208c7BKJLISWTO6lHPk_TeCp6VSGKspc5MupFtKte_czth_561UY2qlPvS2EEEwW0bTOIJ4-uIy8lU5VVXCWXq6gaPgCYX5Ij6HxVUMi7eXlyfBk6Q9ab5mV4tVvJzOFzFsiLrGLbxZzl9Plx_gj-gDHFGYrmbHJ8GT-eJl9B42JCEs28BR4s-D44sgmF7G0XKv-_ni92gWwyqexvNVPJ-t4OnHAADgb__b_QxoXfgXzmAC4cnDcbvTBxP4eH_Y4Af335928RqpxYxQO5jA4CwcnQ_D0TAcQTiahOEkDAc7YHdnM-GfCpVwhFG469vvJP-ss1vlAhvskv1OviPu0tyuvTd4Nh6djf3__jn5vyknPyRlH-GPyzr49PTigDa3TpvVf7RZd2lzu0eb1Z02H-Fqkjvkq6tlNP910SDrY1hGr6JltJhFK7jT5xF9ELbjeWHX_cLe7hW2zzd6_-ZyOl_A0dWb-ASixbtjWEWXDvsTvFpevYYt_PlbtIyggucwvgiGw-Ew8O-AbQDfbm-_3X79dvsV7jeIncCz0QQ-PhvDEJ6NPwX_BgAA__9eJ0Yd

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6IUzn-YQgc9MJ11c1b6hS22rUoCoKSjmQuFMmSlGpnGNCHyBP2SQZSSuIillVgaC6CiPm-8_c7hxwO4R1qw6SYwEym11rSdP3yBeAG06RiPEMNFo2FukEFwXAIlHP5hSiNimok1BCpLFGcClhTA3aNkGFOK26hprzCCcg8d7xUGktMSoUhX5hdkxZFUsmJYTfYQ8-oi2TLO3Hz1dUJvH75wYNb20zYg7bPd8FWU2FoapkURGkmNbPbLqKQuqS8i_25opzZLZE5MahrlnYGoLGoONVdhjTSjEjBO-O4K84ebmWQ5NI1C7U3ZPqMMI2p70dVCqrbXqGgCcesl2saXeQV58Q6SsM_xFtFsSNa85nDc3dyAfCQzB2SVlY6F00ghJWKs5RZYpC7cHOpSaWcOjpdiX303VI5Gwm16ZoYSy2WKGx34N9ZEwa1JTk1lihq1z9EKitumXJ_yIzlLKUuBuPE4uvWV7HWyg0rbmhB_pJMHChe63ijXKmoyAgrhNRIhLSkZoY5S03DDWGCpFL1SY0Ji7qm_OAsKmlsodE4Aqe6wEYXThFEyy-dxR2FYeg5Mm0nSFlWshvMiKLaMlcpzAgTGW68tcMFF86p1BlqzAinxvbk5qbGS4loXMsSXay9A-A9uR1oFGfNhiOclazT2Vn4__OW43PT7ahqTKk5KDzX_u9Za2asLDQtzWERPGZ6Ffrda6ntYT8Kdlc-vhnYt1xUQawuylPDSsapW63ErjWateSdpQ1Px56qMUdNuJTXlfKCN35i8-tep1oqWrh-MqEq20iBiaJvxDR6ZOuraeZz-GW8tz6-l-YzJ4bm2OqnLzB3lTFRkIeq-ttRobaVTvxC6CzKfr5bwK4buuJIlJYJTRg_cIF1mNFUZLIkBrsF3zBZiTdSdC6At_HMwSqRyEpkzfhSzpH33wqelkphrKbMTbuQbjHVvnM7o_-DN1ONqZX60PtCBMFsGU3jCOLpi8vIV-VUVQln6ekGjoInFOaL-BwWVzEs3l5engRPkvak-ZpdLVbxcjpfxLAh6hq38GY5fz1dfoA_og9wRGG6mh2fBE_mi5fRe9iQhLBsA0eJPw-OL4JgehlHy73u54vfo1kMq3gaz1fxfLaCpx8DAIC__W_3M6B14V85gwmEJw_H7V4fTODj_WGDH9x_f9rFa6QWM0LtYAKDs3B0PgxHw3AE4WgShpMwHOyA3b3NhH8uVMIRRuGub7-X_NPObpULbLBL9nv5jrhLc_v23uDZeHQ29v_75-S_ppz8lJR9hD8v6-DT04sD2tw6bVaPtFl3aXO7R5vVnTa_w9Ukd8hXV8to_uuiQdbHsIxeRctoMYtWcKfPI_ogbMfzwq77hb3dK2yfb_T-zeV0voCjqzfxCUSLd8ewii4d9n_wann1Grbw52_RMoIKnsP4IhgOh8PAvwW2AXy7vf12-_Xb7Ve43yB2As9GE_j4bAxDeDb-FPwbAAD__9orRn8=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUllFv20YMx9_9Ke5xG-rAidsma9AHz9WAALHTxU7QPRG0RElcTndn3slJ_OmHO7loCkRW8yYk_JE88k_S47G6J_FszSc1t_mDWMzrL38peqJ807IuSFQgH9SusxqNxmOFWttHcEIOhQA9WBfAaTSqRq9CTaqgElsd1A51S5-ULcvI5dYH8DkaD48cajhYQW41eN7TAF5gzORZ99pdrW7eqcWXf5PxwTebcNT3xUvjIGg85oGtASdshcNzH2isNKj76G2LmsMz2BI8yY7z3gSEqlaj9DkSwgKs0b15fC_OK2zrCUobm0WSHPkhJyyUp360jUE59IoMbjQVg6zvdFG2WkOISMcf41bZOoLBb7X6HP9yqdSPx3y3xDbYGKJLBLhxmnMO4EnHdEsr0Lqojt5Q5jX8Zamijw2GvAYfMFBDJvQn_pM340kClOgDOAz1L0FNqwO7-GELLjnHmIOPYkl1G6j0wcmeqz1W8J_l_rnrgj65WCY0BXBlrBAYG2DHnqObrtke2EBu3ZDM2ASSHeqjc-isD5WQj4BGqajTRFQDiH3sLezpZDJJjM0P0-MCN7ynAhxK4FglKoBNQU_J2_F3mxjUSkFCBWj0YeBtcWKSjECotg3FXAfFnyLF_eed5m67geaGe4OdTd5fHJj0NjmMqVCOfkh0P0M1-2ArweZNVBJfWrkB3xbvpWxSE2hoobgKglTNieeGNcZ1CqEW8rXVvSWdnEwTKlSSgLb2oXVJ5T5NafkwGFSswyr2kY1rQycBNtXQIhJKlodYXRM_q4_TV3dS6qHfavBY0kE3Q4nF88Wmgh9VTRfRkYRWNmkJ9BbldT4u3dgNaTWBE7vBDesjR6vHjaApbAOe-oXekdzQ3prewb9bz6NZaza2NUU3tqg16eFLkLDcGh8EOU65sXEh7VLnXoz8L16jHeXByrHfFGY0mt9ms3WmVtk_d9lyninXbjTnJ562anG1vJ9d32XqVC1m37rPP8_OptPzs8n048WH9-fnHy4m5-pqOb_NFtlyrU7Vaj27XavTy9Eo-_b1ena1VL_dfF2_U9ny_ne1yq6z-Vr9of6-vVkoT9vL0Xg8Ho88bVsyOY27Yxb_M_o_AAD__4agbtA=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvo6e4sA3tQc7keNhCBwUmOuqm7fUKWz1D0VBUNKRzYUmVZJS7AwDij1DLvd0eZKBlJw4q2W1GJqLwKa_7_x-55C9HrxBpZkUQxjL-EpJGi-fPwNcYxzljCeowKA2UJQoz-v1gHIur0mmMKMKCdVEZoZknApYUg1miZBgSnNuoKA8xyHINLW8WGpDdEyFJtfMLEmFIrHkRLMbbKAn1Eay4bW4yfyyCy-fv3fgyjYT5qDts12wUVRoGhsmBckUk4qZTR1RSLWivI79KaecmQ2RKdGoChbXBqBwkXOq6gwppAmRgtfGsS3OHm6ukaTSNguVM6SbjDCFsetHvhJUVb1CQSOOSSNXl7pIc86JsZSSf4g3D0JLNPoTh6f25BzgIZktkuZGWhdlIIStMs5iZohGbsNNpSJ5ZtVR60rso--WytqIqImXRBtqcIXC1Af-yJrQqAxJqTYko2b5VaRVzg3L7AeZsJTF1MagrVhc3RoqXRm5YYsbuiB_SFY_d6XTdWbLREVC2EJIhURIQwqmmTVTNlsTJkgssyaZMWFQFZQfnMNMarNQqC2BU7XAUhNWDUTJ69rC9n3fdxwZV9OTGbZiN5iQjCrDbJUwIUwkuHbWDuctrFOpElSYEE61acjNToyTEVG4lCu0sTaK33my-09nnJXbjXC2YrXOTv0fzyqOy01VY6owprpJdI9JS6aNXCi6-iaWE59buYZ-m79d2bgmYNNCyRbEqMXqWLMV49SuU2KWCvVS8tqS-scDR1WYoiJcyqs8cyrXbkrTq0anSmZ0YfvIRJabUgJMLJoWkUKHrHyVTXwKPw327iTXQ_2JE01TrHTTFJi9vphYkIequhsxQ2VyFbklUFuU_Xy7dG03VM6RZEpGNGL8wKVVY0ZRkcgV0Vgv9JLJVngjRe3gvw7HFpaLSOYiKceWco68-SZwtFgKbRRldsqFtAupcJ3bGfmvvI0KjI1Uh94UwvPGs2AUBhCOnl0ErirHWR5xFh-voe0dUZhMwzOYXoYwfX1x0fWOouqk_Da-nM7D2WgyDWFNsivcwKvZ5OVo9h5-D95Dm8JoPu50vaPJ9HnwDtYkIixZQzty517n3PNGF2Ew2-t-Mv0tGIcwD0fhZB5OxnN48sEDAPjT_bd_LVos3MumNQS_-3Bc7fPWED7cH5b41v33j7t4hdRgQqhpDaF16vfPen6_5_fB7w99f-j7rR2wvauZcE-EXFhC39_17RaSe86ZTWYDa-2S3T7eEndpds_eGzwd9E8H7re_uv835ei7pOwi_H5Zex-fnB_Q5sZqM_9Cm0WdNjd7tJlvtfkIV5DUIl9czoLJL9MSWXRgFrwIZsF0HMxhq882fRC25TlhF83C3uwV9m6-bybB262bwk2hnbuud5TbHL0OjOYwDy6sDdqFqAt5Fwp4Mbt8-XiCuv_x-_bXYBZABE9hcO55wbtXF6PJFNqXr8IuBNM3na3RH0pbxbnX6_V6HhMCVc89sdqxklp3PLi7_efu9vPd7WdwT5DNFyfrn6tht7_8bXt6d3tbAe43nBnCyelJfwgfTgbQg5PBR28HljJuUGloG5Vjx_s3AAD__3KQhss=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVlFv20YMfq5-xb21GeIgW4chaNAH1_UAb44T2GqxYBgIWqKkW053Fx7lJP71w51cNB0iq30zDH4feeTHj5pM1GfioJ19p2auuGOHRfPxg6JHKradNiWxEgqidn1Ulk0mCo1xD-CZPDIBBnBewBu0qsGgpCFVUoWdEbVD09E75aoq4goXBEKBNsCDlgYOUVA4A0HvaQReYqzkyQzGLTbXp-rq420KPnBrK0e5L54HC6MNWIh2Fjxrx1qehoDWcYtmCH3fodHyBK6CQLzTxWABTHVnkIeImLAEZ81gHV-a8wK2CwSVi8MiTkRhjEQzFWkeXWuRD7Mii1tD5Sg29LqoOmNAIqTHH8Nt5nkESrg36n3851Kpr4_5EomduJiiLwR0640utEAgE8utHEPnozoGU9mX4M9bFTm2KEUDQVCoJSvDhX_DZgOxQIVBwKM03wVqOyPaxx-u1JUuMNYQolhS30Y6fSDZ63qPNfzr9PDe9UkffWwT2hJ0bR0TWCew00FHmn7YAbSFwvkxmWkrxDs0R_fQuyA1U4gAg1xTr4moBmD3MNjYn8_PzxPGFYft8aJbvacSPLLo2CUqQduSHhPb8XfbmNRxSUwlGAwy8ra4MUlGwNS4lmKto-JPmaL_BW90725gdKsHk_1y_uvFAZPexoc1ZSowjInuW1Cjg7iasf0hVBJfslzBH8v3XDZpCDRmKL4G4bo9C7rVBqOdgjRMoXFmsKXnZ28TlKkiBuPcXeeTykPa0upuNCk7j3Wco7a-k14C2tZjRsSUIg-5-iG-V7-9fdGT0gzDvYGAFR10M1ZYPF_a1vC1q-kiemLpeJtMYLApL-Oj6cZpcGcIPLstbrU5crQGaBht6VoINCz0Hqlb2js7uPif8lkM6-zWdbbs1xaNITN-CRKscDYIo45bbl00pF2a3LOV_85rtKNCHB_7prBZNlvPp_lc5dMPy3nqylk4E_Ume4Vqscov1Oo6V6tPy-Vp9mp2vdrk6-lilSsBf0dP6ma9uJqub9Wf81v1BtV0MzvJTi6zbLrM5-v_cy5Wf8xnudrk03yxyRezjXr99z-vL7Ns_tfNcrpYqTfXN_mpmq8-n6jNfBljf1K_r6-vVDiTy2wymUyyZHiS_RcAAP__h4B1VA==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMzDL5HzuMjqeXSXZEmlvDavZPqWgWr7v3fju6oWg_sa1JnlMxtxqjFYrl06L3cQlSKqASYQKJB9Bhch8lZR66mBgdvboN-oNdOmibjKkkGqcKQ4Jatg10UVOIh8ZZm4DXmSu79ZNyHi88n7p_3_5XgHTcHO8j96mmwKYaElbEEiMqibPdTwCDao19cnF_uhd8M6NnuQRpIpBuuyJ25NVbXrcoQ6jfO_cz7g1KpHTzqVEVKWIMEP1nSD532YIdE0EjuG2khSnMkrFSV1gx9QN21jQKuPdWz2DRapBm8B8uQEX8IV4TkZOnGu7P8z16JcDDJKcZCgPvouWKDRD6X24jCELNRJlOFffCnUmWONVrVQTI06inYdOG_sIVEatBgMoho3W-B-sEbx_xDam64wlxDyrYpus0ovSPZcrvFFv4Xnh7BMeldzDJhqIHbIEoQxGDDiTPN2OwEHKCSOGczDka6QX9wJKMka5VSBnjUlkZPZDeAyu2ksKer1apgpNrNUTTueUs1RFTjrBLVwKGmu8J2-N0hJxWtSakGj8lm3pYnptgIlDrpKdc6a_6SKa_CFD2Piw489zyZ7I_Vn692mPI23Y2pUoVpznS_gjpOJq1i_yxUMV_ZvobPy_fUNqUJNLdQYgumbf8icc8e82YF65RSJ35S0tWLlwWq1JCCF7keYnF5KlPaXM8mVYnY5j5yiIONFuDQzi0ipRK5yzU28cz99XLvTio9TDceEja0881cYfmScWjhp6rlOEZSG3RdlsCkKPvxeenmbujgCaLKGtfsD9yvCRrFUEsPiaaNPiK5p62EycH_evkuhw1hnc_dOLboPfn5S1BglYRkipynPEheSJvSuScj_5vXaEOViR76vAiLxfm_Xz6-_fDJHX3-cnnizj9dHburtx-_nl-4o9PjN4vlcrlclPC0cI8PD48P3x4fvrmj05PjxfcAAAD__1MPWs0=

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVsFu20gMvfsr5pgAceFsF4uiRQ7dNocC3bZA0mD3RNASJXEzGk44lJP41I_IF-ZLihm5aApYVnMzDL5HzuMjqeXSXZEmlvDavZPqWgWr7v3fju6oWg_sa1JnlMxtxqjFYrl06L3cQlSKqASYQKJB9Bhch8lZR66mBgdvboN-oNdOmibjKkkGqcKQ4Jatg10UVOIh8ZZm4DXmSu79ZNyHi88n7p_3_5XgHTcHO8j96mmwKYaElbEEiMqibPdTwCDao19cnF_uhd8M6NnuQRpIpBuuyJ25Stm4Qv_GuZ9ZfxAqtYNHnapHCWuQ4CcL-qHSHuyQCBrJXSMtRGmOhJWq0pihD6i7plHAtad6FptGgzSD92AZMuIP4YqMnCzdeHeW_9krEQ4mOcVYCHAfPVdskMjnchtRGGK2yWSqsA_-VKrMsUarOkiGRj0Fmy78F7aQSA0aTAYRrfstUD9445h_SM0NV5hrSNk0RbcZpXckW2632ML_wtMDOCa9i1kmDDVwG0QJghhsOHGmGZudgANUEudsxsFIN-gPDmSUZK1SygCP2tLoiewGULmdFPZ0tVoVjFS7KYrGPW-phohqnFWiGjjUdFfYDr875KSiNSnV4DHZzNvyxBQbgVInPeVaZ81fMuVFmKLncc2B554nk_2x-vPVDlPeprsxVaowzZnuV1DHyaRV7J-FKuYru9fwefme2qY0geYWSmzBtO1fJO7ZY96rYJ1S6sRPSrp68bJAlRpS8CLXQywuT2VKm-vZpCoR29xHDnGw0QIc2rlFpFQid7nGJp65v17u3Umlh-nGQ8KGdr6ZKyzfMQ4t_FS1nMZIaoOuyxKYFGU_Pi_d3A0dPEFUWeOa_YHrNUGjGGrpIdG00Uck97SVMDn4Xy_f5bAhrGUI9Ti26D35-UtQYJWEZIqcpzxIXkib0rknI_-b12hDlYke-rgIi8X5v18-vv3wyR19_nJ54s4_XR27q7cfv55fuKPT4zeL5XK5XJTwtHCPDw-PD98eH765o9OT48X3AAAA___GWFn4

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0VkFv2zgTPVe_gvClyYc4kJMPi8BBD66rLrzr2oWtFi2KgqCkkcw1RbJDSrW92P--IOU0DipZLRbNIYiYeTPzZt4MORyS94CGKzkmU5VuUbF08-olgR2kScVFBkgsGEvqxioIhkPChFBfqUbQDIEyQ5W2VAsmyYYZYjdAMshZJSypmahgTFSeO1yqjKUmZdLQr9xu6NGKpkpQww_QA8-Yy2QvOu1m6-UVefPqozc--ubSnvV9d2pskUnDUsuVpBq5Qm73XUCpsGQiWEdxK_xLxQS3e6pyagBrngJ5QVLklqdM3BPyGPXBIUJRCYZd-SCwjCopOhN6qFILtjJAc-W6BugdmT4nHCH1jalKyfDYNJAsEZD1Yk0jkLwSgloHafDncL6M3FjzRZAX7qS1RKyyyoVoEqG81IKn3FIDwqWbK6SVdjLpDCXb4Kelcj4SZtMNNZZZKEHa7sSfeJMG0NKcGUs1s5sfApWVsFy7P1TGc54yl4NxovF166n00cmBFwdW0L8U7x7AJuhOuzIxmVFeSIVApbK05oY7N02zDeWSpkr3yYxLC1gzcXYgtTK2QDAOIBgW0GjCqYGi-tpZ2FEYhh6j0uMUactLfoCMaoaWuypBRrnMYOe9nectXVCFGSBkVDBje7i5ifEyoggbVYLLtVf8PpJbhEYL3qw5KnjJO4PdhP-_O2I8NzyOKULKTJ_onoI23FhVICt_CuXF53evZT8X71Q2vgnQt1B0QS0W5bXhJRfM7VVqNwhmo0RnScPrWw9FyAGpUGpbaa9y46c03_YGRaVZ4frIpa5sIwEui75FhOAtj7GaJr4gv9227iTfQ_NFUMNyOOqmLzF3j3FZ0Meq-qtRA9oKE78EOovSjndL13UDKwFUo0pYwsWZ26vDDTKZqZIa6BZ6g-QlHJTsHPx38dSZVTJRlcyasWVCgOi_CTwsVdJYZNxNuVRuIdW-cycj_4O3UQ2pVXjucSGDYLqKJnFE4snLeeSrcq2rRPD0ekcugmeMzBbxHVksY7J4N59fBc-S40nzNV0u1vFqMlvEZEf1Fvbk7Wr2ZrL6SP6MPpILRibr6eVV8Gy2eBV9IDuaUJ7tyEXiz4PL-yCYzONo1Rp-tvgjmsZkHU_i2TqeTdfk-aeAEEL-9r_dz4DVhX_iDMYkvHo8Pu7zwZh8-nbY2A--fX8-tUdgFjLK7GBMBjfh6G4YjobhiISjcRiOw3BwYuzuai79E6GSDjAKT2P7heTfdXavXWKDU7Dfxw_AU5jbs98c3tyObm79__65-q-Uk19C2Wf461gHn5_fn9Hm3mmz-k6bdZc29y3arB60-cSuprmzfL1cRbPfF41lfUlW0etoFS2m0Zo86POCPQrb4byw635h71uFfZ7vwfHV2-8II-RdlA8tlPW2hXO-fcoWIW_ju7-ozvM6dPOKPrydT2YLcrF8G1-RaPH-kqyjubP9H3m9Wr4hh_tgOBwOA_-eOQT_BgAA__8q4XO5

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHvXBddeHd1C5stWhRFAQtjWSuKZIlKdfyYt99QUppHFSyWiyaiyBi5szPmTNDjkbwHrVhUkxgJpOdljTZvnoJeMBkUzKeogaLxsK-tgqC0Qgo5_IrURoV1UioIVJZojgVsKUG7BYhxYyW3MKe8hInILPM4RJpLDEJFYZ8ZXZLGiuSSE4MO2IPPKUuk4p32s3Xy0t48-qjN258M2HP-r49NbaaCkMTy6QgSjOpma26gELqgvJgHcWt8C8l5cxWRGbEoN6zBOEFJJpZllB-B_AY9cGhxrzkVHflo5GmRAremdADSy3Y0iDJpOsaau_I9DlhGhPfmLIQVDdNQ0E3HNNerKkFkpWcE-sgNf4cztPIjDVfOLxwJ60U0dJKF6JOhLBCcZYwSwxyl24mNSmVk0lnKNEGP6XK-dhQm2yJsdRigcJ2J_7EmzCoLcmosURRu_0hUFFyy5T7Q6YsYwl1ORgnGs9bD9ONkyPLjzQnf0nWPYB10INyNFGREpYLqZEIacmeGebc1M02hAmSSNUnMyYs6j3lZwdSSWNzjcYBONU51ppwaiBafu0kdhyGocfIpJkiZVnBjpgSRbVljiVMCRMpHry383ULF1TqFDWmhFNje2pzE-NlRDRuZYEu117x-0huERrFWb3mCGcF6wx2Hf7_tsH42nQzphoTavpE9xS0ZcbKXNPip1BefH73Wvpz8U5l45uAfQtF5cTqvLgyrGCcur1K7Faj2UreSWl4deOhGjPUhEu5K5VXufFTmu16g2qpaO76yIQqbS0BJvK-RaTRWzax6ia-gN9uWneS76H5womhGTa66UvM3WNM5OSRVX81KtS21Bu_BDpJace7peu6oUuORGm5oRvGz9xeHW40FaksiMFuoddIVuBRis7BfxfPnFkpNrIUaT22lHPk_TeBhyVSGKspc1MupFtIe9-5k5H_wdtoj4mV-tzjQgTBbBVN4wji6cv7yLNypcoNZ8nVAYbBMwrzRXwLi2UMi3f395fBs01zUn_Nlot1vJrOFzEciNphBW9X8zfT1Uf4M_oIQwrT9eziMng2X7yKPsCBbAhLDzDc-PPg4i4IpvdxtGoNP1_8Ec1iWMfTeL6O57M1PP8UAAD87X-7nwHd5_6JM5hAePl43OzzwQQ-fTus7Qffvj-f2mukFlNC7WACg-twfDsKx6NwDOF4EoaTMBycGLu7mgn_RCiFA4zD09h-Ifl3na2US2xwCvb7-AF4CnN79pvD65vx9Y3_3z-X_7XkzS8p2Wf466oOPj-_O6PNo9Om2n0nTo1ZlzyPLfJUuwd9nhhmO3i9XEXz3xe1kcbsAlbR62gVLWbRGpoUqmF5XsDHVgGfr6tydZXflbXvKqpqKapsqakie5I5yyeV7dvqOgxpDyGtsONQ7R4H3cXzg77vH_Sqm6fow9v76XwBw-Xb-BKixfsLWEf3zvZ_8Hq1fAPVXTAajUaBfwdVwb8BAAD__45Cg3s=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9v2zYQfq7-CsIvTYc4UJxuSx30wXVUwJtrF7FatCiKAyWd5FsokiEp58ew_30g5bQuYFnpw5aHICHvuzt9990dh0P2EY0lJcdsqvJro3i-vnzD8A7zrCFRoGEOrWOb1iqKhkPGhVC3oA1qbhC4BaUdaMElW3PL3BpZgSVvhGMbLhocM1WWHpcr68DmXFq4JbeGrRXkSoClB-yBF9xnci867War5TF7d_k5GG99k3QHfZ_vGjvDpeW5IyVBG1KG3H0XUCpTcxGtknQv_Kbhgtw9qBIsmg3lyF6z3JCjnIsLxr5HfXRosGoEN135GOQFKCk6E3pkaQ-2sQil8lVDExzZPidkMA-FaWrJzbZoKHkmsOjF2lYgZSMEOA9p8YdwgUayzt4I9tqf7KWIN075EG0iQLUWlJMDi8KnWyoDjfYy6Qwl98F3qfI-Mu7yNVjHHdYoXXfiP3iTFo2DklsHmrv1k0B1Ixxp_4cqqKSc-xysF03grYfprZMHqh54BX8p6m7ANuid9jRxWQBVUhkEqRxsyJJ30xbbAknIle6TGUmHZsPFwYbUyrrKoPUAwU2FrSa8GsCo205iT-M4DhiVb7tIO6rpAQvQ3DjyLGEBJAu8C94Of7f0QZUp0GABglvX822-Y4KMwOBa1ehz7RV_iOQHodWC2jEHgmrqDDaKX55vMeHbzLZNDebc9onuR9CarFOV4fVPoYL4wux1_Ofi7comFAH7BoquwJmqPrFUk-B-roJbG7RrJTopjU_OAtRgiQaEUteNDiq3oUvL696gRmle-TqS1I1rJUCy6htEBoPlNlZbxNfst7O9MynU0N4IsLzErW76EvN7jGQF31kNq1GjcY3JwhDoJGU_3g9dXw3TCARtVMYzEge2V4cbw2WharDYLfQWSTU-KNnZ-B_SqTdrZKYaWbRty4VA0b8JAixX0jrDyXe5VH4gbULldlr-idtog7lT5tDjQkbR9CqZpAlLJ2_mSWDlRDeZoPwkY0fRs4y9WS7nbLFM2eLDfH4cPTPqlgo2W6Tn4fTjbDXzyEcLdpm8nXyYp6yRdNOE8UHF0Yvj6Nl0uVilV5PZImUZ6Gu8Z--vZu8mV5_Zn8lndtT6naym3na2uEw-sQwyoOKOHWXhPHpxEUWTeZpc7c12tvgjmaZslU7S2SqdTVfs-ZeIMcb-Dr_9z4BvqvAiGozZ6fH34-34H4zZl2-H4SIbfPv_6669Qe6wAO4GYzYYxaPR8HQ0jEfs9Hx89nI8enXy6-8vX52NBjsYv-FJhodFIz1utHMZhlh4C7p77bMb7EIlr8MZgH8EAPxw5-f7o8t458LP7cfz09M4Djf_HB9gJH4KI6FM_yEr8f_HypaS6OvziyhKPr2fT2YLdrR8nx6zZPHxBVslcy-oX9jbq-U7ll1Ew-FwGIWVm0X_BgAA__9X0xNP
