# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCRlWBoLoKIOd_5_c5HDofwHrVhUoxhKtNLLWm6evUScI1pUjGeoQaLxkLdWAXBcAiUc_mVKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSFfmV2R1oqkkhPDrrAHnlGXyYZ32s2WFwfw5tVHb9z6ZsLu9H26bWw1FYamlklBlGZSM7vpAgqpS8q70F8qypndEJkTg7pmaWcCGouKU93lSCPNiBS8M4-b5jyArQySXLphofaOTJ8TpjH186hKQXU7KxQ04Zj1Yk3Di7zinFgHafC7cMsodkBrvnB44U7OAO6KubGklZUuRJMIYaXiLGWWGOQu3VxqUinHjs5Q4iH4dqucj4TadEWMpRZLFLY78XvehEFtSU6NJYra1aNAZcUtU-4PmbGcpdTlYBxZfN96Ot06uWLFFS3IX5J1710TdK1cm6jICCuE1EiEtKRmhjk3zbANYYKkUvXRjGW-5nu9M2icNBDLSpSV7fIQ3uKfBBAWdU35zsVX0thCo3EATnWBDQkd_YiWXzsnOQpDH4TLtF1XZVnJrjAjimrLXHmYESYyXHtvuxvNZXr5qKKEy07qDDVmhFPTad123e2yJzjRuJIluqJ619Kn5JTZKM4a3SWclawz2HH482mL8U3QrYBoTKnpW4f7oBUzVhaalk9C-bXwl4GlT4u3TWg_LeyTOlUQq4vy0LCSceqEntiVRrOSvLOl4eGJh2rMURMu5WWl_P4Zrx_5ZW9QLRUt3ByZUJVtKMBE0QPT6A3bUDtn6AdovnBiaI4tafqyulW8R3HX3cFMFORuAP5aV6htpROvZE_Eu5vDDU5XHInSMqEJ4ztu3g43mopMlsRg9040SFbilRSdYvIunnqzLYV7TF8qkchKZI10UM6R919_HpZKYaymzCmNkE6Fa0-KLdl55BVcY2ql3vWQEkEwXUSTOIJ48vI88l08VFXCWXq4hr3gGYXZPD6F-UUM83fn5wfBs6Q9ab6mF_NlvJjM5jGsibrEDbxdzN5MFh_hj-gj7FGYLKf7B8Gz2fxV9AHWJCEsW8Ne4s-D_bMgmJzH0eLB8LP579E0hmU8iWfLeDZdwvNPAQDA3_63-xnQuvDPucEYwoO74_YSG4zh0-1hYz-4_f68ba-RWswItYMxDI7D0ekwHA3DEYSjcRiOw3CwZeweKEz4d1ElHGAUbsf2WuffsHajXGKDbbCX-hvgNsxJ-K3D45PR8Yn_3z8H_7fk5IeU7DP8cVUHn5-f7eDmxnGz-g836y5ubh7gZnXDzXt2Ncmd5euLRTT7dd5Y1vuwiF5Hi2g-jZZww889ekdsh_PErvuJvXmQ2L7e6MPb88lsDnsXb-MDiObv92EZnTvbn-D14uINrOHP36JFBAm8gJOzYDgcDgP_Dln_0u5WAN-vr79ff_t-_Q1ulcSO4ej4aDSGT0cnMISjk8_BvwEAAP__a12h0g==


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3dX6wEzn5XQQOCsx11c1b6hS22rUoCoKSjmQuFKmSlGpnGFDsGXK5p8uTDKQUx0EjK8HQXAQ2fb7z9zsfORzCe1SaSTGGqYwvlaTx6tVLwDXGUcl4ggoMagNVbeV5wyFQzuVXUigsqEJCNZGFIQWnAlZUg1khJJjSkhuoKC9xDDJNLS6W2hAdU6HJV2ZWpLEiseREsyvsgCfUZrLhrXaz5cUA3rz66Iwb30yYvb5Pd42NokLT2DApSKGYVMxs2oBCqpzyNvSXknJmNkSmRKOqWNyagMKs5FS1OVJIEyIFb83jtjkPYEuNJJV2WKicI93lhCmM3TzKXFDVzAoFjTgmnVhd8yItOSfGQmr8PtwyCC3Q6C8cXtiTM4C7Ym4taWmkDVEnQlhecBYzQzRym24qFSkLy47WUOIh-G6rrI-ImnhFtKEGcxSmPfF73oRGZUhKtSEFNatHgfKSG1bYDzJhKYupzUFbsri-dXS6cXLFsiuakT8ka9-7Oui6sG2iIiEsE1IhEdKQimlm3dTD1oQJEsuii2YscTXf651GbaWBGJajLE2bB3-LfxJAGFQV5XsXv5DaZAq1BXCqMqxJaOlHlPzaOsmR77sgXMbNuhaG5ewKE1JQZZgtDxPCRIJr521_o7mMLx9VlLDZSZWgwoRwqlutm67bXXYEJwpXMkdbVOdaupSsMuuCs1p3CWc5aw127P__tMG4JqhGQBTGVHetw33QimkjM0XzJ6HcWrjLwNCnxdsltJsWdkldkRGjsvxQs5xxaoWemJVCvZK8taX-4YmDKkxRES7lZVm4_dNOP9LLzqBKFjSzc2SiKE1NASayDphCZ9iE2jtDN0D9hRNNU2xI05XVVvEexV17BzORkbsBuGu9QGVKFTkleyLe3hx2cKrkSAolIxoxvufmbXGjqEhkTjS270SNZDleSdEqJu_CqTPbUbjH9KUUkSxFUksH5Rx59_XnYLEU2ijKrNIIaVW4cqTYkZ1HXsEVxkaqfQ8p4XnTRTAJAwgnL88D18XDoow4iw_X0PeeUZjNw1OYX4Qwf3d-PvCeRc1J_W16MV-Gi8lsHsKaFJe4gbeL2ZvJ4iP8FnyEPoXJcnow8J7N5q-CD7AmEWHJGvqRO_cOzjxvch4GiwfDz-a_BtMQluEknC3D2XQJzz95AAB_uv_2r0erzD3nemPwB3fHzSXWG8On7WFt39t-_7xrr5AaTAg1vTH0jv3R6dAfDf0R-KOx7499v7djbB8oTLh3USksYOTvxnZa596wZlPYxHq7YCf1t8BdmJXwrcPjk9Hxifvtr8F_LTn6ISW7DH9c1d7n52d7uLmx3Cy_42bVxs3NA9wsb7l5z64iqbV8fbEIZj_Pa8vqABbB62ARzKfBEm752ad3xLY4R-yqm9ibB4nt6g0-vD2fzObQv3gbDiCYvz-AZXBubf8HrxcXb2A9gA38_kuwCCCCF3By5g2Hw6HHhEA1dC-_fqyk1gce3Fz_c3P97eb6G7iHyua7k_VPzTraX_62Xb-5vm4MthpkxnB0fDQaw6ejExjC0clnb8csZdyg0tA3qsQD798AAAD__0aExds=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQY7kNNdBA564brq4C21C1stWhQFQUtHMheKZElKsTMM6EPkck-XJxlIKYmDRVaCobkILOl85_c7HzkcwifUhkkxhqlMLrSkyebtG8AtJuuS8RQ1WDQWqtoqCIZDoJzLS6I0KqqRUEOkskRxKmBDDdgNQooZLbmFivISxyCzzOESaSwxCRWGXDK7IY0VSSQnhl1hBzylLpMdb7WbrRYDeP_2izdufDNhD_o-3Te2mgpDE8ukIEozqZndtQGF1AXlbejvJeXM7ojMiEFdsaQ1AY15yaluc6SRpkQK3prHbXMewZYGSSbdsFB7R6bLCdOY-HmUhaC6mRUKuuaYdmJNzYus5JxYB6nxh3CrKHZAa75zeO3enAHcF3NrSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2tocRj8P1WOR9rapMNMZZaLFDY9sQfeBMGtSUZNZYoajdPAhUlt0y5HzJlGUuoy8E4svi-dXS6cXLF8iuakz8la9-7OuhWuTZRkRKWC6mRCGlJxQxzbuphG8IESaTqohlLfc0PemfQOGkglhUoS9vmIbzDPwsgLOqK8oOLr6SxuUbjAJzqHGsSOvoRLS9bJzkKQx-Ey6RZV2VZwa4wJYpqy1x5mBImUtx6b4cbzWVy8aSihMtO6hQ1poRT02rddN3tsic40biRBbqiOtfSp-SU2SjOat0lnBWsNdhJ-Otpg_FN0I2AaEyo6VqHh6ANM1bmmhbPQvm18IeBpc-Lt09oPy3skjqVE6vz4tiwgnHqhJ7YjUazkby1peHxKw_VmKEmXMqLUvn9M14_sovOoFoqmrs5MqFKW1OAibwDptEbNqEOztAP0HznxNAMG9J0ZXWneE_irjuDmcjJ_QD8sa5Q21KvvZI9E-9ODjc4XXIkSss1XTN-4ORtcaOpSGVBDLbvRI1kBV5J0SomH-OpN9tTuKf0pRRrWYq0lg7KOfLu48_DEimM1ZQ5pRHSqXDlSbEnO088gitMrNSHLlIiCKbLaBJHEE_enEe-i8eqXHOWHG-hH7ygMJvHpzBfxDD_eH4-CF6smzf103QxX8XLyWwew5aoC9zBh-Xs_WT5Bf6IvkCfwmQ1PRoEL2bzt9Fn2JI1YekW-mv_Pjg6C4LJeRwtHw0_m_8eTWNYxZN4topn0xW8_BoAAPzl_7u_Hq1yf53rjSEc3L9uDrHeGL7evazte3fP3_btNVKLKaG2N4beSTg6HYajYTiCcDQOw3EY9vaM3QWFCX8vKoUDjML92F7r_B3W7pRLrLcP9lJ_C9yHOQm_c3jyanTyyn_7e_B_S17_lJJ9hj-v6uDby7MD3Nw5bpb_4WbVxs3dI9wsb7n5wK4imbN8t1hGs9_mtWV1BMvoXbSM5tNoBbf87NN7YjucJ3bVTezdo8T29UafP5xPZnPoLz7EA4jmn45gFZ0721_g3XLxHrYwWYEUOKh_2Ut5FgyHw2HAhEA99He_fqKlMUcB3Fz_c3P94-b6B_iryha-UvNaCvzW8sleSv_puvmUMW5RG-hbXeJR8G8AAAD___poukY=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dLpxcsXyK5qTvyRr37s66Fq5NlGREpYLqZEIaUnFDHNu6mEbwgRJpOqiGUt9zQ96Z9A4aSCWFShL2-YhvMM_CSAs6oryvYuvpLG5RuMAnOocaxI6-hEtv7VOchCGPgiXSbOuyrKCXWFKFNWWufIwJUykuPbe9jeay-TyUUUJl53UKWpMCaem1brputtlT3CicSULdEV1rqVPySmzUZzVuks4K1hrsJPw59MG45ugGwHRmFDTtQ4PQStmrMw1LZ6E8mvhLwNLnxZvm9B-WtgldSonVufFsWEF49QJPbErjWYleWtLw-Ohh2rMUBMu5WWp_P4Zrx_ZZWdQLRXN3RyZUKWtKcBE3iWRGr1lE6se4kv4ZbhTLf0MzVdODM2w4U1XYnei9yj6umuYiZzcz8Df7Aq1LfXSi9kT8e7ycLPTJUeitFzSJeN7Lt8WN5qKVBbEYPta1EhW4JUUrXryPp54sy2Re0xfSrGUpUhr9aCcI---AT0skcJYTZkTGyGdEFeeF1vK88hbuMLESr3vLSWCYDKPxnEE8fjVeeS7eKzKJWfJ8RoOgmcUprP4FGYXMczen58fBc-WzUn9NbmYLeL5eDqLYU3UJW7g3Xz6djz_BH9En-CAwngxOTwKnk1nr6OPsCZLwtI1HCz9eXB4FgTj8zia7ww_nf0eTWJYxON4uoinkwU8_xwAAPztf7ufHq1y_6LrjSA8uj9u7rHeCD7fHdb2vbvvL9v2GqnFlFDbG0HvJByc9sNBPxxAOBiF4SgMe1vG7o3ChH8alcIBBuF2bC93_hlrN8ol1tsGe7W_BW7DnIrfOTwZDk6G_n__HP3fkpc_pGSf4Y-rOvjy_GwPNzeOm-V_uFm1cXOzg5vlLTcf2FUkc5ZvLubR9NdZbVkdwjx6E82j2SRawC0_D-g9sR3OE7vqJvZmJ7F9vdHHd-fj6QwOLt7FRxDNPhzCIjp3tj_Bm_nFW9jAn79F8whKeAnDs6Df7_cD_xTZBHBzfX1z_f3m-jvcKYgdwYvBCD6_GEIfXgy_BP8GAAD__--cnfk=

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dLpxcsXyK5qTvyRr37s66Fq5NlGREpYLqZEIaUnFDHNu6mEbwgRJpOqiGUt9zQ96Z9A4aSCWFShL2-YhvMM_CSAs6oryvYuvpLG5RuMAnOocaxI6-hEtv7VOchCGPgiXSbOuyrKCXWFKFNWWufIwJUykuPbe9jeay-TyUUUJl53UKWpMCaem1brputtlT3CicSULdEV1rqVPySmzUZzVuks4K1hrsJPw59MG45ugGwHRmFDTtQ4PQStmrMw1LZ6E8mvhLwNLnxZvm9B-WtgldSonVufFsWEF49QJPbErjWYleWtLw-Ohh2rMUBMu5WWp_P4Zrx_ZZWdQLRXN3RyZUKWtKcBE3iWRGr1lE6se4kv4ZbhTLf0MzVdODM2w4U1XYnei9yj6umuYiZzcz8Df7Aq1LfXSi9kT8e7ycLPTJUeitFzSJeN7Lt8WN5qKVBbEYPta1EhW4JUUrXryPp54sy2Re0xfSrGUpUhr9aCcI---AT0skcJYTZkTGyGdEFeeF1vK88hbuMLESr3vLSWCYDKPxnEE8fjVeeS7eKzKJWfJ8RoOgmcUprP4FGYXMczen58fBc-WzUn9NbmYLeL5eDqLYU3UJW7g3Xz6djz_BH9En-CAwngxOTwKnk1nr6OPsCZLwtI1HCz9eXB4FgTj8zia7ww_nf0eTWJYxON4uoinkwU8_xwAAPztf7ufHq1y_6LrjSA8uj9u7rHeCD7fHdb2vbvvL9v2GqnFlFDbG0HvJByc9sNBPxxAOBiF4SgMe1vG7o3ChH8alcIBBuF2bC93_hlrN8ol1tsGe7W_BW7DnIrfOTwZDk6G_n__HP3fkpc_pGSf4Y-rOvjy_GwPNzeOm-V_uFm1cXOzg5vlLTcf2FUkc5ZvLubR9NdZbVkdwjx6E82j2SRawC0_D-g9sR3OE7vqJvZmJ7F9vdHHd-fj6QwOLt7FRxDNPhzCIjp3tj_Bm_nFW9jAn79F8whKeAnDs6Df7_cD_xTZBHBzfX1z_f3m-jvcKYgdwYvBCD6_GEIfXgy_BP8GAAD__--cnfk=

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dazxcsXyK5qTvyQTe5rXBF4r1yoqUsJyITUSIS2pmGHOUz1wQ5ggiVRdVGOpr_tB_wwaJw_EsgJlads8hHf4JwGERV1Rvnf5lTQ212gcgFOdY01ER0Gi5bfWaQ7C0AfhMmlWVllWsCtMiaLaMlcepoSJFNfe2_4Jc5lcPqoo4bKTOkWNKeHUtFo3XXf77ElONK5kga6oztX0KTl1NoqzWnsJZwVrDXYS_nzaYHwTdCMiGhNqulbiIWjFjJW5psWTUH41_IVg6dPibRPaTwu75E7lxOq8ODasYJw6sSd2pdGsJG9taXg89FCNGWrCpbwslV9B4zUku-wMqqWiuZsjE6q0NQWYyLuWXqO3bGLVQ3wJvwx3Lr2fofnKiaEZNrzpSuxO-B5FX3cVM5GT-xn4212htqVeekF7It5dIG52uuRIlJZLumR8zwXc4kZTkcqCGGxfixrJCrySolVP3scTb7Ylco_pSymWshRprR6Uc-Tdt6CHJVIYqylzYiOkE-LK82JLeR55E1eYWKn3vadEEEzm0TiOIB6_Oo98F49VueQsOV7DQfCMwnQWn8LsIobZ-_Pzo-DZsjmpvyYXs0U8H09nMayJusQNvJtP347nn-CP6BMcUBgvJodHwbPp7HX0EdZkSVi6hoOlPw8Oz4JgfB5H853hp7Pfo0kMi3gcTxfxdLKA558DAIC__W_306NV7l91vRGER_fHzT3WG8Hnu8Pavnf3_WXbXiO1mBJqeyPonYSD03446IcDCAejMByFYW_L2L1TmPDPo1I4wCDcju3lzj9l7Ua5xHrbYK_2t8BtmFPxO4cnw8HJ0P_vn6P_W_Lyh5TsM_xxVQdfnp_t4ebGcbP8DzerNm5udnCzvOXmA7uKZM7yzcU8mv46qy2rQ5hHb6J5NJtEC7jl5wG9J7bDeWJX3cTe7CS2rzf6-O58PJ3BwcW7-Aii2YdDWETnzvYneDO_eAsb-PO3aB5BCS9heBb0-_1-4J8imwBurq9vrr_fXH-HOwWxI3gxGMHnF0Pow4vhl-DfAAAA__9dr55b

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCRlWJoLoKIOd_5_c5HDofwDrVhUkxgJtNLLWm6fvkCcINpUjGeoQaLxkLdWAXBcAiUc_mFKI2KaiTUEKksUZwKWFMDdo2QYU4rbqGmvMIJyDx3uFQaS0xKhSFfmF2T1oqkkhPDrrAHnlGXyZZ32s1XF0fw-uUHb9z6ZsLu9X26a2w1FYamlklBlGZSM7vtAgqpS8q70J8rypndEpkTg7pmaWcCGouKU93lSCPNiBS8M4-b5jyArQySXLphofaOTJ8TpjH186hKQXU7KxQ04Zj1Yk3Di7zinFgHafD7cKsodkBrPnN47k7OAO6KubGklZUuRJMIYaXiLGWWGOQu3VxqUinHjs5Q4iH4bqucj4TadE2MpRZLFLY78XvehEFtSU6NJYra9aNAZcUtU-4PmbGcpdTlYBxZfN_6OtZ6uWLFFS3IX5KJPc1rA2-UaxUVGWGFkBqJkJbUzDDnqRm4IUyQVKo-qrHM132vfwaNkwdiWYmysl0ewlv8dwGERV1Tvnf5lTS20GgcgFNdYENER0Gi5ZfOaY7C0AfhMm1XVllWsivMiKLaMlceZoSJDDfe2_4Jc5lePqoo4bKTOkONGeHUdFq3XXf77ElONK5lia6o3tX0KTl1NoqzRnsJZyXrDHYS_nzaYnwTdCsiGlNq9q6EI-Z91JoZKwtNS9NLz_tAvx7-UrC0bw3vI3dJ7SeGfZKnCmJ1UR4bVjJOneATu9Zo1pJ3tjU8Hnuoxhw14VJeVsqvofE6kl_2BtVS0cLNkglV2YYGTBR9i6_RW7axmkE-h1_GD3bWz9F85sTQHFvu9CV2K36PorC7jpkoyN0M_A2vUNtKJ17UvhPvLhE3O11xJErLhCaM77mEO9xoKjJZEoPdq9EgWYlXUnRqytt45s12hO4xfalEIiuRNQpCOUfefxN6WCqFsZoyJzhCOjGuPS921OeRt3GNqZV635tKBMFsGU3jCOLpi_PId_FYVQln6fEGDoInFOaL-BQWFzEs3p6fHwVPkvak-ZpdLFbxcjpfxLAh6hK38GY5fz1dfoA_og9wQGG6mh0eBU_mi5fRe9iQhLBsAweJPw8Oz4Jgeh5HywfDzxe_R7MYVvE0nq_i-WwFTz8GAAB_-9_uZ0Drwr_sBhMIj-6O27tsMIGPt4eN_eD2-9OuvUZqMSPUDiYwOAlHp8NwNAxHEI4mYTgJw8GOsXurMOGfSJVwgFG4G9srnn_O2q1yiQ12wV7xb4C7MKfktw5PxqOTsf_fP0f_t-Tkh5TsM_xxVQefnp7t4ebWcbP6DzfrLm5uH-BmdcPNe3Y1yZ3lq4tlNP910VjWh7CMXkXLaDGLVnDDzwN6R2yH88Su-4m9fZDYvt7o_Zvz6XwBBxdv4iOIFu8OYRWdO9uf4NXy4jVs4c_fomUEFTyH8VkwHA6HgX-ObAP4dn397frrt-uvcKsgdgLPRhP4-GwMQ3g2_hT8GwAA__-YWJ69

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6IUzn-YQgc9MJ11c1b6hS22rUoCoKSjmQuFMmSlGpnGNCHyBP2SQZSSuKgkZViaC6CiDnf-fudjxwO4R1qw6SYwEyml1rSdP3yBeAG06RiPEMNFo2FurEKguEQKOfyC1EaFdVIqCFSWaI4FbCmBuwaIcOcVtxCTXmFE5B57nCpNJaYlApDvjC7Jq0VSSUnhl1hDzyjLpMt77Sbry6O4PXLD9649c2E3ev7dNfYaioMTS2TgijNpGZ22wUUUpeUd6E_V5QzuyUyJwZ1zdLOBDQWFae6y5FGmhEpeGceN815AFsZJLl0w0LtHZk-J0xj6udRlYLqdlYoaMIx68Wahhd5xTmxDtLg9-FWUeyA1nzm8NydnAHcFXNjSSsrXYgmEcJKxVnKLDHIXbq51KRSjh2docRD8N1WOR8JtemaGEstlihsd-L3vAmD2pKcGksUtetHgcqKW6bcHzJjOUupy8E4svi-9XWs9XLFiitakL8kE3ua1wbeKNcqKjLCCiE1EiEtqZlhzlMzcEOYIKlUfVRjma_7Xv8MGicPxLISZWW7PIS3-B8CCIu6pnzv8itpbKHROACnusCGiI6CRMsvndMchaEPwmXarqyyrGRXmBFFtWWuPMwIExluvLf9E-YyvXxUUcJlJ3WGGjPCqem0brvu9tmTnGhcyxJdUb2r6VNy6mwUZ432Es5K1hnsJPz_aYvxTdCtiGhMqdm7Eo6Y91FrZqwsNC3Nfnp-j_T74W8FS20P-rtkd4ntp4Z9sqcKYnVRHhtWMk6d6BO71mjWkne2Njwee6jGHDXhUl5Wyq-i8VqSX_YG1VLRws2TCVXZhgpMFH3Lr9FbtrGaYT6HX8YP9sfP0nzmxNAcW_70JXYrgI-isbuSmSjI3Qz8La9Q20onXth-EO8uEjc7XXEkSsuEJozvuYg73GgqMlkSg93r0SBZiVdSdOrK23jmzXbE7jF9qUQiK5E1KkI5R95_G3pYKoWxmjInOkI6Qa49L3YU6JE3co2plXrfu0oEwWwZTeMI4umL88h38VhVCWfp8QYOgicU5ov4FBYXMSzenp8fBU-S9qT5ml0sVvFyOl_EsCHqErfwZjl_PV1-gD-iD3BAYbqaHR4FT-aLl9F72JCEsGwDB4k_Dw7PgmB6HkfLB8PPF79HsxhW8TSer-L5bAVPPwYAAH_73-5nQOvCv-4GEwiP7o7b-2wwgY-3h4394Pb70669RmoxI9QOJjA4CUenw3A0DEcQjiZhOAnDwY6xe68w4Z9JlXCAUbgb26uef9LarXKJDXbBXvVvgLswp-a3Dk_Go5Ox_98_R_-15OSnlOwz_HlVB5-enu3h5tZxs_qOm3UXN7cPcLO64eY9u5rkzvLVxTKa_7poLOtDWEavomW0mEUruOHnAb0jtsN5Ytf9xN4-SGxfb_T-zfl0voCDizfxEUSLd4ewis6d7f_g1fLiNWzhz9-iZQQVPIfxWTAcDoeBf5JsA_h2ff3t-uu3669wqyB2As9GE_j4bAxDeDb-FPwbAAD__xVynx8=

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVt9PG0kMfs9fMY93p6YK0BauqA9cuichQehBQL0na7Lr3fiYHU88M-HHX3-a2W0LEpuFtxX4--yxP3_OdKpuUDyx_azmXN4K63L99S-F91iuIpkKRQX0QW27qMlkOlXaGL4DJ-i0IGgP7AI4o61aa6_CGlWFtY4mqK02ET8rruuEK9kH8KW2Hu4orKGPgpINeHrEEXilUyUPZjDu9OrinTr_-m8O7rnJhp3cR0-Dg2jrdRmILTghFgoPQ0DL0mozhN5EbSg8ANfgUbZUDhYg2ESjZYhIUFfA1gzW8aM5L2CjR6g5DQslE_kxEhIs8zxia7X0s0KrVwarUazvdFFHYyAkSIffhbsqlgkY_MaoL-kvx0r9esyPSB0DpxRdIUCtM1RSAI8mlVuzQHRJHYOp7Evwp61KHCsdyjX4oAO2aMNw4c_YrEcJUGsfwOmwfhWojSaQSx9cUU2lTjX4JJbct5FO9ySP1DzqBv5jGt67Lum9S23StgJqLAuC5QBb8pRoumF7IAsluzGZUZXf_Kx3Hn2yBgjUIscwxDD7iX8TwAaUrTY7F9-xD42gTwCjpcFOhEl-IHw3OMm92SwnMVz26-oCtfSIFTgtgdLzsAKyFd5ntt2NNlzevupRNlXHUqFgBUb7wei-62mXs8BBcM0tpkeNrmUuKTmzd4Y63wVDLQ0m2599OOoxuQnSG4hgqf3YOjwHrckHbkS3b0LltcjHIOi35Xsq6DwtHLM610CQpn3vqSWjk9FDWAv6NZvBls7eH2SoYI0Chvk2urx_PvtHfTuaVNjpJs2RrIuhkwDZZswiBXNkn6sb4hf16eBFt8wz9BsDXtfY62assJ-m9yr5pjNMtoFfM8iX3aGEKKtsZm_Ep-ORZifRIDjhlV6R2XF8B2hE24pb8Di8Fh2SWnxkO-gn18t5Dnticq_pS7Qrjrbq3EMbg2b8AmZYydYH0ZTMxnIy4m3WxRPneeUV3mIZWHb9lrKTyfyyOFkW6qr457pYzAvl4spQ-d7jRp2fLm5Ozq4LtafOT753n3_u7x8cHO7PDj4dffxwePjxaHaoThfzy-K8WCzVnrpanlwu1d7xZFJ8_3Z2crpQv118W75TxeLmd3VVnBXzpfpD_X15ca48bo4n0-l0OvG4iWhLnHZHPP1n8n8AAAD__wJxx3A=

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvo6e4sA3tQc7keNhCBwUmOuqm7fUKWz1D0VBUNKRzYUiVZJS7AwDij1DLvd0eZKBlJw4a2QnGJqLwKbPd36_85G9HrxDpZkUQxjL-EJJGi9fvgBcYRwVjCeowKA2UFZWntfrAeVcXpJcYU4VEqqJzA3JORWwpBrMEiHBlBbcQEl5gUOQaWpxsdSG6JgKTS6ZWZLaisSSE82ucA88oTaTNW-0m8zPu_D65UdnXPtmwuz0fbJtbBQVmsaGSUFyxaRiZt0EFFJllDehvxSUM7MmMiUaVcnixgQULgpOVZMjhTQhUvDGPDbNeQBbaCSptMNC5RzpfU6YwtjNo8gEVfWsUNCIY7IXqytepAXnxFhIhd-FmwehBRr9hcNze3IKcFfMxpIWRtoQVSKEZTlnMTNEI7fpplKRIrfsaAwlHoJvt8r6iKiJl0QbajBDYZoTv-dNaFSGpFQbklOzfBQoK7hhuf0gE5aymNoctCWL69ueTtdOrtjiii7IH5I1710VdJXbNlGRELYQUiER0pCSaWbdVMPWhAkSy3wfzVjiar7XO43aSgMxLENZmCYP_i3-SQBhUJWU71z8XGqzUKgtgFO1wIqEln5EycvGSfZ93wXhMq7XNTcsY1eYkJwqw2x5mBAmElw5b7sbzWV88aiihM1OqgQVJoRT3Whdd93usiM4UbiUGdqi9q6lS8kqs845q3SXcJaxxmDH_o8nNcY1QdUCojCmet863ActmTZyoWj2JJRbC3cZGPq0eNuEdtPCfVKXL4hRi-xQs4xxaoWemKVCvZS8saX-4cBBFaaoCJfyosjd_mmnH-nF3qBK5nRh58hEXpiKAkws9kmkQmdZx6qG-Bx-Gjyolm6G-gsnmqZY82ZfYrei9yj62muYiQW5m4G72XNUplCRE7Mn4u3lYWenCo4kVzKiEeM7Lt8GN4qKRGZEY_NaVEiW4ZUUjXryNhw7sy2Re0xfChHJQiSVelDOke-_AR0slkIbRZkVGyGtEJeOF1vK88hbuMTYSLXrLSU8bzwLRmEA4ejFWeC6eJgXEWfx4Qra3gGFyTQ8gel5CNO3Z2dd7yCqT6pv4_PpPJyNJtMQViS_wDW8mU1ej2Yf4ffgI7QpjObjTtc7mExfBh9gRSLCkhW0I3fudU49b3QWBrMHw0-mvwXjEObhKJzMw8l4Ds8-eQAAf7r_9q9Fy4V70bWG4Hfvjut7rDWET7eHlX3r9vvnbXuF1GBCqGkNoXXs9096fr_n98HvD31_6PutLWP7RmHCPY0KYQF9fzu2kzv3jDXr3CbW2gY7td8At2FWxW8dHg_6xwP321_d_1ty9F1Kdhl-v6q9z89Od3BzbblZfMPNsomb6we4WWy4ec-uJKm1fHU-Cya_TCvLsgOz4FUwC6bjYA4bfrbpHbEtzhG73E_s9YPE3q733SR4vwlTui20e9f1Dgpbo9eB0RzmwZn1QbsQdaHoQgmvZuev729Q9z9x3_8azAKI4DkMTj0v-PDmbDSZQvv8TdiFYPqus3H6Q-WrPPV6vV7PY0Kg6rmnZTtWUuuOBzfX_9xcf725_gruJbT-5mT1c73s9pe_7Uxvrq9rg1uFM0M4Oj7qD-HT0QB6cDT47G2ZpYwbVBraRhXY8f4NAAD__2YZ32s=

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVt9v20YMfq7-intrM8RBtg5D0KAPrusB3hwnsNViwTAQtETJt5zuLjzK-fHXD3dy22SILOfNMPh95JEfP2o0Ul-Jg3b2g5q44oYdFpvPnxTdU7FutSmJlVAQte2ismw0UmiMuwPP5JEJMIDzAt6gVRsMSjakSqqwNaK2aFr6oFxVRVzhgkAo0Aa407KBXRQUzkDQjzQALzFW8mB642ary2N18fk6Be-4tZW93GdPg4XRBixEOwuetWMtD31A67hB04e-bdFoeQBXQSDe6qK3AKa6Nch9RExYgrOmt45vzXkB2waCysVhESeiMESimYo0j7axyLtZkcW1oXIQGzpdVK0xIBHS4ffhVtM8AiXcGvUx_nOu1I_HfIvEVlxM0RUCuvFGF1ogkInlVo6h9VEdvansS_CnrYoca5RiA0FQqCEr_YU_Y7OBWKDCIOBRNgeBmtaI9vGHK3WlC4w1hCiW1LeBTu9IHnX9iDX863T_3nVJ731sE9oSdG0dE1gnsNVBR5pu2AG0hcL5IZnpMr35We8ChWgNILoh10ofw-l3_KsAVoi3aPYuvndBaqYQAQa5pk6EUX7A7q53kj-fnqYkxhW7dfWiG_1IJXhk0fF5VIK2Jd0ntv2NNq64OehRNlbnuCSmEgyG3uhd1-MuJ4ED08Y1FB81uJappOjMwRvd-S4Y3ejeZL-c_nq2w6Qm8M5AmAoMQ-vwHLTRQVzN2LwKldYiHQPB1-V7Kug0LRqyOl-DcN2cBN1og9HoQTZMYeNMb0tPT94nKFNFDMa5m9an_QvJP6qbwaTsPNZxjtr6VjoJaFsPWSRTitzl6ob4Uf32_kW3TDMMtwYCVrTTzVBh303vIPnGM6xtDT9mkC67J5aW18nMXomPxyPOjltD4Nmtca3NnuPbQ8NoS9dAoP616JC6oUdne_3kSz5JYU9M7pC-tHbtWlt27oHGkBm-gAlWOBuEUUezsS4a8Tbp4onzHHiFt1SI433fUjbLJsvpOJ-qfPxpPk1dPAknot5lb1DNFvmZWlzmavFlPj_O3kwuF6t8OZ4tciXgb-hBXS1nF-Pltfpzeq3eoRqvJkfZ0XmWjef5dPl_ztnij-kkV6t8nM9W-WyyUm___ufteZZN_7qaj2cL9e7yKj9W08XXI7WazmPsT-r35eWFCidyno1Go1GWfFey_wIAAP__DgfN9A==

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1u3EgP3fcpamkD7sD-8mEQJPAik3gRIJMEsGPMrAi2REkcl4plFtX-WeUQPqFPMqiSktiA1bJ3jQYfyXp8fNR67c5JE0t46z5IdaGCVffxT0fXVG0G9jWpM0rmtmPUarVeO_ReriAqRVQCTCDRIHoMrsPkrCNXU4ODN7dFP9BbJ02TcZUkg1RhSHDF1sEUBZV4SHxLC_Aacyc3fjbu0-nXA_fXx39K8JSbg-3M_eZhsCmGhJWxBIjKomw3c8Ag2qNfnZ6cPQm_HNCz3YA0kEi3XJE7dhusLlqVIdTvnPtd92dKpXbwqHMdKWENEvxsSz95egI7JIJG8txIS6K0lISVqjKaoQ-o09go4MZTvYhNo0SawXuwDBnxu3CFSE6WLr07zv88SREOJrnE2AhwHz1XbJDI53YbURhiFspsqfAU_CFVOccGreogGRr1FGy-8UfZQiI1aDAZRLTuWaB-8MYx_5CaG64w95CybApvC0xPSW65vcUW_hWeX8Gx6HXMNGGogdsgShDEYMuJc5px2Ak4QCVxSWZclzc_4i5Ryi4Bxj3JYHMZDn_hXwQIRrpFv9MDoiRrlVIGeNSWRhFm-YHK1ewkjw4PSxEv1bS40bjnW6ohohrn51ENHGq6Ltl2E-2lunjWo0LuTrQmpRo8ptnoifW8y0XgoNRJT_lRi2tZWsomnaLn0YLBc8-zxf53-P83E6aQoJOBKFWYltbhMajjZNIq9i9ClbUod8HwZfUeCrpMi5asLrZg2vavEvfsMXs-WKeUOvGzlB6-el2gSg0peJGLIZb9S8U_movFoioR2zxHDnGwUQIc2iWLVCqRU61xiMfuj9dPumWZYbr0kLChSTdLjf0yvWfJN19kDi38nkE58pHUBt0UM3shPh-PPDsdPEFU2eCG_Y47PJNGMdTSQ6L5tRiR3NOthFk_-X72oYQ9MLnn8DKETT7zo3ug9-SXL2CBVRKSKXI2myDZiLdFFw-c55lXeEuVie76rAqr1cnf3z6___TF7X39dnbgTr6c77vz95-_n5y6vaP9d6v1er1elfC0cvd3d_d3P-7vfri9o4P91X8BAAD__8fGs20=

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs9OHMkPvs9T1BEkJoJfflpFiThkEw6RskkkCNo9WZ5qd4-X6nLhcg9_TnkInpAnWVX1JAGJnobbaOTPdn3-_LmXS3dOmlniW_dB_IUK-vXHPx1dk18NHBpSZ5TNbcaoxWK5dBiCXEFSSqgEmEGSQQoY3RqzszW5hlocgrkNhoHeOmnbgvOSDbLHmOGKbQ3bKPASIPMtzcAbLJ3chMm4T6dfD9xfH_-pwdvcHG1n7jcPg00xZvTGEiEpi7LdTAGjaI9hcXpy9iT8csDAdgPSQibdsCd37LyyscfwzrnfVX8mVOqGgDrVjxI2IDFMNvSTpSewQyZopUyNtCbKc0lYydfBDH1E3Q6NIq4CNbPYPAqkHUIAK5ARvwtXaeRs-TK44_LPkxThYFJKjI0A9ymwZ4NMobTbisKQikwmS8Wn4A-pKjlWaH4N2dCop2jTjT_KFjOpQYvZIKGtnwXqh2Ccyg9puGWPpYdcRFN5m2F6m-SWu1vs4F_h6QUci16nQhPGBriLogRRDDacuaQZh52BI3hJczLjpr75EXeZcvEIMO5JBpvKcPgL_yJANNINhp0OkCRbp5QLIKB2NIqwyA9UriYneXR4WIsE8du1TcY931IDCdW4PI8a4NjQdc22m-gg_uJZj4qlO9GGlBoImCejt6yXXa4CB6W19FQeNbuWtaVi0TkFHg0YAvc8Wex_h_9_s8VUEnRrIEoe89w6PAatOZt0iv2LUHUt6lUwfFm9h4Ku06I5q0sdmHb9q8w9ByyOD7ZWymsJk5QevnpdoUotKQSRiyHV_cvVP9qL2aIqCbsyR45psFECHLs5i1Sqkdta4xCP3R-vn3TLOsN8GSBjS1vdzDX2y_SeJd9yjzl28HsG9cQnUht0Vc3shfhyPMrsdAgESWWFKw47rvBEGsXYSA-ZptdiRHJPtxIn_eT72Yca9sDknsPLEFcyxGZ0DwyBwvwFrDAvMZsiF7OJUox4U3XxwHmeeYU35E1010dVXCxO_v72-f2nL27v67ezA3fy5Xzfnb___P3k1O0d7b9bLJfL5aKG54W7v7u7v_txf_fD7R0d7C_-CwAA__9st7KY

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6DNF7AKupG2TYQnmGZcKMBcGFxSTa2batgaU45jIdtoRhNX85veadBWI7ChOYjCNHnwX_AfAnADqiTsqAJIoU2mQFsAIyqDioSWfliJp8ZJDnzfBWEirq-tNDSnO0iwJMpQWx4kmPIENs7b8UYzEa_fVRS32QmVgIIEM6Ibreuu27vsCI4VrEQOtqjWa-lSshKtJaOVAGNGc9oY7Nz__2WNcU1QtYAoiIluuw5vQSuqjcgUyT-EctfCbQVDPhZvn9BuWtAmdTLDRmX5maY5ZcQqPjYrBXolWGNL_bMLB1WQgsJMiHUh3f3TTj_SdWtQJSTJ7Bwpl4WpKEB51iaRCpxlHasa4jX67eKgWroZ6keGNUmh5k1bYi-i9y762n1MeYZfZ-BWvARlChU5Mfsg3i4POztVMMBSiYhElB3Zwg1uFOGJyLGG5mtRIWkOO8Eb9eRLOHZmeyL3nr4UPBIFTyr1IIwBa9-ADhYLro0i1IoNF1aIS8eLPeV55xYuITZCHXtUcc8bL4JRGKBw9HkauC6eySJiND7boK53QtBkFl6i2TxEsy_Tac87ieqT6ms8ny3DxWgyC9EGyzVs0f1icjdaPKA_gwfUJWi0HJ_2vJPJ7Cb4hjY4wjTZoG7kzr3TK88bTcNgcTD8ZPZHMA7RMhyFk2U4GS_Rp-8eQgj97X7bnw4pM_e06wyR33s9rvdYZ4i-vxxW9p2X7x_79gqIgQQT0xmizrk_uOz7g74_QP5g6PtD3-_sGds3CuXuaVRwCxj4-7Gd3Ln3rNlKm1hnH-zU_hm4D7Mq_uLw_GJwfuH-90_vv5Yc_ZKSXYa_rmrvx6erI9zcWm4WP3GzbOLm9gA3i2duvrErcWotb-eLYPL7rLIsT9EiuA0WwWwcLNEzP7vkldgW54hdthN7e5DYx-vd2Xrl-qeCFaRNJe8OlCzXB2pO12-rVZAeqnfbLY7XtWuuK_h2Px1NZqg7vw97KJh9PUXLYGpt_4duF_M7tLvy-v1-33PPqp33bwAAAP__N2_MWQ==

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6DNF7AKupG2TYQnmGZcKMBcGFxSTa2batgaU45jIdtoRhNX85veadBWI7ChOYjCNHnwX_AfAnADqiTsqAJIoU2mQFsAIyqDioSWfliJp8ZJDnzfBWEirq-tNDSnO0iwJMpQWx4kmPIENs7b8UYzEa_fVRS32QmVgIIEM6Ibreuu27vsCI4VrEQOtqjWa-lSshKtJaOVAGNGc9oY7Nz__2WNcU1QtYAoiIluuw5vQSuqjcgUyT-EctfCbQVDPhZvn9BuWtAmdTLDRmX5maY5ZcQqPjYrBXolWGNL_bMLB1WQgsJMiHUh3f3TTj_SdWtQJSTJ7Bwpl4WpKEB51iaRCpxlHasa4jX67eKgWroZ6keGNUmh5k1bYi-i9y762n1MeYZfZ-BWvARlChU5Mfsg3i4POztVMMBSiYhElB3Zwg1uFOGJyLGG5mtRIWkOO8Eb9eRLOHZmeyL3nr4UPBIFTyr1IIwBa9-ADhYLro0i1IoNF1aIS8eLPeV55xYuITZCHXtUcc8bL4JRGKBw9HkauC6eySJiND7boK53QtBkFl6i2TxEsy_Tac87ieqT6ms8ny3DxWgyC9EGyzVs0f1icjdaPKA_gwfUJWi0HJ_2vJPJ7Cb4hjY4wjTZoG7kzr3TK88bTcNgcTD8ZPZHMA7RMhyFk2U4GS_Rp-8eQgj97X7bnw4pM_e06wyR33s9rvdYZ4i-vxxW9p2X7x_79gqIgQQT0xmizrk_uOz7g74_QP5g6PtD3-_sGds3CuXuaVRwCxj4-7Gd3Ln3rNlKm1hnH-zU_hm4D7Mq_uLw_GJwfuH-90_vv5Yc_ZKSXYa_rmrvx6erI9zcWm4WP3GzbOLm9gA3i2duvrErcWotb-eLYPL7rLIsT9EiuA0WwWwcLNEzP7vkldgW54hdthN7e5DYx-vd2Xrl-qeCFaRNJe8OlCzXB2pO12-rVZAeqnfbLY7XtWuuK_h2Px1NZqg7vw97KJh9PUXLYGpt_4duF_M7tL3y-v1-33PPqq33bwAAAP__N17MVw==

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6DNF7AKupG2TYQnmGZcKMBcGFxSTa2batgaU45jIdtoRhNX85veadBWI7ChOYjCNHnwX_AfAnADqiTsqAJIoU2mQFsAIyqDioSWfliJp8ZJDnzfBWEirq-tNDSnO0iwJMpQWx4kmPIENs7b8UYzEa_fVRS32QmVgIIEM6Ibreuu27vsCI4VrEQOtqjWa-lSshKtJaOVAGNGc9oY7Nz__2WNcU1QtYAoiIluuw5vQSuqjcgUyT-EctfCbQVDPhZvn9BuWtAmdTLDRmX5maY5ZcQqPjYrBXolWGNL_bMLB1WQgsJMiHUh3f3TTj_SdWtQJSTJ7Bwpl4WpKEB51iaRCpxlHasa4jX67eKgWroZ6keGNUmh5k1bYi-i9y762n1MeYZfZ-BWvARlChU5Mfsg3i4POztVMMBSiYhElB3Zwg1uFOGJyLGG5mtRIWkOO8Eb9eRLOHZmeyL3nr4UPBIFTyr1IIwBa9-ADhYLro0i1IoNF1aIS8eLPeV55xYuITZCHXtUcc8bL4JRGKBw9HkauC6eySJiND7boK53QtBkFl6i2TxEsy_Tac87ieqT6ms8ny3DxWgyC9EGyzVs0f1icjdaPKA_gwfUJWi0HJ_2vJPJ7Cb4hjY4wjTZoG7kzr3TK88bTcNgcTD8ZPZHMA7RMhyFk2U4GS_Rp-8eQgj97X7bnw4pM_e06wyR33s9rvdYZ4i-vxxW9p2X7x_79gqIgQQT0xmizrk_uOz7g74_QP5g6PtD3-_sGds3CuXuaVRwCxj4-7Gd3Ln3rNlKm1hnH-zU_hm4D7Mq_uLw_GJwfuH-90_vv5Yc_ZKSXYa_rmrvx6erI9zcWm4WP3GzbOLm9gA3i2duvrErcWotb-eLYPL7rLIsT9EiuA0WwWwcLNEzP7vkldgW54hdthN7e5DYx-vd2Xrl-qeCFaRNJe8OlCzXB2pO12-rVZAeqnfbLY7XtWuuK_h2Px1NZqg7vw97KJh9PUXLYGpt_4duF_M7tLny-v1-33PPqo33bwAAAP__N03MVQ==

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHvXBddeHd1C5stWhRFAQtjWSuKZIlKcf2Yt99QUpJHFSyEiyaiyBi5szvmUMOBvAZtWFSjGAik42WNFm_ewu4w2RVMp6iBovGwrayCoLBACjn8o4ojYpqJNQQqSxRnApYUwN2jZBiRktuYUt5iSOQWeZwiTSWmIQKQ-6YXZPaiiSSE8MO2AFPqctkz1vtpsv5OXx499Ub176ZsCd9Xx8bW02FoYllUhClmdTM7tuAQuqC8mAZxY3wHyXlzO6JzIhBvWUJwhtINLMsofwG4DHqvUONecmpbstHI02JFLw1ofsuNWBLgySTbmqovSPT5YRpTPxgykJQXQ8NBV1xTDuxpiJIVnJOrINU-FM430ZmrPnB4Y07aWwRLa10IapECCsUZwmzxCB36WZSk1I5mrSGEk3w41Y5HytqkzUxllosUNj2xJ94Ewa1JRk1lihq188CFSW3TLk_ZMoyllCXg3Gk8X3r6HTt5MDyA83JX5K1L2AVdKdcm6hICcuF1EiEtGTLDHNuqmEbwgRJpOqiGUt9zU96Z9A4jSCWFShL2-YhfMC_CCAs6i3lJxVASWNzjcYBONU5ViR09CNa3rVOchiGPgiXSb22yrKCHTAlimrLXHmYEiZS3HlvpxvNZbJ5VlHCZSd1ihpTwqlpta677nbZE5xoXMsCXVGda-lTchJtFGeVABPOCtYa7DL8_3WN8U3QtYBoTKjpWoenoDUzVuaaFi9C-bXwt4KlL4t3TGg_LeySOpUTq_PiwrCCceoUn9i1RrOWvLWl4cWVh2rMUBMu5aZUfv-M149s0xlUS0VzN0cmVGkrCjCRd0mkRm9Zx6qG-AZ-u2pUSz9D84MTQzOsedOV2IPoPYu-7j5mIiePM_BXvEJtS73yYvZCvLs83Ox0yZEoLVd0xfiJW7jFjaYilQUx2L4WFZIVeJCiVU8-xRNvdiRyz-lLKVayFGmlHpRz5N03oIclUhirKXNiI6QT4q3nxZHyPPMW3mJipT71qBJBMFlE4ziCePz2NvJdvFDlirPkYgf94BWF6Sy-htk8htmn29vz4NWqPqm-JvPZMl6Mp7MYdkRtcA8fF9MP48VX-DP6Cn0K4-Xk7Dx4NZ29i77AjqwIS3fQX_nz4OwmCMa3cbRoDD-d_RFNYljG43i6jKeTJbz-FgAA_O1_u58e3eb-adcbQXj-eFzfY70RfHs4rOx7D9_fj-01UospobY3gt5lOLwehMNBOIRwOArDURj2jozdG4UJ_zQqhQMMw-PYXu78e9bulUusdwz2an8PPIY5FX9weHk1vLzy__vn_L-WvPolJfsMf13VwffXNye4eXDcVJufyKkxa6PnoYGeanPPzyPDbAPv54to-vusMtKYncEieh8totkkWkKdwr5fnibwoZHAp-vau7rKn8rathW1byiqbKhpT7Ykc5ZPKts21bXr046GNMIOfbV5XHQXzy_6tnvR9-19ir58vB1PZ9Cff4zPIZp9PoNldOts_wfvF_MPsL8JBoPBIPDPsX3wbwAAAP___u3cGw==

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9v2zYQfq7-CsIvTYc4cJxuSx30wXVcwJtrF7FatCiKAyWd5FsokiEp58ew_30gpSQOEFnOw5aHICHvuzt9d_cd-332FY0lJUdsotJLo3i6Pv_A8AbTpCKRoWEOrWOb2iqK-n3GhVDXoA1qbhC4BaUdaMElW3PL3BpZhjmvhGMbLiocMZXnHpcq68CmXFq4JreGxgpSJcDSHXbAM-4zuRWtdrPV8pB9Ov8ejBvfJN1O36fbxs5waXnqSEnQhpQhd9sGlMqUXESrafws_KrigtwtqBwsmg2lyN6z1JCjlIszxh6j3js0WFSCm7Z8DPIMlBStCd2z9Ay2sgi58lVDExzZLidkMA2FqUrJTVM0lDwRmHVibd0geSUEOA-p8btwgUayzl4J9t6fPEsRr5zyIepEgEotKCUHFoVPN1cGKu3bpDWUfA6-TZX3kXCXrsE67rBE6doTf-JNWjQOcm4daO7We4HKSjjS_g-VUU4p9zlY3zSBtw6mGyd3VNzxAv5S1D6AddAb7WniMgMqpDIIUjnYkCXvpi62BZKQKt3VZpSFb37CnUXrNQIclagq1-Zh8IB_EUA6NBsudiqAVtYVBq0HCG4KrJvQtx8Ydd1ayePBIAQRKm3GVjsq6Q4z0Nw48p-HGZDM8CZ42020UOnlXh8lfXbKZGgwA8Ftq3XDup_l0OBgcK1K9B_VOZYhJS_RVguqBRgEldQabDh4e9pgAgmmERCDKbdd4_AUtCbrVGF4-SJUGIuwFRx_Wbzthg7Vwi6p0wU4U5RHlkoS3Cs-uLVBu1aildLB0UmAGszRgFDqstJh_mzQj_yyM6hRmhe-jiR15eoWIFl0SaTBYNnEqov4nv128qxahhraKwGW59j0TVdiD6K3V_v6fUyygMcahBWv0bjKJEHMXoj3y8PXzlQCQRuV8ITEji3c4sZwmakSLLaPRY2kEu-UbNWTL_EkmG2J3D68VDJRlcxq9eBCoOjegAGWKmmd4eTFRiovxJvQF1vKs-cW3mDqlNn1qJJRNLmYjuMpi8cf5tPA4pGuEkHpUcIOolcJ-7BcztliGbPFl_n8MHpl1DVlbLaIT8Pp19lq5pH3Fux8-nH8ZR6zStJVFcSJsoM3h9GryXKxii_Gs0XMEtCXeMs-X8w-jS--sz-n39lB7Xe8mnjb2eJ8-o0lkABlN-wgCefRm7MoGs_j6cWz2c4Wf0wnMVvF43i2imeTFXv9I2KMsb_Db__T45sivAR7I3Z8-HjcrL3eiP14OAwXSe_h_5_b9ga5wwy4641YbzgYDvvHw_5gyI5PRydvR8N3R7_-_vbdybC3hfEvG5LhQVVJjxtuXQaJDG9gd6t9dr1tqORlOAPwjx-AJ3d-e9y7HGxd-K1wf358PBiEm38OdzAy2IeRUKb_kJXB_8dKQ0n08_VZFE2_fZ6PZwt2sPwcH7Lp4usbtprOfUP9wj5eLD-x5Czq9_v9KGz-JPo3AAD__4sqa-8=
