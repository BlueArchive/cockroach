# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCRlWBoLoKIOd_543e-w-EQ3qM2TIoxTGV6qSVNV69eAq4xTSrGM9Rg0VioG6sgGA6Bci6_EqVRUY2EGiKVJYpTAStqwK4QMsxpxS3UlFc4BpnnDpdKY4lJqTDkK7Mr0lqRVHJi2BX2wDPqMtnwTrvZ8uIA3rz66I1b30zYnb5Pt42tpsLQ1DIpiNJMamY3XUAhdUl5F_pLRTmzGyJzYlDXLO1MQGNRcaq7HGmkGZGCd-Zx05wHsJVBkkt3Wai9I9PnhGlM_X1UpaC6vSsUNOGY9WJNw4u84pxYB2nwu3DLKHZAa75weOFOzgDuirmxpJWVLkSTCGGl4ixllhjkLt1calIpx47OUOIh-HarnI-E2nRFjKUWSxS2O_F73oRBbUlOjSWK2tWjQGXFLVPuD5mxnKXU5WAcWXzfejrdOrlixRUtyF-Sdc9dE3StXJuoyAgrhNRIhLSkZoY5N81lG8IESaXqoxnLfM33emfQOGkglpUoK9vlIbzFPwkgLOqa8p2Dr6SxhUbjAJzqAhsSOvoRLb923uQoDH0QLtN2XJVlJbvCjCiqLXPlYUaYyHDtve1uNJfp5aOKEi47qTPUmBFOTad123U3y57gRONKluiK6h1Ln5JTZqM4a3SXcFayzmDH4c-nLcY3QROqFN9s9VKhoNxuiJWkZtpWtB30Pl2589hIksaUmr4Buw9aMWNloWn5JJQfNL9eLH1avO0R8fffW6QqiNVFeWhYyTh1q4PYlUazkrzzksLDEw_VmKMmXMrLSvmJNl6R8sveoFoqWjhmMKEq25CKiaIHptEbtqF2ssJTwnzhxNAcWxr2ZXWroY-aBrfVmSjI3QX4h4JCbSudeG18It7tIndxuuJIlJYJTRjfscs73GgqMlkSg91T1iBZiVdSdMrTu3jqzbY08zF9qUQiK5E1YkQ5R96_UD0slcJYTZnTLiGdrteeFFtC9silXmNqpd71NBNBMF1EkziCePLyPPJdPFRVwll6uIa94BmF2Tw-hflFDPN35-cHwbOkPWm-phfzZbyYzOYxrIm6xA28XczeTBYf4Y_oI-xRmCyn-wfBs9n8VfQB1iQhLFvDXuLPg_2zIJicx9HiwfCz-e_RNIZlPIlny3g2XcLzTwEAwN_-t_sZ0LrwD8TBGMKDu-N2LQ7G8On2sLEf3H5_3rbXSC1mhNrBGAbH4eh0GI6G4QjC0TgMx2E42DJ2Tx4m_EurEg4wCrdje63zr2K7US6xwTbYL48b4DbMLYVbh8cno-MT_79_Dv5vyckPKdln-OOqDj4_P9vBzY3jZvUfbtZd3Nw8wM3qhpv37GqSO8vXF4to9uu8saz3YRG9jhbRfBot4Yafe_SO2A7niV33E3vzILF9vdGHt-eT2Rz2Lt7GBxDN3-_DMjp3tj_B68XFG1jDn79FiwgSeAEnZ8FwOBwG_mWz_qWdrQC-X19_v_72_fob3CqJHcPR8dFoDJ-OTmAIRyefg38DAAD__2iEwUY=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt9u27YXvq6e4sA3TX6wEzn5XQQOCsx11c1b6hS22rUoCoKWjmQuFMmSlGpnGFDsGXK5p8uTDKSUxEEjK8HQXAQ2_X3nH79zDgcDeI_aMClGMJHJhZY0Wb16CbjGZFkynqIGi8ZCVaOCYDAAyrn8SpRGRTUSaohUlihOBayoAbtCSDGjJbdQUV7iCGSWOV4ijSUmocKQr8yuSIMiieTEsEvsoKfURbLhrbjp4rwPb1599ODGNhN2p-2TbbDVVBiaWCYFUZpJzeymjSikLihvY38pKWd2Q2RGDOqKJa0BaMxLTnWbIY00JVLw1jhuivMAtzRIMukuC7U3ZLqMMI2Jv4-yEFQ3d4WCLjmmnVxT6yIrOSfWUWr-Lt4iih3Rmi8cXriTU4C7ZG6QtLTSuagDIaxQnCXMEoPchZtJTUrl1NHqSjxE3y6Vs7GkNlkRY6nFAoVtD_yeNWFQW5JRY4midvUoUlFyy5T7IFOWsYS6GIwTi69bR6UbI5csv6Q5-UOy9r6rna6VKxMVKWG5kBqJkJZUzDBnpr5sQ5ggiVRdMmOpz_le7QwaNxqIZQXK0rZZCG_5TyIIi7qifGfjK2lsrtE4Aqc6x1qETn5Ey6-tNzkMQ--Ey6RpV2VZwS4xJYpqy1x6mBImUlx7a7sLzWVy8aikhItO6hQ1poRT04puqu562QucaFzJAl1SnW3pQ3KT2SjO6rlLOCtYq7Oj8P8nDccXQROqFN9s1VKhoNxuiJWkYtqWtGn0rrlyZ7EeSRoTaroa7D5pxYyVuabFk1i-0fx6sfRp_rZbxN9_Z5IqJ1bnxYFhBePUrQ5iVxrNSvLWSwoPjj1VY4aacCkvSuU72viJlF10OtVS0dwpgwlV2lpUTOQdNI0e2LjaqQovCfOFE0MzbGTYFdXtDH1UN7itzkRO7i7APxQUalvqpZ-NT-S7XeQuTpccidJySZeM79jlLWY0FaksiMH2LquZrMBLKVrH07t44mFbM_MxdSnFUpYirYcR5Rx590L1tEQKYzVlbnYJ6eZ65UWxNcgeudQrTKzUu55mIggm82gcRxCPX55FvooHqlxylhysYS94RmE6i09gdh7D7N3ZWT94tmxO6m-T89kino-nsxjWRF3gBt7Op2_G84_wW_QR9iiMF5P9fvBsOnsVfYA1WRKWrmFv6c-D_dMgGJ_F0fxB99PZr9EkhkU8jqeLeDpZwPNPAQDAn_6_--vRKvcPxN4Iwv7dcbMWeyP4dHtY43u33z9v4zVSiymhtjeC3lE4PBmEw0E4hHA4CsNRGPa2wO7Jw4R_aZXCEYbhtm8_6_yr2G6UC6y3TfbL44a4TXNL4dbg0fHw6Nj_9lf_v6a8_CEp-wh_XNbB5-enO7S5cdosv9Nm1abNzQPaLG-0eQ9XkcwhX5_Po-nPsxpZ7cM8eh3No9kkWsCNPvfonbAdzwu76hb25kFh-3yjD2_PxtMZ7J2_jfsQzd7vwyI6c9j_wev5-RtY92EDv_8SzSNYwgs4Pg0Gg8EgYEKgHvi35F6ipTH7AVxf_XN99e366hv4p8_mu5P1T007ul_-dlW_vrpqALczyI7g8OhwOIJPh8cwgMPjz8EWLGPcojawZ3WJ-8G_AQAA__-WUeVP

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vs1u2zgQPldPQfhSZ2EHcrqHwEEPrqsuvJvaha0WLYqCGEsjmRuKZElKsbNYoA-R4z5dnmRBSkkcbGQlWDSHwCLnm99vZjgckk-oDZNiTKYyudASks3bNwS3mKxLxlPUxKKxpKqlgmA4JMC5vKRKowKNFAyVylLFQZANGGI3SFLMoOSWVMBLHBOZZQ6XSGOpSUAYesnshjZSNJGcGnaFHfAUnCc73io3Wy0G5P3bL1640c2EPaj7dF_YahAGEsukoEozqZndtQGF1AXwNvT3EjizOyozalBXLGl1QGNectBtijRCSqXgrX7cJucRbGmQZtIVC7VXZLqUMI2Jr0dZCNBNrVDAmmPaiTU1L7KSc2odpMYfwq2i2AGt-c7Ja3dyRsh9MLeSUFrpTNSOUFYozhJmqUHu3M2kpqVy7Gg1JR6D76fK6ViDTTbUWLBYoLDtjj_QJgxqSzMwliqwmyeBipJbptwPmbKMJeB8MI4sPm8dmW6UXLH8CnL6p2TtfVcb3SqXJhApZbmQGqmQllbMMKemLrahTNBEqi6asdTH_CB3Bo0bDdSyAmVp2zSEd_hnAYRFXQE_2PhKGptrNA7AQedYk9DRj2p52VrJURh6I1wmTbsqywp2hSlVoC1z4WFKmUhx67UdTjSXycWTghLOO6lT1JhSDqZVusm662VPcKpxIwt0QXW2pXfJTWajOKvnLuWsYK3GTsJfTxuMT4KmoBTf7eVSoQBud9RKWjFtS2gavWuu3GusR5LGBExXgz0EbZixMtdQPAvlG82vFwvPs7ffIr7-nUGqnFqdF8eGFYyDWx3UbjSajeStRQqPX3moxgw15VJelMp3tPETKbvoNKqlgtwxgwlV2ppUTOQdMI1esDF1kBWeEuY7pwYybGjY5dXdDH1SN7itzkRO7wvgHwoKtS312s_GZ-LdLnKF0yVHqrRcw5rxA7u8RY0GkcqCGmzvshrJCrySonU8fYynXmxvZj4lL6VYy1Kk9TACzpF3L1QPS6QwVgNzs0tIN9crT4q9QfbEpV5hYqU-9DQTQTBdRpM4IvHkzXnks3isyjVnyfGW9IMXQGbz-JTMFzGZfzw_HwQv1s1J_TVdzFfxcjKbx2RL1QXuyIfl7P1k-YX8EX0hfSCT1fRoELyYzd9Gn8mWrilLt6S_9ufB0VkQTM7jaPmo-dn892gak1U8iWereDZdkZdfA0II-cv_d389qHL_QOyNSTi4P27WYm9Mvt4d1vK9u-9v-_IawWJKwfbGpHcSjk6H4WgYjkg4GofhOAx7e8LuycOEf2mVwgFG4b5tP-v8q9julHOstw_2y-MWuA9zS-FO4cmr0ckrf_f34P-GvP4pIXsPf17UwbeXZwe4uXPcLP_DzaqNm7tHuFnecvOBXEUzJ_lusYxmv81ryeqILKN30TKaT6MVueVnH-6J7XCe2FU3sXePEtvHG33-cD6ZzUl_8SEekGj-6YisonMn-wt5t1y8J1syWREpcFD_spfyLBgOh8OACYF66F-T_URLY44CcnP9z831j5vrH8Q_frbkK5jXUuC3lit7Kf3VdXOVMW5RG9K3usSj4N8AAAD__xyg2bo=

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_543e-w34fPqA2TIoRTGRyqSVNVq9fAa4xWZaMp6jBorFQ1VZB0O8D5Vx-I0qjohoJNUQqSxSnAlbUgF0hpJjRkluoKC9xBDLLHC6RxhKTUGHIN2ZXpLEiieTEsCvsgKfUZbLhrXbTxcURvH39yRs3vpmwe32fbhtbTYWhiWVSEKWZ1Mxu2oBC6oLyNvTXknJmN0RmxKCuWNKagMa85FS3OdJIUyIFb83jtjk7sKVBkkl3Wai9I9PlhGlM_H2UhaC6uSsUdMkx7cSamhdZyTmxDlLj9-EWUeyA1nzl8NKdnAHcF3NrSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2tocQu-HarnI8ltcmKGEstFihse-IPvAmD2pKMGksUtatHgYqSW6bcHzJlGUuoy8E4svi-dXS6cXLF8iuak78ka5-7OuhauTZRkRKWC6mRCGlJxQxzburLNoQJkkjVRTOW-pof9M6gcdJALCtQlrbNQ3iHfxJAWNQV5XsHX0ljc43GATjVOdYkdPQjWn5rvclBGPogXCbNuCrLCnaFKVFUW-bKw5QwkeLae9vfaC6Ty0cVJVx2UqeoMSWcmlbrputulj3BicaVLNAV1TmWPiWnzEZxVusu4axgrcFOwp9PG4xvgiZUKb7Z6qVCQbndECtJxbQtaTPoXbpy77GWJI0JNV0D9hC0YsbKXNPiSSg_aH69WPq0eNsj4u-_s0iVE6vz4tiwgnHqVgexK41mJXnrJYXHQw_VmKEmXMrLUvmJNl6RssvOoFoqmjtmMKFKW5OKibxLdDV6yyZWTYuX8Mtwp_56VpivnBiaYcPErsTuZPRRA-EWOxM5ub8D_1ZQqG2pl14en4h368jdnS45EqXlki4Z37POW9xoKlJZEIPtg1YjWYFXUrQq1Pt44s22ZPMxfSnFUpYirfWIco68e6d6WCKFsZoyJ19COmmvPC-2tOyRe73CxEq973UmgmAyj8ZxBPH41Xnku3isyiVnyfEaDoJnFKaz-BRmFzHM3p-fHwXPls1J_TW5mC3i-Xg6i2FN1CVu4N18-nY8_wR_RJ_ggMJ4MTk8Cp5NZ6-jj7AmS8LSNRws_XlweBYE4_M4mu8MP539Hk1iWMTjeLqIp5MFPP8cAAD87X-7nx6tcv9G7I0gPLo_bjZjbwSf7w5r-97d95dte43UYkqo7Y2gdxIOTvvhoB8OIByMwnAUhr0tY_fqYcI_tkrhAINwO7aXO_8wthvlEuttg_3-uAVuw9xeuHN4MhycDP3__jn6vyUvf0jJPsMfV3Xw5fnZHm5uHDfL_3CzauPmZgc3y1tuPrCrSOYs31zMo-mvs9qyOoR59CaaR7NJtIBbfh7Qe2I7nCd21U3szU5i-3qjj-_Ox9MZHFy8i48gmn04hEV07mx_gjfzi7ewgT9_i-YRlPAShmdBv9_vB_5xswng5vr65vr7zfV3uFMQO4IXgxF8fjGEPrwYfgn-DQAA__8Ql71t

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_543e-w34fPqA2TIoRTGRyqSVNVq9fAa4xWZaMp6jBorFQ1VZB0O8D5Vx-I0qjohoJNUQqSxSnAlbUgF0hpJjRkluoKC9xBDLLHC6RxhKTUGHIN2ZXpLEiieTEsCvsgKfUZbLhrXbTxcURvH39yRs3vpmwe32fbhtbTYWhiWVSEKWZ1Mxu2oBC6oLyNvTXknJmN0RmxKCuWNKagMa85FS3OdJIUyIFb83jtjk7sKVBkkl3Wai9I9PlhGlM_H2UhaC6uSsUdMkx7cSamhdZyTmxDlLj9-EWUeyA1nzl8NKdnAHcF3NrSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2tocQu-HarnI8ltcmKGEstFihse-IPvAmD2pKMGksUtatHgYqSW6bcHzJlGUuoy8E4svi-dXS6cXLF8iuak78ka5-7OuhauTZRkRKWC6mRCGlJxQxzburLNoQJkkjVRTOW-pof9M6gcdJALCtQlrbNQ3iHfxJAWNQV5XsHX0ljc43GATjVOdYkdPQjWn5rvclBGPogXCbNuCrLCnaFKVFUW-bKw5QwkeLae9vfaC6Ty0cVJVx2UqeoMSWcmlbrputulj3BicaVLNAV1TmWPiWnzEZxVusu4axgrcFOwp9PG4xvgiZUKb7Z6qVCQbndECtJxbQtaTPoXbpy77GWJI0JNV0D9hC0YsbKXNPiSSg_aH69WPq0eNsj4u-_s0iVE6vz4tiwgnHqVgexK41mJXnrJYXHQw_VmKEmXMrLUvmJNl6RssvOoFoqmjtmMKFKW5OKibxLdDV6yyZWTYuX8Mtwp_56VpivnBiaYcPErsTuZPRRA-EWOxM5ub8D_1ZQqG2pl14en4h368jdnS45EqXlki4Z37POW9xoKlJZEIPtg1YjWYFXUrQq1Pt44s22ZPMxfSnFUpYirfWIco68e6d6WCKFsZoyJ19COmmvPC-2tOyRe73CxEq973UmgmAyj8ZxBPH41Xnku3isyiVnyfEaDoJnFKaz-BRmFzHM3p-fHwXPls1J_TW5mC3i-Xg6i2FN1CVu4N18-nY8_wR_RJ_ggMJ4MTk8Cp5NZ6-jj7AmS8LSNRws_XlweBYE4_M4mu8MP539Hk1iWMTjeLqIp5MFPP8cAAD87X-7nx6tcv9G7I0gPLo_bjZjbwSf7w5r-97d95dte43UYkqo7Y2gdxIOTvvhoB8OIByMwnAUhr0tY_fqYcI_tkrhAINwO7aXO_8wthvlEuttg_3-uAVuw9xeuHN4MhycDP3__jn6vyUvf0jJPsMfV3Xw5fnZHm5uHDfL_3CzauPmZgc3y1tuPrCrSOYs31zMo-mvs9qyOoR59CaaR7NJtIBbfh7Qe2I7nCd21U3szU5i-3qjj-_Ox9MZHFy8i48gmn04hEV07mx_gjfzi7ewgT9_i-YRlPAShmdBv9_vB_5xswng5vr65vr7zfV3uFMQO4IXgxF8fjGEPrwYfgn-DQAA__8Ql71t

statement ok
SET enable_zigzag_join = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_h-fnOd9jvwwfUhkkxgolMLrWkyer1K8A1JsuS8RQ1WDQWqtoqCPp9oJzLb0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cbsijRWJJGcGHaFHfCUukg2vNVuurg4grevP3njxjcTdq_v021jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-WlLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BZnB7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiN34dbRLEDWvOVw0t3cgZwn8ytJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsgm-XyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW1fFGi9XLL-iOflLMrGneM3Fa-VKRUVKWC6kRiKkJRUzzHmqG24IEySRqotqLPV5P6ifQePkgVhWoCxtm4fwDv8kgLCoK8r3Dr-SxuYajQNwqnOsiegoSLT81trNQRj6S7hMmpFVlhXsClOiqLbMpYcpYSLFtfe2v8NcJpePSkq46KROUWNKODWt1k3V3Tx7khONK1mgS6pzNH1ITp2N4qzWXsJZwVovOwl_Pm0wvgiaUKX4ZquWCgXldkOsJBXTtqTNsHdpy73HWpY0JtR0DdlD0IoZK3NNiyeh_LD5FWPp0-7bHhHf_84kVU6szotjwwrGqVsfxK40mpXkrU0Kj4ceqjFDTbiUl6XyQ228KmWXnZdqqWjumMGEKm1NKibyLhnR6C2bu2pavIRfhjtlxLPCfOXE0AwbJnYFdieljxoIt9yZyMl9D_x7QaG2pV56iXwi3q0k1ztdciRKyyVdMr5npbe40VSksiAG2wetRrICr6RoVaj38cSbbcnmY-pSiqUsRVrrEeUcefde9bBECmM1ZU6-hHTSXnlebGnZI3d7hYmVet8LTQTBZB6N4wji8avzyFfxWJVLzpLjNRwEzyhMZ_EpzC5imL0_Pz8Kni2bk_prcjFbxPPxdBbDmqhL3MC7-fTteP4J_og-wQGF8WJyeBQ8m85eRx9hTZaEpWs4WPrz4PAsCMbncTTfef109ns0iWERj-PpIp5OFvD8cwAA8Lf_7X56tMr9O7E3gvDo_rjZjL0RfL47rO17d99ftu01UospobY3gt5JODjth4N-OIBwMArDURj2tozdy4cJ_-AqhQMMwu27vdz5x7HdKBdYbxvs98ctcBvm9sKdw5Ph4GTo__fP0f9NeflDUvYR_risgy_Pz_Zwc-O4Wf6Hm1UbNzc7uFnecvOBXUUyZ_nmYh5Nf53VltUhzKM30TyaTaIF3PLzgN4T2-E8satuYm92EtvnG318dz6ezuDg4l18BNHswyEsonNn-xO8mV-8hQ38-Vs0j6CElzA8C_r9fj_wj5tNADfX1zfX32-uv8OdgtgRvBiM4POLIfThxfBL8G8AAAD__53_vc8=

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamUY0IfIE_ZJBlJK4mCRlWJoLoKIOd_h-fnOdzgcwjvUhkkxgZlMLrWkyeblC8AtJuuS8RQ1WDQWqsYqCIZDoJzLL0RpVFQjoYZIZYniVMCGGrAbhBQzWnILFeUlTkBmmcMl0lhiEioM-cLshrRWJJGcGHaFPfCUukhq3mk3X10cweuXH7xx65sJu9f36a6x1VQYmlgmBVGaSc1s3QUUUheUd6E_l5QzWxOZEYO6YklnABrzklPd5UgjTYkUvDOOm-I8gC0Nkky6ZqH2jkyfE6Yx8f0oC0F12ysUdM0x7cWahhdZyTmxDtLg9-FWUeyA1nzm8NydnAHcJXNjSUsr3RVNIIQVirOEWWKQu3AzqUmpHDs6rxIPwXdL5XysqU02xFhqsUBhuwO_500Y1JZk1FiiqN08ClSU3DLl_pApy1hCXQzGkcXXra9irZcrll_RnPwlmdhTvPbirXKloiIlLBdSIxHSkooZ5jw1DTeECZJI1Uc1lvq879XPoHHyQCwrUJa2y0N4i_8ugLCoK8r3Dr-SxuYajQNwqnNsiOgoSLT80tnNURj6S7hM2pFVlhXsClOiqLbMpYcpYSLFrfe2v8NcJpePSkq46KROUWNKODWd1m3V3Tx7khONG1mgS6p3NH1ITp2N4qzRXsJZwTovOwl_Pm0xvgiaUKV4vVNLhYJyWxMrScW0LWk77H3acuexkSWNCTV7h8xR_T5qw4yVuaaF6SX8faAfOL9mLO0b7PvI3THxHOhNVOXE6rw4NqxgnLoVQuxGo9lI3tmo8HjsoRoz1IRLeVkqP9jGK1N22Xuplormjh1MqNI2xGIi75MSjd6yvauhxnP4ZfxgZT0zzGdODM2wZWNfYLdy-qihcAueiZzc9cC_GRRqW-q1l8nvxLu15HqnS45Eabmma8b3rPUON5qKVBbEYPewNUhW4JUUnSr1Np55sx3pfExdSrGWpUgbTaKcI-_frR6WSGGspsxJmJBO3ivPix09e-R-rzCxUu97pYkgmC2jaRxBPH1xHvkqHqtyzVlyvIWD4AmF-SI-hcVFDIu35-dHwZN1e9J8zS4Wq3g5nS9i2BJ1iTW8Wc5fT5cf4I_oAxxQmK5mh0fBk_niZfQetmRNWLqFg7U_Dw7PgmB6HkfLB6-fL36PZjGs4mk8X8Xz2QqefgwAAP72v93PgFa5fysOJhAe3R2323EwgY-3h4394Pb70669RmoxJdQOJjA4CUenw3A0DEcQjiZhOAnDwY6xe_0w4R9dpXCAUbh7t1c8_0C2tXKBDXbBfofcAHdhbjfcOjwZj07G_n__HP3flNc_JGUf4Y_LOvj09GwPN2vHzfI_3Ky6uFk_wM3yhpv37CqSOctXF8to_uuisawOYRm9ipbRYhat4IafB_SO2A7niV31E7t-kNg-3-j9m_PpfAEHF2_iI4gW7w5hFZ0725_g1fLiNdTw52_RMoISnsP4LBgOh8PAP3DqAL5dX3-7_vrt-ivcKoidwLPRBD4-G8MQno0_Bf8GAAD__1aHvjE=

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iVI4_LAIHvXBddde7qVPYardFURC0NJK5oUiWpFQriwX6EHnCPsmClJI4aGSlWDQXQcTMGc7PmTMcDuEdasOkmMBMJpda0mTz8gXgFpN1yXiKGiwaC1VjFQTDIVDO5ReiNCqqkVBDpLJEcSpgQw3YDUKKGS25hYryEicgs8zhEmksMQkVhnxhdkNaK5JITgy7wh54Sl0kNe-0m68ujuD1yw_euPXNhN3r-3TX2GoqDE0sk4IozaRmtu4CCqkLyrvQn0vKma2JzIhBXbGkMwCNecmp7nKkkaZECt4Zx01xHsCWBkkmXbNQe0emzwnTmPh-lIWguu0VCrrmmPZiTcOLrOScWAdp8Ptwqyh2QGs-c3juTs4A7pK5saSlle6KJhDCCsVZwiwxyF24mdSkVI4dnVeJh-C7pXI-1tQmG2IstVigsN2B3_MmDGpLMmosUdRuHgUqSm6Zcn_IlGUsoS4G48ji69ZXsdbLFcuvaE7-kkzsKV578Va5UlGREpYLqZEIaUnFDHOemoYbwgRJpOqjGkt93vfqZ9A4eSCWFShL2-UhvMX_EEBY1BXle4dfSWNzjcYBONU5NkR0FCRafuns5igM_SVcJu3IKssKdoUpUVRb5tLDlDCR4tZ7299hLpPLRyUlXHRSp6gxJZyaTuu26m6ePcmJxo0s0CXVO5o-JKfORnHWaC_hrGCdl52E_z9tMb4ImlCleL1TS4WCclsTK0nFtC1pO-x92nLnsZEljQk1e4fMUf0-asOMlbmmhdlP-O-RfuL8nrHU9qC_C3Z3VDwPepNVObE6L44NKxinbo0Qu9FoNpJ3Nis8Hnuoxgw14VJelsoPt_HqlF32XqqlorljCBOqtA25mMj75ESjt2zvaujxHH4ZP1gfzw7zmRNDM2wZ2RfYraQ-ajDckmciJ3c98O8GhdqWeu2l8gfxbjW53umSI1Faruma8T2rvcONpiKVBTHYPXANkhV4JUWnUr2NZ95sRz4fU5dSrGUp0kaXKOfI-_erhyVSGKspczImpJP4yvNiR9MeueMrTKzU-15qIghmy2gaRxBPX5xHvorHqlxzlhxv4SB4QmG-iE9hcRHD4u35-VHwZN2eNF-zi8UqXk7nixi2RF1iDW-W89fT5Qf4I_oABxSmq9nhUfBkvngZvYctWROWbuFg7c-Dw7MgmJ7H0fLB6-eL36NZDKt4Gs9X8Xy2gqcfAwCAv_1v9zOgVe7fi4MJhEd3x-2GHEzg4-1hYz-4_f60a6-RWkwJtYMJDE7C0ekwHA3DEYSjSRhOwnCwY-xeQEz4h1cpHGAU7t7tVc8_km2tXGCDXbDfIzfAXZjbD7cOT8ajk7H_3z9H_zXl9U9J2Uf487IOPj0928PN2nGz_I6bVRc36we4Wd5w855dRTJn-epiGc1_XTSW1SEso1fRMlrMohXc8POA3hHb4Tyxq35i1w8S2-cbvX9zPp0v4ODiTXwE0eLdIayic2f7P3i1vHgNNfz5W7SMoITnMD4LhsPhMPCPnDqAb9fX366_frv-CrcKYifwbDSBj8_GMIRn40_BvwEAAP__UXG-kw==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1PI0kMvedX1HF3NUEBZgZ20BzYTK-EBGEWApo9WU63u-Oluqriqgofv35V1ZkhSHQabhH4Pbvs5-cej9UtiWdrvqipLe_EYrn89peiByoXkXVFogL5oNZd1Gg0HivU2t6DE3IoBOjBugBOo1FL9CosSVVUY9RBrVFH-qJsXSdcaX0AX6LxcM9hCZsoKK0Gz080AK8wVfKoe-POri8_qItv_-bgDTebsJP7eDs4CBqPZWBrwAlb4fDYBzRWWtR96FVEzeERbA2eZM1lbwFCTdQofURCWIE1ureOn815BRs9QW3TsEgykR8iYaEyzyO2BmUzKzK40FQNYn2nizpqDSFBOvwu3HUxT8DgV1p9TX85Uer5MT8jMQabUnSFALdOc8kBPOlUbm0Fokvq6E1lXoNvtypxLDCUS_ABA7VkQn_hL9iMJwlQow_gMCzfBGqjDuzSD1txzSWmGnwSS-7bQKc3JE_cPGED_1nu37su6YNLbUJTATfGCoGxAdbsOdF0w_bABkrrhmTGVX7zi9558skaIHBLNoY-hskv_LsAJpCsUe9cfGd9aIR8AmiUhjoRJvmB2PveSe5PJjmJtuVmXV3glp-oAocSOD2PKmBT0UNm291obcu7Nz3KpOqsVCRUgUbfG73petrlLHAQWtqW0qMG1zKXlJzZO82d74LmlnuTHUw-Hm8wuQkC6Jx-3OqlI4M6PEKwsGYJETeLPuQrz4ydJQmV6IcW7CVoyT7YRrB9FyovWj4vAd-Xb3tF8vwHH-kaCNK0e55b1phOB4SlkF9a3Tukyd5hhgrVJKCtvYsub7TPjlTfDSYV67BJymDjYuhExaYZMl2hHLnJ1cniq_p8-Kr_ZlX4lQaPNW2UOFTYLxt900Kkw86mgecZ5G8FRxKiLLI9vhOfzlGanURN4MQucMF6xznvoRE0lW3BU_-idUhu6cmaXoe6mU9z2JZtvqUv0SxsNFXnR6g16eGbmmGlNT4IcrIvY5O1r7MutrzsjXd9TWWwsuvrzIxG06vidF6o6-Kfm2I2LZSLC83lnqeVujib3Z6e3xRqX12c_uh-_nlwcHh4dDA5_Hz86ePR0afjyZE6m02viotiNlf76np-ejVX-yejUfHj-_np2Uz9dvl9_kEVs9vf1XVxXkzn6g_199XlhfK0OhmNx-PxyNMqkilp3H0WpP-M_g8AAP__T7Lm5A==

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCbxgd2IscHB4GDAsd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnDjbyEqwaC4Cm55v_vjNN-z34R0qzaQYwUTGl0rSePXyBeAa46hgPEEFBrWBsrLyvH4fKOfyK8kV5lQhoZrI3JCcUwErqsGsEBJMacENlJQXOAKZphYXS22IjqnQ5CszK1JbkVhyotkVtsATajPZ8Ea76eKiB69ffnTGtW8mzF7fp7vGRlGhaWyYFCRXTCpmNk1AIVVGeRP6S0E5MxsiU6JRlSxuTEDhsuBUNTlSSBMiBW_MY9ucB7CFRpJKe1monCPd5oQpjN19FJmgqr4rFDTimLRidcWLtOCcGAup8PtwiyC0QKO_cHhuT84A7orZWtLCSBuiSoSwLOcsZoZo5DbdVCpS5JYdjaHEQ_DdVlkfETXximhDDWYoTHPi97wJjcqQlGpDcmpWjwJlBTcstx9kwlIWU5uDtmRxfWvpdO3kii2v6JL8Jlnz3FVB17ltExUJYUshFRIhDSmZZtZNddmaMEFimbfRjCWu5nu906itNBDDMpSFafLg3-KfBBAGVUn53sHPpTZLhdoCOFVLrEho6UeU_Np4kwPfd0G4jOtxzQ3L2BUmJKfKMFseJoSJBNfO2_5GcxlfPqooYbOTKkGFCeFUN1rXXbez7AhOFK5khrao1rF0KVll1jlnle4SzjLWGOzE_-9pjXFNUITmOd_s9DJHQbnZECNJyZQpaD3obbpy57GSJIUx1W0Ddh-0YtrIpaLZk1Bu0Nx6MfRp8XZHxN1_a5H5khi1zI40yxindnUQs1KoV5I3XpJ_NHRQhSkqwqW8LHI30dopUnrZGlTJnC4tM5jIC1ORiollm-gqdJZ1rIoWz-F_wwf117FCf-FE0xRrJrYldiujjxoIu9iZWJK7O3BvhRyVKVTk5PGJeLuO7N2pgiPJlYxoxPiedd7gRlGRyIxobB60CskyvJKiUaHehhNntiObj-lLISJZiKTSI8o58vad6mCxFNooyqx8CWmlvXS82NGyR-71EmMj1b7XmfC8yTwYhwGE4xfngeviUV5EnMVHazj0DihMZ-EpzC5CmL09P-95B1F9Un2bXMwW4Xw8nYWwJvklbuDNfPp6PP8IvwYf4ZDCeDHp9ryD6exl8AHWJCIsWcNh5M697pnnjc_DYP5g-Onsl2ASwiIch9NFOJ0s4NknDwDgd_ff_nVouXRvxM4I_N7dcb0ZOyP4dHtY2Xduv3_etVdIDSaEms4IOif-4LTvD_r-APzByPdHvt_ZMbavHibcY6sQFjDwd2M7uXMPY7PJbWKdXbDbH1vgLszuhVuHJ8PBydD99kfv35Yc_ZCSXYY_rmrv87OzPdzcWG4W33GzbOLm5gFuFltu3rMrSWotX13Mg-lPs8qy7MI8eBXMg9kkWMCWn4f0jtgW54hdthN78yCxd-t9Nw3eb8OUbgrt3PW8g8LW6HVhvIBFcG590B5EPSh6UMKr-cXr-xPU-0fc9z8H8wAieA7DM88LPrw5H09ncHjxJuxBMHvX3Tr9T-WrPPP6_X7fY0Kg6rvH6mGspNZdD26u_7q5_nZz_Q3c22rz3cn6__Ww21_-tHd6c31dG9wqnBnB8cnxYASfjofQh-PhZ2_HLGXcoNJwaFSBXe_vAAAA__-hjv7f

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVlFv20YMfq5-xb21HeogW4ehaNAH1_UAb44T2GqxYBgIWqLkW053Fx7lxPn1w53cxhkiK3kzDH4feeTHjxqN1DfioJ39qCauuGaHxebLZ0V3VKxbbUpiJRREbbuoLBuNFBrjbsEzeWQCDOC8gDdo1QaDkg2pkipsjagtmpY-KldVEVe4IBAKtAFutWxgHwWFMxD0PQ3AS4yV7Exv3Gx18U6df7lKwXtubeUo94fDYGG0AQvRzoJn7VjLrg9oHTdo-tA3LRotO3AVBOKtLnoLYKpbg9xHxIQlOGt66_jenCewbSCoXBwWcSIKQySaqUjzaBuLvJ8VWVwbKgexodNF1RoDEiEd_hhuNc0jUMKNUZ_iP2dKPTzmeyS24mKKrhDQjTe60AKBTCy3cgytj-roTWWfgh-2KnKsUYoNBEGhhqz0F_6IzQZigQqDgEfZPAvUtEa0jz9cqStdYKwhRLGkvg10ek9yr-t7rOFfp_v3rkt652Ob0Jaga-uYwDqBrQ460nTDDqAtFM4PyUyX6c2PehcoRGsA0Q25VvoYTn_gXwSwQrxFc3TxvQtSM4UIMMg1dSKM8gN2t72T_Pn0NCUxrtivqxfd6HsqwSOLjs-jErQt6S6xHW-0ccX1sx5lY3WOS2IqwWDojd53Pe5yEjgwbVxD8VGDa5lKis4cvNGd74LRje5N9svprx_2mNQEBvTe7A566cmikR2Ig61maXG_6EO-8sDYWRJTgWFowR6DNjqIqxmbF6HSoqXzIviyfIcrkuY_-Ehfg3DdnATdaIPxdIBsmMLGmd4hnZ68T1CmihiMc9etTxsdkiNV14NJ2XmsozK09a10otK2HjJdphS5z9XJ4pP67f2T_ptUEW4MBKxor8Shwn7Y6LMWIh52bWt4mEH6VvDE0vI62eML8fEcxdlxawg8uzWutTlyzntoGG3pGgjUv2gdUjd072yvQ33NJynswDaf05fWrl1ry86P0Bgywzc1wQpngzDqaF_WRWvfJl0ceNkz7_qWCnF87OvMZtlkOR3nU5WPP8-nqYsn4UTUm-wVqtki_6AWF7lafJ3P32WvJheLVb4czxa5EvDXtFOXy9n5eHml_pxeqTeoxqvJ2-ztWZaN5_l0-X_O2eKP6SRXq3ycz1b5bLJSr__-5_VZlk3_upyPZwv15uIyf6emi29v1Wo6j7E_qd-XF-cqnMhZNhqNRllycsn-CwAA___rme1o

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1OHEkMvs9T1BEkJoLNahUl4pBNOETKJpEgaPdkebrdPV6qy4XLPfyc8hA8IU8SVXUnDBI9DbfRyJ_t-vz5cy-X7pw0sYS37oNUFypYrT_-7eiaqlXPviZ1RsncZohaLJZLh97LFUSliEqACSQaRI_BrTE5W5OrqcHem9ug7-mtk6bJuEqSQaowJLhiW8MYBZV4SHxLM_Aacyc3fjLu0-nXA_fPx_9K8Jibg-3M_WY72BRDwspYAkRlUbabKWAQ7dAvTk_OnoRf9ujZbkAaSKQbrsgduxVWF61KH-p3zj3U_ZVSqe096lRHSliDBD_Z0i-ensD2iaCRPDfSkijNJWGlqoym7wLqODYKuPJUz2LTIJGm9x4sQwb8LlwhkpOlS--O8z9PUoS9SS4xNALcRc8VGyTyud1GFPqYhTJZKjwF36Yq51ihVWtIhkYdBZtu_FG2kEgNGkwGEW39LFDXe-OYf0jNDVeYe0hZNoW3GabHJLfc3mIL_wtPr-BQ9DpmmjDUwG0QJQhisOHEOc0w7AQcoJI4JzOuy5sfcZcoZZcA446kt6kMh7_xLwIEI92g3-kBUZK1SikDPGpLgwiz_EDlanKSR4eHpYiXalzcaNzxLdUQUY3z86gGDjVdl2y7ifZSXTzrUSF3J1qTUg0e02T0yHre5SJwUFpLR_lRs2tZWsomnaLnwYLBc8eTxf44_PPNiCkkKGCM_maLy0gBvd2ACWxYrcdx0ed85SHjYElKFaa5BXsMWnMyaRW7F6HKopVLY_iyetsrUuY_-8jYgmnbvUrcscd8RcDWSmktfnJIh69eF6hSQwpe5KKPZaNTcaTmYraoSsQ2K4ND7G0QFYd2znSVSuRYa5DFsfvr9ZP-W1SRLj0kbGhU4lxjv230WQuRbzyHFh5mUD4bIqn1uir2-EJ8Pkd5dtp7gqiywhX7HZd9Io1iqKWDRNOLNiC5o1sJkw71_exDCduyzefw0odV_nAY_Ai9Jz9_UwuskpBMkbN9BcnWvim62PKyZ971DVUmuutDLSwWJ_9--_z-0xe39_Xb2YE7-XK-787ff_5-cur2jvbfLZbL5XJRwtPC3d_d3d_9uL_74faODvYXPwMAAP__tAvS4Q==

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs1OHEkMvs9T1BEkJoLNahUl4pBNOETKJpEgaPdkebrdPV6qy4XLPfyc8hA8IU8SVXUnDBI9DbfRyJ_t-vz5cy-X7pw0sYS37oNUFypYrT_-7eiaqlXPviZ1RsncZohaLJZLh97LFUSliEqACSQaRI_BrTE5W5OrqcHem9ug7-mtk6bJuEqSQaowJLhiW8MYBZV4SHxLM_Aacyc3fjLu0-nXA_fPx_9K8Jibg-3M_WY72BRDwspYAkRlUbabKWAQ7dAvTk_OnoRf9ujZbkAaSKQbrsgdu0rZuEL_zrmHqr8SKrW9R53qRwlrkOAnG_rF0hPYPhE0kqdGWhKluSSsVJXB9F1AHYdGAVee6llsGgTS9N6DZciA34UrNHKydOndcf7nSYqwN8klhkaAu-i5YoNEPrfbiEIfs0wmS4Wn4NtU5RwrtGoNydCoo2DTjT_KFhKpQYPJIKKtnwXqem8c8w-pueEKcw8pi6bwNsP0mOSW21ts4X_h6QUcil7HTBOGGrgNogRBDDacOKcZhp2AA1QS52TGdXnzI-4SpewRYNyR9DaV4fA3_kWAYKQb9DsdIEqyVillgEdtaRBhlh-oXE1O8ujwsBTxUo1rG407vqUaIqpxfh7VwKGm65JtN9FeqotnPSrk7kRrUqrBY5qMHlnPu1wEDkpr6Sg_anYtS0vZolP0PBgweO54stgfh3--GTGFBAWM0d9scRkpoLcbMIENq_U4LvqcrzxkHCxJqcI0t2CPQWtOJq1i9yJUWbRyZwxfVm97Rcr8Zx8ZWzBtu1eJO_aYbwjYWimtxU8O6fDV6wJVakjBi1z0sWx0Ko7UXMwWVYnYZmVwiL0NouLQzpmuUokcaw2yOHZ_vX7Sf4sq0qWHhA2NSpxr7LeNPmsh8oXn0MLDDMpHQyS1XlfFHl-Iz-coz057TxBVVrhiv-OuT6RRDLV0kGh60QYkd3QrYdKhvp99KGFbtvkcXvqwkj7Ugx-h9-Tnb2qBVRKSKXK2ryDZ2jdFF1te9sy7vqHKRHd9poXF4uTfb5_ff_ri9r5-OztwJ1_O9935-8_fT07d3tH-u8VyuVwuSnhauPu7u_u7H_d3P9ze0cH-4mcAAAD__xTC0gw=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZLlj2J7se--IOUkDmpZCRbNRRAxc-aPZ86w3yefURsmxZCMZbbSErLlu7cE15gtHOM5amLRWFI3VlHU7xPgXN5RpVGBRgqGSmWp4iDIEgyxSyQ5FuC4JTVwh0Mii8LjMmksNRkIQ--YXdKdFc0kp4ZtsQOeg89kw1vtJvPbM_Lh3ddgvPPNhD3q-2rf2GoQBjLLpKBKM6mZ3bQBhdQV8GiepAfhPxxwZjdUFtSgrlmG5A3JNLMsA35NyGPUe4caS8dBt-WjEXIqBW9N6L5LB7DOIC2kvzXUwZHpcsI0ZuFiXCVA7y4NBSw45p1Y0xCkcJxT6yEN_hgutJEZa35w8safHGwROCt9iCYRyirFWcYsNch9uoXU1ClPk9ZQ4hB8v1XexwJstqTGgsUKhW1P_Ik3YVBbWoCxVIFdPgtUOW6Z8n_InBUsA5-D8aQJfevo9M7JlpVbKOlfkrUPYBN0rXybQOSUlUJqpEJaWjPDvJvmsg1lgmZSddGM5aHmJ70zaLxGUMsqlM62eYgf8C8CCIu6Bn5UAZQ0ttRoPICDLrEhoacf1fKu9SYHcRyCcJntxlZZVrEt5lSBtsyXhzllIsd18Ha80Vxmq2cVJXx2UueoMaccTKv1rut-lgPBqcalrNAX1TmWISUv0UZx1ggw5axircEu4v9f7TChCZqCUnyz10uFArjdUCtpzbR1sBv0Ll159NhIksYMTNeAPQUtmbGy1FC9CBUGLewZCy-Ltz8i4f47i1Qltbqszg2rGAe_Q6hdajRLyVsvKT6_DFCNBWrKpVw5FSbaBEUqVp1BtVRQemYwoZxtSMVE2SW6GoPlLlZDizfkt8uD-htYYX5waqDAHRO7EnuQ0WcNhN_wTJT08Q7Co0Ghtk4vgjy-EO_Xkb877ThSpeUCFowf2estbjSIXFbUYPugNUhW4VaKVoX6lI6D2Z5sPqcvTiykE3mjR8A58u6dGmCZFMZqYF6-hPTSXgde7GnZM_d6jZmV-tgzTUTReJaM0oSko7c3SejiuXILzrLzNTmJXgGZTNMrMr1NyfTTzc1Z9GqxO2m-xrfTeTobTaYpWVO1wg35OJt8GM2-kj-Tr-QEyGg-Pj2LXk2m75IvZE0XlOVrcrII59HpdRSNbtJkdjD8ZPpHMk7JPB2lk3k6Gc_J628RIYT8HX77nx7UZXgs9oYkPns83m3G3pB8ezhs7HsP39_37TWCxZyC7Q1J7yIeXPXjQT8ekHgwjONhHPf2jP2rh4nw2HLCAwbxfuwgd-GFbDfKJ9bbB4f9cQ_ch_m98ODw4nJwcRn-98_Zfy158UtKDhn-uqqj76-vj3Bz47npfuJm3cbNzQFuuntuPrGraeEt39_Oksnv08ayPiWz5H0yS6bjZE7u-XkCj8T2uEDsupvYm4PEPl7v1terVj8VrLFoK3l7oGS1OlBzsXparcbiUL2bE3e8rm17XcmXjzejyZSc3H5Mz0gy_XxK5smNt_0feT-7_UC211G_3-9H4aG2jf4NAAD__6bG680=

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZIlKcXyYt99QUpJHNSyEiyaiyBi5swfz5zhcEg-ozZMijGZymSjJSTrd28JbjFZlYynqIlFY0nVWAXBcEiAc3lHlUYFGikYKpWlioMgazDErpGkmEHJLamAlzgmMsscLpHGUpOAMPSO2TVtrWgiOTVshz3wFFwmNe-0my1vz8iHd1-9ceubCXvU99W-sdUgDCSWSUGVZlIzW3cBhdQF8GAZxQfhP0rgzNZUZtSgrliC5A1JNLMsAX5NyGPUe4ca85KD7spHI6RUCt6Z0H2XDmBLgzST7tZQe0emzwnTmPiLKQsBur00FLDimPZiTUOQrOScWgdp8Mdwvo3MWPODkzfu5GCLoLTShWgSoaxQnCXMUoPcpZtJTUvlaNIZShyC77fK-ViBTdbUWLBYoLDdiT_xJgxqSzMwliqw62eBipJbptwfMmUZS8DlYBxpfN96Ot062bF8Bzn9S7LuAWyCbpVrE4iUslxIjVRISytmmHPTXLahTNBEqj6asdTX_KR3Bo3TCGpZgbK0XR7CB_yLAMKiroAfVQAljc01GgfgoHNsSOjoR7W867zJURj6IFwm7dgqywq2w5Qq0Ja58jClTKS49d6ON5rLZPOsooTLTuoUNaaUg-m0brvuZtkTnGpcywJdUb1j6VNyEm0UZ40AU84K1hnsIvz_VYvxTdAUlOL1Xi8VCuC2plbSimlbQjvofbry6LGRJI0JmL4BewpaM2NlrqF4EcoPmt8zFl4Wb39E_P33FqlyanVenBtWMA5uh1C71mjWkndeUnh-6aEaM9SUS7kplZ9o4xUp2_QG1VJB7pjBhCptQyom8j7R1egt21gNLd6Q3y4P6q9nhfnBqYEMWyb2JfYgo88aCLfhmcjp4x34R4NCbUu98vL4QrxbR-7udMmRKi1XsGL8yF7vcKNBpLKgBrsHrUGyAndSdCrUp3jqzfZk8zl9KcVKliJt9Ag4R96_Uz0skcJYDczJl5BO2ivPiz0te-ZerzCxUh97pokgmC6iSRyRePL2JvJdPFflirPkfEtOgldAZvP4isxvYzL_dHNzFrxatSfN1_R2vowXk9k8JluqNliTj4vZh8niK_kz-kpOgEyW09Oz4NVs_i76QrZ0RVm6JScrfx6cXgfB5CaOFgfDz-Z_RNOYLONJPFvGs-mSvP4WEELI3_63-xlAlfvH4mBMwrPH43YzDsbk28NhYz94-P6-b68RLKYU7GBMBhfh6GoYjobhiISjcRiOw3CwZ-xePUz4x1YpHGAU7sf2cudfyLZWLrHBPtjvj3vgPszthQeHF5eji0v_v3_O_mvJq19Sss_w11UdfH99fYSbteNm-RM3qy5u1ge4Wd5z84ldRTNn-f52Ec1-nzeW1SlZRO-jRTSfRktyz88TeCS2w3liV_3Erg8S-3i9O1ev2vxUsMasq-TdgZLV5kDN2eZptRqzQ_XWJ-XxunbddUVfPt5MZnNycvsxPiPR_PMpWUY3zvZ_5P3i9gOpr4PhcDgM_EOtDv4NAAD__6a168s=

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6egvBNkw9xICcfFoGDXriuuvBu6hS2WrQoCmIsjWSuKZLlj2J7se--IOUkDmpZCRbNRRAxc-aPZ86w3yefURsmxZCMZbbSErLlu7cE15gtHOM5amLRWFI3VlHU7xPgXN5RpVGBRgqGSmWp4iDIEgyxSyQ5FuC4JTVwh0Mii8LjMmksNRkIQ--YXdKdFc0kp4ZtsQOeg89kw1vtJvPbM_Lh3ddgvPPNhD3q-2rf2GoQBjLLpKBKM6mZ3bQBhdQV8GiepAfhPxxwZjdUFtSgrlmG5A3JNLMsA35NyGPUe4caS8dBt-WjEXIqBW9N6L5LB7DOIC2kvzXUwZHpcsI0ZuFiXCVA7y4NBSw45p1Y0xCkcJxT6yEN_hgutJEZa35w8safHGwROCt9iCYRyirFWcYsNch9uoXU1ClPk9ZQ4hB8v1XexwJstqTGgsUKhW1P_Ik3YVBbWoCxVIFdPgtUOW6Z8n_InBUsA5-D8aQJfevo9M7JlpVbKOlfkrUPYBN0rXybQOSUlUJqpEJaWjPDvJvmsg1lgmZSddGM5aHmJ70zaLxGUMsqlM62eYgf8C8CCIu6Bn5UAZQ0ttRoPICDLrEhoacf1fKu9SYHcRyCcJntxlZZVrEt5lSBtsyXhzllIsd18Ha80Vxmq2cVJXx2UueoMaccTKv1rut-lgPBqcalrNAX1TmWISUv0UZx1ggw5axircEu4v9f7TChCZqCUnyz10uFArjdUCtpzbR1sBv0Ll159NhIksYMTNeAPQUtmbGy1FC9CBUGLewZCy-Ltz8i4f47i1Qltbqszg2rGAe_Q6hdajRLyVsvKT6_DFCNBWrKpVw5FSbaBEUqVp1BtVRQemYwoZxtSMVE2SW6GoPlLlZDizfkt8uD-htYYX5waqDAHRO7EnuQ0WcNhN_wTJT08Q7Co0Ghtk4vgjy-EO_Xkb877ThSpeUCFowf2estbjSIXFbUYPugNUhW4VaKVoX6lI6D2Z5sPqcvTiykE3mjR8A58u6dGmCZFMZqYF6-hPTSXgde7GnZM_d6jZmV-tgzTUTReJaM0oSko7c3SejiuXILzrLzNTmJXgGZTNMrMr1NyfTTzc1Z9GqxO2m-xrfTeTobTaYpWVO1wg35OJt8GM2-kj-Tr-QEyGg-Pj2LXk2m75IvZE0XlOVrcrII59HpdRSNbtJkdjD8ZPpHMk7JPB2lk3k6Gc_J628RIYT8HX77nx7UZXgs9oYkPns83m3G3pB8ezhs7HsP39_37TWCxZyC7Q1J7yIeXPXjQT8ekHgwjONhHPf2jP2rh4nw2HLCAwbxfuwgd-GFbDfKJ9bbB4f9cQ_ch_m98ODw4nJwcRn-98_Zfy158UtKDhn-uqqj76-vj3Bz47npfuJm3cbNzQFuuntuPrGraeEt39_Oksnv08ayPiWz5H0yS6bjZE7u-XkCj8T2uEDsupvYm4PEPl7v1terVj8VrLFoK3l7oGS1OlBzsXparcbiUL2bE3e8rm17XcmXjzejyZSc3H5Mz0gy_XxK5smNt_0feT-7_UDW11G_3-9H4aG2jv4NAAD__6ak68k=

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl1v2zoSfa5-BeGXOos4kJPFInDQB9dVF95NncJWixZFQYylkcxrimRJSrV8cf_7BSklcVDLSnDRPAQRM2e-eOYMRyPyGbVhUkzITCZbLSHZvHtLcIfJumQ8RU0sGkuqxioIRiMCnMufVGlUoJGCoVJZqjgIsgFD7AZJihmU3JIKeIkTIrPM4RJpLDUJCEN_MruhrRVNJKeG7bEHnoLLpOaddvPV3Tn58O6rN259M2FP-r4-NLYahIHEMimo0kxqZusuoJC6AB6sovgo_EcJnNmayowa1BVLkLwhiWaWJcBvCHmMeu9QY15y0F35aISUSsE7E7rv0hFsaZBm0t0aau_I9DlhGhN_MWUhQLeXhgLWHNNerGkIkpWcU-sgDf4UzreRGWt-cPLGnRxtEZRWuhBNIpQVirOEWWqQu3QzqWmpHE06Q4lj8MNWOR9rsMmGGgsWCxS2O_En3oRBbWkGxlIFdvMsUFFyy5T7Q6YsYwm4HIwjje9bT6dbJ3uW7yGnf0jWPYBN0J1ybQKRUpYLqZEKaWnFDHNumss2lAmaSNVHM5b6mp_0zqBxGkEtK1CWtstD-IB_EUBY1BXwkwqgpLG5RuMAHHSODQkd_aiWPztvchyGPgiXSTu2yrKC7TGlCrRlrjxMKRMp7ry3043mMtk-qyjhspM6RY0p5WA6rduuu1n2BKcaN7JAV1TvWPqUnEQbxVkjwJSzgnUGuwz_fd1ifBM0BaV4fdBLhQK4ramVtGLaltAOep-uPHpsJEljAqZvwJ6CNsxYmWsoXoTyg-b3jIWXxTscEX__vUWqnFqdFxeGFYyD2yHUbjSajeSdlxReXHmoxgw15VJuS-Un2nhFyra9QbVUkDtmMKFK25CKibxPdDV6yzZWQ4s35D9XR_XXs8L84NRAhi0T-xJ7kNFnDYTb8Ezk9PEO_KNBobalXnt5fCHerSN3d7rkSJWWa1gzfmKvd7jRIFJZUIPdg9YgWYF7KToV6lM882YHsvmcvpRiLUuRNnoEnCPv36kelkhhrAbm5EtIJ-2V58WBlj1zr1eYWKlPPdNEEMyW0TSOSDx9exv5Ll6ocs1ZcrEjw-AVkPkiviaLu5gsPt3engev1u1J8zW7W6zi5XS-iMmOqi3W5ONy_mG6_Er-H30lQyDT1ezsPHg1X7yLvpAdXVOW7shw7c-Ds5sgmN7G0fJo-Pnif9EsJqt4Gs9X8Xy2Iq-_BYQQ8qf_7X4GUOX-sTiYkPD88bjdjIMJ-fZw2NgPHr6_H9prBIspBTuYkMFlOL4eheNROCbheBKGkzAcHBi7Vw8T_rFVCgcYh4exvdz5F7KtlUtscAj2--MeeAhze-HB4eXV-PLK_--v839a8vq3lOwz_H1VB99f35zg5t5xU21_IafGrIue-yP0VNt7fh4YZlvy_m4Zzf-7aIw0ZmdkGb2PltFiFq1Im0I9LE8TeH-UwKfrql1d5S9lVV1F1UeKKo_UVNOKZs7ySWXVsbp2Q-hpyFHYfqi2j4Pu4vlBr_oHve7uU_Tl4-10viDDu4_xOYkWn8_IKrp1tv8i75d3H0h9E4xGo1HgH3h18HcAAAD__1Ac-48=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8VlFv2zYQfq5-BeGXpkMcOE63pQ764Dou4M21i1gtWhTFgZJO8i0UyZCUE2fYfx9IKYkDRFbysOUhSKj77o7f3X3Hfp99RWNJyRGbqPTSKJ6uzz8wvME0qUhkaJhD69imtoqifp9xIdQ1aIOaGwRuQWkHWnDJ1twyt0aWYc4r4diGiwpHTOW5x6XKOrAplxauya2hsYJUCbB0ix3wjPtMtqLVbrZaHrJP59-DceObpNvr-3TX2BkuLU8dKQnakDLktm1AqUzJRbSaxk_CryouyG1B5WDRbChF9p6lhhylXJwx9hD1zqHBohLctOVjkGegpGhN6I6lJ7CVRciVrxqa4Mh2OSGDaShMVUpumqKh5InArBNr6wbJKyHAeUiN34cLNJJ19kqw9_7kSYp45ZQPUScCVGpBKTmwKHy6uTJQad8mraHkU_BdqryPhLt0DdZxhyVK1574I2_SonGQc-tAc7d-FqishCPt_1AZ5ZRyn4P1TRN462C6cXJLxS0v4C9F7QNYB73RniYuM6BCKoMglYMNWfJu6mJbIAmp0l1tRlm48yPuLFqvEeCoRFW5Ng-De_yLANKh2XCxVwG0sq4waD1AcFNg3YS-_cCo69ZKHg8GIYhQaTO22lFJt5iB5saRvx5mQDLDm-BtP9FCpZfPupT02SmTocEMBLet1g3rfpZDg4PBtSrRX6pzLENKXqKtFlQLMAgqqTXYcPD2tMEEEgxwrcV2h0uNkgu3BadgQ8ZVvBn0Ll158FhLksGU264Bewxak3WqMLx8ESoMWtgzjr8s3u6IhPp3XlIX4ExRHlkqSXC_Q8CtDdq1Eq1FGhydBKjBHA0IpS4rHSbaBkXKLzuDGqV54TuDpK5c3VQkiy7RNRgsm1h1W7xnv508qb-hK-yVAMtzbDqxK7F7GX3WQPgNT7KAhxqER4NG4yqTBHl8Id6vI187UwkEbVTCExJ79nqLG8Nlpkqw2D5oNZJKvFWyVaG-xJNgtiObz-GlkomqZFbrERcCRfdODbBUSesMJy9fUnlp34S-2NGyZ-71DaZOmX3PNBlFk4vpOJ6yePxhPg0sHukqEZQeJewgepWwD8vlnC2WMVt8mc8Po1dGXVPGZov4NJx-na1mHnlnwc6nH8df5jGrJF1VQe4oO3hzGL2aLBer-GI8W8QsAX2JW_b5YvZpfPGd_Tn9zg5qv-PVxNvOFufTbyyBBCi7YQdJOI_enEXReB5PL57Mdrb4YzqJ2Soex7NVPJus2OsfEWOM_R1--58e3xThbdkbsePDh-NmkfZG7Mf9YfiQ9O7__7lrb5A7zIC73oj1hoPhsH887A-G7Ph0dPJ2NHx39Ovvb9-dDHs7GP9WIhmeaJX0uOHOxyCR4VXtttpn19uFSl6GMwD_nAJ49M0r_J3Lwc4Hv2fuzo-PB4Pw5Z_DPYwMnsNIKNN_yMrg_2OloST6-fosiqbfPs_HswU7WH6OD9l08fUNW03nvqF-YR8vlp9Ychb1-_1-FN4SSfRvAAAA__8W54tj
